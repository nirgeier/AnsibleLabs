
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A collection of GitHub Labs for learning and practicing GitHub skills.">
      
      
        <meta name="author" content="Nir Geier - nirgeier@gmail.com">
      
      
        <link rel="canonical" href="https://nirgeier.github.io/AnsibleLabs/print_page/">
      
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Print Site - AnsibleLabs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%202a7%207%200%200%200-7%207c0%202.38%201.19%204.47%203%205.74V17a1%201%200%200%200%201%201h6a1%201%200%200%200%201-1v-2.26c1.81-1.27%203-3.36%203-5.74a7%207%200%200%200-7-7M9%2021a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1H9z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Mulish";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/codewizard.css?v=1765717871">
    
    <script>__md_scope=new URL("/AnsibleLabs/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#welcome" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine classes -->





<!-- Header -->
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">

    <!-- Link to home -->
    <a href=".." title="AnsibleLabs"
      class="md-header__button md-logo" aria-label="AnsibleLabs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AnsibleLabs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
            Print Site
            
          </span>
        </div>
      </div>
    </div>

    <div class="m-social__top">
      <!-- Social links -->
      
      
<div class="md-social">
    
    
    
    
    
    <a href="https://github.com/nirgeier/AnsibleLabs" target="_blank" rel="noopener" title="View on GitHub"
        class="md-social__link social-class__github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/AnsibleLabs/network/members" target="_blank" rel="noopener" title="Fork this repo"
        class="md-social__link social-class__fork">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/AnsibleLabs/stargazers" target="_blank" rel="noopener" title="Star this repo"
        class="md-social__link social-class__star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener" title="Connect on LinkedIn"
        class="md-social__link social-class__linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://discord.gg/U6xW23Ss" target="_blank" rel="noopener" title="Follow me on Discord"
        class="md-social__link social-class__discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://stackoverflow.com/users/1755598/codewizard" target="_blank" rel="noopener" title="Follow me on Stack Overflow"
        class="md-social__link social-class__stackoverflow">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://wa.me/972548122310" target="_blank" rel="noopener" title="Follow me on WhatsApp"
        class="md-social__link social-class__whatsapp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg>
    </a>
    
    
    
    
    
    <a href="mailto:nirg@codewizard.co.il" target="_blank" rel="noopener" title="Email me"
        class="md-social__link social-class__email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg>
    </a>
    
</div>
      
    </div>

    <!-- Color palette toggle -->
    
    
    <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
    
    

    <!-- User preference: color palette -->
    
    <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
    

    <!-- Check if search is actually enabled - see https://t.ly/DT_0V -->
    
    <label class="md-header__button md-icon" for="__search">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
    </label>

    <!-- Search interface -->
    <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    

    <!-- Repository information -->
    
    <div class="md-header__source">
      <a href="https://github.com/nirgeier/AnsibleLabs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nirgeier/AnsibleLabs
  </div>
</a>
    </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
  
  
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../welcome/" class="md-tabs__link">
        
  
  
    
  
  Start Here

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  
    
  
  Labs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
  
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AnsibleLabs" class="md-nav__button md-logo" aria-label="AnsibleLabs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    AnsibleLabs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nirgeier/AnsibleLabs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nirgeier/AnsibleLabs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../welcome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Start Here
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href=".." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="welcome" heading-number="1"><!-- header start -->
<div class="center">
<h1 id="welcome-ansible-labs">Ansible Labs<a class="headerlink" href="#welcome-ansible-labs" title="Permanent link">&para;</a></h1>
<p><img src="../assets/images/ansible-labs.png" ></p>
</div>
<hr />
<p><img src="../assets/images/tldr.png" style="width:100px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);"></p>
<div class="admonition success">
<p class="admonition-title">Getting Started Tip</p>
<p>Choose the preferred way to run the labs. If you encounter any issues, please contact your instructor.</p>
</div>
<div class="grid cards" style="text-align: center;border-radius: 20px;">
<ul>
<li>
<p><img alt="" src="../assets/images/docker.png" />
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#welcome-__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span><span class="m">000</span>-setup<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div></p>
</li>
<li>
<p><img alt="" class="height-64px" src="../assets/images/killercoda.png" /><br/><br/>
  <a target="_blank" href="https://killercoda.com/codewizard/scenario/Ansible">Launch on KillerCoda</a></p>
</li>
</ul>
</div>
<h2 id="welcome-intro">Intro<a class="headerlink" href="#welcome-intro" title="Permanent link">&para;</a></h2>
<ul>
<li>This tutorial is for teaching Ansible through hands-on labs designed as practical exercises.</li>
<li>Each lab is packaged in its own folder and includes the files, playbooks, and assets required to complete the lab.</li>
<li>Every lab folder includes a <code>README</code> that describes the lab&rsquo;s objectives, tasks, and how to verify the solution.</li>
<li>The Ansible Labs are a series of Ansible automation exercises designed to teach players Ansible skills &amp; features.</li>
<li>The inspiration for this project is to provide practical learning experiences for Ansible.</li>
</ul>
<h2 id="welcome-pre-requirements">Pre-Requirements<a class="headerlink" href="#welcome-pre-requirements" title="Permanent link">&para;</a></h2>
<ul>
<li>This tutorial will test your <code>Ansible</code> and <code>Linux</code> skills.</li>
<li>You should be familiar with the following topics:<ul>
<li>Basic Linux commands</li>
<li>Linux File system navigation</li>
<li>Basic knowledge of <code>Docker</code> (if you choose to run it with Docker)</li>
<li>Basic knowledge of YAML</li>
</ul>
</li>
<li>For advanced Labs: <ul>
<li><code>Ansible</code> basics (<code>inventory</code>, <code>playbooks</code>, <code>modules</code>)</li>
</ul>
</li>
</ul>
<h2 id="welcome-usage">Usage<a class="headerlink" href="#welcome-usage" title="Permanent link">&para;</a></h2>
<ul>
<li>There are several ways to run the Ansible Labs. </li>
<li>Choose the method that works best for you.<ul>
<li><img alt="" class="width-24px" src="../assets/images/killercoda-icon.png" /> Killercoda  (Recommended)</li>
<li>üê≥ Docker</li>
<li>üìú From Source</li>
<li><img alt="" class="width-24px" src="../assets/images/gcp.png" /> Using Google Cloud Shell</li>
</ul>
</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="welcome-__tabbed_1_1" name="welcome-__tabbed_1" type="radio" /><input id="welcome-__tabbed_1_2" name="welcome-__tabbed_1" type="radio" /><input id="welcome-__tabbed_1_3" name="welcome-__tabbed_1" type="radio" /><input id="welcome-__tabbed_1_4" name="welcome-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_1_1"><img alt="" class="" src="../assets/images/killercoda-icon.png" width-24px="width-24px" /> Killercoda  (Recommended)</label><label for="welcome-__tabbed_1_2">üê≥ Docker</label><label for="welcome-__tabbed_1_3">üìú From Source</label><label for="welcome-__tabbed_1_4"><img alt="" class="width-24px" src="../assets/images/gcp.png" /> Using Google Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>The easiest way to get started with the labs</li>
<li>Learn Ansible in your browser without any local installation</li>
</ul>
<p>üåê <a href="https://killercoda.com/codewizard/scenario/Ansible" target="_blank"><strong>Launch on Killercoda</strong></a></p>
<p><strong>Benefits:</strong></p>
<ul>
<li>No installation required</li>
<li>Pre-configured environment</li>
<li>Works on any device with a web browser</li>
<li>All tools pre-installed</li>
</ul>
</div>
<div class="tabbed-block">
<p>Using Docker is the easiest way to get started locally with the labs:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#welcome-__codelineno-1-1"></a><span class="c1"># Change to the Labs directory</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#welcome-__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>Labs/000-setup
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#welcome-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#welcome-__codelineno-1-4"></a><span class="c1"># Run the setup lab using Docker Compose</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#welcome-__codelineno-1-5"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>Docker and Docker Compose installed on your system</li>
<li>No additional setup required</li>
</ul>
</div>
<div class="tabbed-block">
<p>For those who prefer to run it directly on their machine:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#welcome-__codelineno-2-1"></a><span class="c1"># Clone the repository</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#welcome-__codelineno-2-2"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nirgeier/AnsibleLabs.git
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#welcome-__codelineno-2-3"></a><span class="c1"># Change to the Labs directory</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#welcome-__codelineno-2-4"></a><span class="nb">cd</span><span class="w"> </span>AnsibleLabs/Labs
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#welcome-__codelineno-2-5"></a><span class="c1"># Start with the setup lab</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#welcome-__codelineno-2-6"></a><span class="nb">cd</span><span class="w"> </span><span class="m">000</span>-setup
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#welcome-__codelineno-2-7"></a><span class="c1"># Follow the instructions in the README of each lab</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#welcome-__codelineno-2-8"></a>cat<span class="w"> </span>README.md
</span></code></pre></div>
<strong>Prerequisites:</strong></p>
<ul>
<li>Ansible installed on your system</li>
<li>A Unix-like operating system (Linux, macOS, or Windows with WSL)</li>
<li>Basic command-line tools</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>Google Cloud Shell provides a free, browser-based environment with all necessary tools pre-installed.</li>
<li>Click on the <code>Open in Google Cloud Shell</code> button below:</li>
</ul>
<p><a href="https://console.cloud.google.com/cloudshell/editor?cloudshell_git_repo=https://github.com/nirgeier/AnsibleLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<ul>
<li>The repository will automatically be cloned into a free Cloud instance.</li>
<li>Use <strong><kbd>CTRL</kbd></strong> + click to open it in a new window.</li>
<li>Follow the instructions in the README of each lab.</li>
</ul>
<p><strong>Benefits:</strong></p>
<ul>
<li>No local installation required</li>
<li>Pre-configured environment</li>
<li>Works on any device with a web browser</li>
<li>All tools pre-installed</li>
<li>Free tier available</li>
</ul>
</div>
</div>
</div>
<hr />
<div class="admonition explore">
<p class="admonition-title">Lab Breakdown</p>
<ul>
<li>If you choose to run the labs locally using Docker or From Source, follow the steps below to set up your environment.</li>
<li>Make sure you have the necessary tools installed.</li>
<li>Follow the instructions in the README of each lab.</li>
<li>Review the Dockerfile(s) and docker-compose.yml for container configurations.</li>
</ul>
</div>
<hr />
<h2 id="welcome-02-build-from-source">02. Build from source<a class="headerlink" href="#welcome-02-build-from-source" title="Permanent link">&para;</a></h2>
<ul>
<li>Clone the git repo:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#welcome-__codelineno-3-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nirgeier/AnsibleLabs.git
</span></code></pre></div></li>
<li>Navigate to the Labs directory:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#welcome-__codelineno-4-1"></a><span class="nb">cd</span><span class="w"> </span>AnsibleLabs/Labs/000-setup
</span></code></pre></div></li>
<li>
<p>Run the setup script:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#welcome-__codelineno-5-1"></a>./_setup.sh
</span></code></pre></div>
    Setup scripts breakdown:</p>
<table>
<thead>
<tr>
<th>Script</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr>
<td>üóûÔ∏è <code>00-build-containers.sh</code></td>
<td>üìí Init the shared folders</td>
</tr>
<tr>
<td></td>
<td>üê≥ Build the container(s)</td>
</tr>
<tr>
<td>üóûÔ∏è <code>01-init-servers.sh</code></td>
<td>‚èØ Initialize the containers</td>
</tr>
<tr>
<td></td>
<td>üîê Extract the ssh certificates</td>
</tr>
<tr>
<td></td>
<td>‚úì verify that the ssh service is running in the containers</td>
</tr>
<tr>
<td>üóûÔ∏è <code>02-init-ansible.sh</code></td>
<td>üöÄ Initialize the ansible files</td>
</tr>
<tr>
<td></td>
<td>üìö <code>ansible.cfg</code></td>
</tr>
<tr>
<td></td>
<td>üìö <code>ssh.config</code></td>
</tr>
<tr>
<td></td>
<td>üìö <code>inventory</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>The lab contains a <code>docker-compose</code> file alongside a Dockerfile.</p>
</li>
<li>The containers are based on Ubuntu OS and are published on <code>DockerHub</code> as well.</li>
<li>Build the demo containers by running:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#welcome-__codelineno-6-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div></li>
<li>The docker-compose will create <code>ansible-controller</code> which will server as our controller to execute ansible playbooks on our demo servers defined by the names <code>linux-server-X</code></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Labs containers</p>
<table>
<thead>
<tr>
<th>Container</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr>
<td>üê≥  <code>ansible-controller</code></td>
<td>Linux container with ansible installed</td>
</tr>
<tr>
<td>üê≥  <code>linux-server-1</code></td>
<td>Linux container with ssh only (no ansible installed)</td>
</tr>
<tr>
<td>üê≥  <code>linux-server-2</code></td>
<td>Linux container with ssh only (no ansible installed)</td>
</tr>
<tr>
<td>üê≥   <code>linux-server-3</code></td>
<td>Linux container with ssh only (no ansible installed)</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>For the demo we will also need a shared folder(s) where the certificates and the configuration will be stored</li>
<li>The shared folder(s) will be mounted into the containers</li>
<li>The containers will have access to the shared folder(s) for reading and writing files</li>
<li>The shared folder(s) will be used to store the Ansible playbooks and inventory files</li>
<li>The shared folder(s) will be mounted at <code>/labs-scripts</code> in the containers</li>
</ul>
<hr />
<hr />
<div class="admonition warning">
<ul>
<li>Ensure you have the necessary permissions to run Docker commands or Ansible playbooks on your system.</li>
<li>Enjoy, and don&rsquo;t forget to star the project on GitHub!</li>
</ul>
</div>
<h2 id="welcome-preface">Preface<a class="headerlink" href="#welcome-preface" title="Permanent link">&para;</a></h2>
<h3 id="welcome-what-is-ansible">What is Ansible?<a class="headerlink" href="#welcome-what-is-ansible" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Ansible</code> is an open-source automation tool for IT tasks such as configuration management, application deployment, and task automation. </li>
<li><code>Ansible</code> is <code>Configuration Management</code> tool which manage the <code>state</code> of our servers, install the required packages and tools.</li>
<li>Other optional use cases can be  <code>deployments</code>, <code>Provisioning new servers</code></li>
<li>The most powerful feature of <code>Ansible</code> is the ability to manage huge scale of servers regardless of their infrastructure (on prem, cloud, vm etc)</li>
<li><code>Ansible</code> uses SSH to connect to servers and execute tasks defined in YAML playbooks, making it agentless and easy to use. </li>
<li><code>Ansible</code> is widely used for managing infrastructure, ensuring consistency, and automating repetitive processes across various environments (on-premises, cloud, VMs, etc.).</li>
</ul>
<h3 id="welcome-how-ansible-works">How Ansible Works<a class="headerlink" href="#welcome-how-ansible-works" title="Permanent link">&para;</a></h3>
<p><img src="../assets/images/ansible-architecture-diagram.png" class="border-radius-20" alt="Ansible Architecture Diagram"/></p>
<ul>
<li>Ansible is an <code>agentless tool</code>.</li>
<li>Ansible uses <code>ssh</code> for <code>pulling modules</code> and for managing the nodes</li>
<li>Ansible is based upon <code>YAML</code> </li>
<li>An <code>Ansible playbook</code> is a file that contains a set of instructions that Ansible can use to automate tasks on remote hosts.</li>
<li><code>Playbooks</code> are written in <code>YAML</code>, a human-readable markup language. A playbook typically consists of one or more <code>plays</code>, a collection of tasks run in sequence.</li>
</ul>
<hr />
<h3 id="welcome-how-ansible-playbooks-work">How Ansible Playbooks Work<a class="headerlink" href="#welcome-how-ansible-playbooks-work" title="Permanent link">&para;</a></h3>
<ul>
<li>Here‚Äôs a brief overview of how <code>Ansible playbooks</code> work:</li>
</ul>
<div class="grid cards">
<ul>
<li>
<h4 id="welcome-playbook-structure">Playbook Structure<a class="headerlink" href="#welcome-playbook-structure" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>A <code>playbook</code> is composed of one or more <code>plays</code> in an ordered list. </p>
</li>
<li>
<p>Each <code>play</code> executes part of the overall goal of the <code>playbook</code>, running one or more tasks. </p>
</li>
<li>Each task calls an <code>Ansible</code> module.</li>
</ul>
</li>
<li>
<h4 id="welcome-playbook-execution">Playbook Execution<a class="headerlink" href="#welcome-playbook-execution" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>A <code>playbook</code> runs in order from top to bottom.</p>
</li>
<li>
<p>Within each <code>play</code>, tasks also run in order from top to bottom.</p>
</li>
<li>
<p>Playbooks with multiple <code>plays</code> can orchestrate multi-machine deployments.</p>
</li>
</ul>
</li>
<li>
<h4 id="welcome-task-execution">Task Execution<a class="headerlink" href="#welcome-task-execution" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><code>Tasks</code> are executed by <code>modules</code>, each of which performs a specific task in a playbook.</p>
</li>
<li>
<p>There are thousands of <code>Ansible modules</code> that perform all kinds of IT tasks.</p>
</li>
</ul>
</li>
<li>
<h4 id="welcome-reusability">Reusability<a class="headerlink" href="#welcome-reusability" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><code>Playbooks</code> offer a repeatable, reusable, simple configuration management and multi-machine deployment system.</p>
</li>
<li>
<p>If you need to execute a <code>task</code> with <code>Ansible</code> more than once, write a <code>playbook</code> and put it under source control.</p>
</li>
</ul>
</li>
</ul>
</div>
<ul>
<li>Playbooks are <strong>one of the core features of Ansible</strong> and tell Ansible what to execute.</li>
<li>They are used in complex scenarios.</li>
<li>They serve as frameworks of pre-written code that developers can use ad-hoc or as a starting template.</li>
<li>They can be saved, shared, or reused indefinitely, making it easier for IT teams to codify operational knowledge and ensure that the same actions are performed consistently.</li>
</ul></section>
                    <section class='print-page md-section' id='section-2' heading-number='2'>
                        <h1>Labs<a class='headerlink' href='#section-2' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="index" heading-number="2.1"><h1 id="index-list-of-labs">List of Labs<a class="headerlink" href="#index-list-of-labs" title="Permanent link">&para;</a></h1>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Summary</th>
<th>Build Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#000-setup">Lab 000 - Setup</a></td>
<td>Setup lab environment with Ansible controller and Linux servers using Docker containers.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/000-setup.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/000-setup.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#001-verify-ansible">Lab 001 - Verify Ansible configuration</a></td>
<td>Verify Ansible configuration by creating and testing ansible.cfg, inventory, and ssh.config files.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/001-verify-ansible.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/001-verify-ansible.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#002-no-inventory">Lab 002 - No Inventory Example</a></td>
<td>Demonstrate the importance of inventory by showing behavior without it and then configuring one.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/002-no-inventory.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/002-no-inventory.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#003-modules">Lab 003 - Commands &amp; Modules</a></td>
<td>Learn about Ansible modules, focusing on the ping module and ad-hoc commands.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/003-modules.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/003-modules.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#004-playbooks">Lab 004 - Playbooks</a></td>
<td>Introduction to Ansible playbooks, their structure, and basic usage.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/004-playbooks.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/004-playbooks.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#005-facts">Lab 005 - Facts</a></td>
<td>Learn about Ansible facts, how to gather and use them in playbooks.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/005-facts.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/005-facts.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#006-git">Lab 006 - Git</a></td>
<td>Hands-on lab to create a playbook for installing Git and cloning repositories.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/006-git.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/006-git.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#007-create-user">Lab 007 - Create User</a></td>
<td>Hands-on lab to create a playbook for creating users on remote systems.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/007-create-user.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/007-create-user.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#008-challenges">Lab 008 - Challenges</a></td>
<td>Challenge lab combining user creation and Git operations.</td>
<td>&mdash;</td>
</tr>
<tr>
<td><a href="#009-roles">Lab 009 - Roles</a></td>
<td>Learn about Ansible roles, their structure, and how to create and use them.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/009-roles.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/009-roles.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#010-loops-and-conditionals">Lab 010 - Loops and Conditionals</a></td>
<td>Learn about loops and conditional statements in Ansible playbooks.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/010-loops-and-conditionals.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/010-loops-and-conditionals.yaml/badge.svg" /></a></td>
</tr>
<tr>
<td><a href="#011-jinja-templating">Lab 011 - Jinja2 Templating</a></td>
<td>Learn about Jinja2 templating for dynamic configuration files in Ansible.</td>
<td><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/011-jinja-templating.yaml"><img alt="Build Status" src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/011-jinja-templating.yaml/badge.svg?label=%20" /></a></td>
</tr>
</tbody>
</table></section><section class="print-page" id="000-setup" heading-number="2.2"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-000.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-000.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="000-setup-lab-000-setup">Lab 000 - Setup<a class="headerlink" href="#000-setup-lab-000-setup" title="Permanent link">&para;</a></h1>
<ul>
<li>In this lab we will define and build docker containers which will be used in the next labs.</li>
<li>The lab structure consists of an Ansible controller &amp; 3 Linux servers, all set inside docker containers.</li>
</ul>
<hr />
<h2 id="000-setup-01-usage">01. Usage<a class="headerlink" href="#000-setup-01-usage" title="Permanent link">&para;</a></h2>
<ul>
<li>There are several ways to run the Ansible Labs. </li>
<li>Choose the method that works best for you.<ul>
<li><img alt="" class="width-24px" src="../assets/images/killercoda-icon.png" /> Killercoda  (Recommended)</li>
<li>üê≥ Docker</li>
<li>üìú From Source</li>
<li><img alt="" class="width-24px" src="../assets/images/gcp.png" /> Using Google Cloud Shell</li>
</ul>
</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="000-setup-__tabbed_1_1" name="000-setup-__tabbed_1" type="radio" /><input id="000-setup-__tabbed_1_2" name="000-setup-__tabbed_1" type="radio" /><input id="000-setup-__tabbed_1_3" name="000-setup-__tabbed_1" type="radio" /><input id="000-setup-__tabbed_1_4" name="000-setup-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="000-setup-__tabbed_1_1"><img alt="" class="" src="../assets/images/killercoda-icon.png" width-24px="width-24px" /> Killercoda  (Recommended)</label><label for="000-setup-__tabbed_1_2">üê≥ Docker</label><label for="000-setup-__tabbed_1_3">üìú From Source</label><label for="000-setup-__tabbed_1_4"><img alt="" class="width-24px" src="../assets/images/gcp.png" /> Using Google Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>The easiest way to get started with the labs</li>
<li>Learn Ansible in your browser without any local installation</li>
</ul>
<p>üåê <a href="https://killercoda.com/codewizard/scenario/Ansible" target="_blank"><strong>Launch on Killercoda</strong></a></p>
<p><strong>Benefits:</strong></p>
<ul>
<li>No installation required</li>
<li>Pre-configured environment</li>
<li>Works on any device with a web browser</li>
<li>All tools pre-installed</li>
</ul>
</div>
<div class="tabbed-block">
<p>Using Docker is the easiest way to get started locally with the labs:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#000-setup-__codelineno-0-1"></a><span class="c1"># Change to the Labs directory</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#000-setup-__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>Labs/000-setup
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#000-setup-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#000-setup-__codelineno-0-4"></a><span class="c1"># Run the setup lab using Docker Compose</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#000-setup-__codelineno-0-5"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>Docker and Docker Compose installed on your system</li>
<li>No additional setup required</li>
</ul>
</div>
<div class="tabbed-block">
<p>For those who prefer to run it directly on their machine:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#000-setup-__codelineno-1-1"></a><span class="c1"># Clone the repository</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#000-setup-__codelineno-1-2"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nirgeier/AnsibleLabs.git
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#000-setup-__codelineno-1-3"></a><span class="c1"># Change to the Labs directory</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#000-setup-__codelineno-1-4"></a><span class="nb">cd</span><span class="w"> </span>AnsibleLabs/Labs
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#000-setup-__codelineno-1-5"></a><span class="c1"># Start with the setup lab</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#000-setup-__codelineno-1-6"></a><span class="nb">cd</span><span class="w"> </span><span class="m">000</span>-setup
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#000-setup-__codelineno-1-7"></a><span class="c1"># Follow the instructions in the README of each lab</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#000-setup-__codelineno-1-8"></a>cat<span class="w"> </span>README.md
</span></code></pre></div>
<strong>Prerequisites:</strong></p>
<ul>
<li>Ansible installed on your system</li>
<li>A Unix-like operating system (Linux, macOS, or Windows with WSL)</li>
<li>Basic command-line tools</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>Google Cloud Shell provides a free, browser-based environment with all necessary tools pre-installed.</li>
<li>Click on the <code>Open in Google Cloud Shell</code> button below:</li>
</ul>
<p><a href="https://console.cloud.google.com/cloudshell/editor?cloudshell_git_repo=https://github.com/nirgeier/AnsibleLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<ul>
<li>The repository will automatically be cloned into a free Cloud instance.</li>
<li>Use <strong><kbd>CTRL</kbd></strong> + click to open it in a new window.</li>
<li>Follow the instructions in the README of each lab.</li>
</ul>
<p><strong>Benefits:</strong></p>
<ul>
<li>No local installation required</li>
<li>Pre-configured environment</li>
<li>Works on any device with a web browser</li>
<li>All tools pre-installed</li>
<li>Free tier available</li>
</ul>
</div>
</div>
</div>
<hr />
<div class="admonition explore">
<p class="admonition-title">Lab Breakdown</p>
<ul>
<li>If you choose to run the labs locally using Docker or From Source, follow the steps below to set up your environment.</li>
<li>Make sure you have the necessary tools installed.</li>
<li>Follow the instructions in the README of each lab.</li>
<li>Review the Dockerfile(s) and docker-compose.yml for container configurations.</li>
</ul>
</div>
<hr />
<h2 id="000-setup-02-build-from-source">02. Build from source<a class="headerlink" href="#000-setup-02-build-from-source" title="Permanent link">&para;</a></h2>
<ul>
<li>Clone the git repo:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#000-setup-__codelineno-2-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nirgeier/AnsibleLabs.git
</span></code></pre></div></li>
<li>Navigate to the Labs directory:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#000-setup-__codelineno-3-1"></a><span class="nb">cd</span><span class="w"> </span>AnsibleLabs/Labs/000-setup
</span></code></pre></div></li>
<li>
<p>Run the setup script:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#000-setup-__codelineno-4-1"></a>./_setup.sh
</span></code></pre></div>
    Setup scripts breakdown:</p>
<table>
<thead>
<tr>
<th>Script</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr>
<td>üóûÔ∏è <code>00-build-containers.sh</code></td>
<td>üìí Init the shared folders</td>
</tr>
<tr>
<td></td>
<td>üê≥ Build the container(s)</td>
</tr>
<tr>
<td>üóûÔ∏è <code>01-init-servers.sh</code></td>
<td>‚èØ Initialize the containers</td>
</tr>
<tr>
<td></td>
<td>üîê Extract the ssh certificates</td>
</tr>
<tr>
<td></td>
<td>‚úì verify that the ssh service is running in the containers</td>
</tr>
<tr>
<td>üóûÔ∏è <code>02-init-ansible.sh</code></td>
<td>üöÄ Initialize the ansible files</td>
</tr>
<tr>
<td></td>
<td>üìö <code>ansible.cfg</code></td>
</tr>
<tr>
<td></td>
<td>üìö <code>ssh.config</code></td>
</tr>
<tr>
<td></td>
<td>üìö <code>inventory</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>The lab contains a <code>docker-compose</code> file alongside a Dockerfile.</p>
</li>
<li>The containers are based on Ubuntu OS and are published on <code>DockerHub</code> as well.</li>
<li>Build the demo containers by running:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#000-setup-__codelineno-5-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div></li>
<li>The docker-compose will create <code>ansible-controller</code> which will server as our controller to execute ansible playbooks on our demo servers defined by the names <code>linux-server-X</code></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Labs containers</p>
<table>
<thead>
<tr>
<th>Container</th>
<th>Content</th>
</tr>
</thead>
<tbody>
<tr>
<td>üê≥  <code>ansible-controller</code></td>
<td>Linux container with ansible installed</td>
</tr>
<tr>
<td>üê≥  <code>linux-server-1</code></td>
<td>Linux container with ssh only (no ansible installed)</td>
</tr>
<tr>
<td>üê≥  <code>linux-server-2</code></td>
<td>Linux container with ssh only (no ansible installed)</td>
</tr>
<tr>
<td>üê≥   <code>linux-server-3</code></td>
<td>Linux container with ssh only (no ansible installed)</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>For the demo we will also need a shared folder(s) where the certificates and the configuration will be stored</li>
<li>The shared folder(s) will be mounted into the containers</li>
<li>The containers will have access to the shared folder(s) for reading and writing files</li>
<li>The shared folder(s) will be used to store the Ansible playbooks and inventory files</li>
<li>The shared folder(s) will be mounted at <code>/labs-scripts</code> in the containers</li>
</ul>
<hr />
<h2 id="000-setup-03-core-concepts">03. Core concepts<a class="headerlink" href="#000-setup-03-core-concepts" title="Permanent link">&para;</a></h2>
<ul>
<li>Create <code>Ansible Controller</code> container, which will be used to manage the other containers</li>
<li><code>SSH Keys</code> - The SSH keys will be generated and mounted into the containers</li>
<li>Initialize servers: Set up runtime directories, start demo containers via <code>Docker Compose</code>, verify <code>Ansible</code> installation, extract <code>SSH keys</code> from servers, configure known hosts, check SSH services, and test SSH connections to each Linux server</li>
</ul>
<hr />
<h2 id="000-setup-04-verify-containers">04. Verify containers<a class="headerlink" href="#000-setup-04-verify-containers" title="Permanent link">&para;</a></h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#000-setup-__codelineno-6-1"></a>$<span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#000-setup-__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#000-setup-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#000-setup-__codelineno-6-4"></a><span class="c1"># Expected output</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#000-setup-__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#000-setup-__codelineno-6-6"></a>IMAGE<span class="w">                       </span>PORTS<span class="w">                                                                  </span>NAMES
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#000-setup-__codelineno-6-7"></a>---------------------------------------------------------------------------------------------------------------------
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#000-setup-__codelineno-6-8"></a>nirgeier/ansible-controller<span class="w"> </span><span class="m">22</span>/tcp<span class="w">                                                                 </span>ansible-controller
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#000-setup-__codelineno-6-9"></a>nirgeier/linux-server<span class="w">       </span><span class="m">0</span>.0.0.0:3001-&gt;22/tcp,<span class="w"> </span><span class="m">0</span>.0.0.0:5001-&gt;5000/tcp,<span class="w"> </span><span class="m">0</span>.0.0.0:8081-&gt;8080/tcp<span class="w">   </span>linux-server-1
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#000-setup-__codelineno-6-10"></a>nirgeier/linux-server<span class="w">       </span><span class="m">0</span>.0.0.0:3002-&gt;22/tcp,<span class="w"> </span><span class="m">0</span>.0.0.0:5002-&gt;5000/tcp,<span class="w"> </span><span class="m">0</span>.0.0.0:8082-&gt;8080/tcp<span class="w">   </span>linux-server-2
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#000-setup-__codelineno-6-11"></a>nirgeier/linux-server<span class="w">       </span><span class="m">0</span>.0.0.0:3003-&gt;22/tcp,<span class="w"> </span><span class="m">0</span>.0.0.0:5003-&gt;5000/tcp,<span class="w"> </span><span class="m">0</span>.0.0.0:8083-&gt;8080/tcp<span class="w">   </span>linux-server-3
</span></code></pre></div>
<hr />
<h2 id="000-setup-05-next-steps">05. Next steps<a class="headerlink" href="#000-setup-05-next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li>Proceed to <a href="#001-verify-ansible">Lab 001 - Verify Ansible configuration</a> to start using Ansible with the configured environment.</li>
<li>Don&rsquo;t forget to check the logs for any errors or issues during the setup process.</li>
<li>If you encounter any problems, refer to the troubleshooting section or open an issue on the GitHub repository.</li>
<li>Enjoy learning Ansible!</li>
</ul></section><section class="print-page" id="001-verify-ansible" heading-number="2.3"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-001.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-001.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="001-verify-ansible-lab-001-verify-ansible-configuration">Lab 001 - Verify Ansible configuration<a class="headerlink" href="#001-verify-ansible-lab-001-verify-ansible-configuration" title="Permanent link">&para;</a></h1>
<ul>
<li>In this lab we will create the Ansible configuration and verify that it is configured correctly.</li>
<li>This lab is based upon the <a href="#000-setup">previous lab</a> and its <code>docker-compose</code>.</li>
<li>In this lab we will learn how to use:<ul>
<li><code>ansible.cfg</code></li>
<li><code>inventory</code></li>
<li><code>ssh.config</code></li>
</ul>
</li>
</ul>
<h2 id="001-verify-ansible-pre-requirements">Pre-Requirements<a class="headerlink" href="#001-verify-ansible-pre-requirements" title="Permanent link">&para;</a></h2>
<ul>
<li>Complete the <a href="#000-setup-usage">previous lab</a> in order to have the <code>Ansible</code> controller and the <code>Linux</code> servers up and running.</li>
</ul>
<hr />
<h2 id="001-verify-ansible-01-create-configuration-files">01. Create configuration files<a class="headerlink" href="#001-verify-ansible-01-create-configuration-files" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">IMPORTANT!</p>
<ul>
<li>In this lab we will be placing the files under the <code>/labs-scripts</code> directory.  </li>
<li>The directory is <strong>mounted</strong> to our docker container(s) under the <code>&lt;PROJECT_ROOT&gt;/runtime</code> directory.  </li>
<li>You are encouraged to review  the <a href="../000-setup/docker-compose.yaml"><code>docker-compose.yaml</code></a> file throughout the lab session. </li>
</ul>
</div>
<hr />
<h2 id="001-verify-ansible-02-about-ansiblecfg-file">02. About <code>ansible.cfg</code> file<a class="headerlink" href="#001-verify-ansible-02-about-ansiblecfg-file" title="Permanent link">&para;</a></h2>
<ul>
<li>What is <code>ansible.cfg</code> ?<ul>
<li>The <code>ansible.cfg</code> file is an INI-like configuration file used to define various settings and parameters that influence how Ansible operates. </li>
<li>It allows users to customize Ansible&rsquo;s behavior, such as specifying inventory locations, default module settings, connection options, and more.</li>
<li>The <code>ansible.cfg</code> file can be placed in several locations, and Ansible will search for it in a specific order.</li>
<li>The configuration file is divided into sections, each containing various customizable parameters that control different aspects of Ansible&rsquo;s functionality.</li>
<li>Below we will create the <code>ansible.cfg</code> file, the <code>ssh.config</code> file and the <code>inventory</code> file.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="001-verify-ansible-03-ansiblecfg-locations">03. <code>ansible.cfg</code> locations:<a class="headerlink" href="#001-verify-ansible-03-ansiblecfg-locations" title="Permanent link">&para;</a></h2>
<ul>
<li>Reference: <a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#the-configuration-file">Official Ansible documentation: - Ansible Configuration Settings</a></li>
<li>Ansible searches <code>ansible.cfg</code> in a specific order. </li>
<li>The <strong>first file</strong> it finds will be used while ignoring the rest.</li>
<li>
<p>Ansible will <strong>search</strong> for the configuration file in the following order: </p>
<table>
<thead>
<tr>
<th>Search resource</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ANSIBLE_CONFIG</code></td>
<td>environment variable if set</td>
</tr>
<tr>
<td><code>ansible.cfg</code></td>
<td>In the current directory</td>
</tr>
<tr>
<td><code>~/.ansible.cfg</code></td>
<td>Under the home directory</td>
</tr>
<tr>
<td><code>/etc/ansible/ansible.cfg</code></td>
<td>OS common path</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>In this exercise the environment variable <code>ANSIBLE_CONFIG</code> is set in the docker container path <code>/labs-scripts/.ansible.cfg</code></p>
</li>
</ul>
<hr />
<h2 id="001-verify-ansible-04-ansiblecfg-structure">04. <code>ansible.cfg</code> structure:<a class="headerlink" href="#001-verify-ansible-04-ansiblecfg-structure" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>The <code>ansible.cfg</code> file is <strong>divided into sections</strong>, each containing various customizable parameters.</p>
</li>
<li>
<p>Main <code>ansible.cfg</code> settings:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Description</th>
<th>Ansible Docs</th>
</tr>
</thead>
<tbody>
<tr>
<td>[callback_plugins]</td>
<td>Specifies directories for callback plugins that customize output or trigger actions.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#callback-plugins">Docs</a></td>
</tr>
<tr>
<td>[connection]</td>
<td>Defines general connection settings that apply to all connection types.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#connection">Docs</a></td>
</tr>
<tr>
<td>[defaults]</td>
<td>Contains general settings for Ansible such as inventory location, verbosity, and log settings.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#defaults">Docs</a></td>
</tr>
<tr>
<td>[diff]</td>
<td>Controls whether Ansible shows differences when applying configurations.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#diff">Docs</a></td>
</tr>
<tr>
<td>[galaxy]</td>
<td>Configures settings for Ansible Galaxy, a hub for sharing roles and collections.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#galaxy">Docs</a></td>
</tr>
<tr>
<td>[inventory]</td>
<td>Defines options related to inventory parsing and caching.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#inventory">Docs</a></td>
</tr>
<tr>
<td>[logging]</td>
<td>Logging configuration, typically under [defaults] section using log_path.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#defaults">Docs</a></td>
</tr>
<tr>
<td>[paramiko_connection]</td>
<td>Configures settings specific to the Paramiko SSH library.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#paramiko-connection">Docs</a></td>
</tr>
<tr>
<td>[privilege_escalation]</td>
<td>Defines settings related to privilege escalation, such as sudo or become.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#privilege-escalation">Docs</a></td>
</tr>
<tr>
<td>[ssh_connection]</td>
<td>Settings for SSH connections, (timeout, control settings etc).</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#ssh-connection">Docs</a></td>
</tr>
<tr>
<td>[winrm]</td>
<td>Configures settings for Windows Remote Management (WinRM) connections.</td>
<td><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#winrm">Docs</a></td>
</tr>
</tbody>
</table>
<hr />
<h3 id="001-verify-ansible-callback_plugins"><code>[callback_plugins]</code><a class="headerlink" href="#001-verify-ansible-callback_plugins" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>[callback_plugins]</code> section specifies directories where Ansible looks for callback plugins, which can customize output or trigger actions based on playbook events.
    <div class="language-ini highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#001-verify-ansible-__codelineno-0-1"></a><span class="k">[callback_plugins]</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#001-verify-ansible-__codelineno-0-2"></a><span class="w">    </span><span class="na">stdout_callback</span><span class="w">     </span><span class="o">=</span><span class="w">    </span><span class="s">yaml</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#001-verify-ansible-__codelineno-0-3"></a><span class="w">    </span><span class="na">callback_whitelist</span><span class="w">  </span><span class="o">=</span><span class="w">    </span><span class="s">timer, profile_tasks</span>
</span></code></pre></div></li>
</ul>
<h3 id="001-verify-ansible-connection"><code>[connection]</code><a class="headerlink" href="#001-verify-ansible-connection" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>[connection]</code> section defines general connection settings that apply to all connection types.
    <div class="language-ini highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#001-verify-ansible-__codelineno-1-1"></a><span class="k">[connection]</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#001-verify-ansible-__codelineno-1-2"></a><span class="w">    </span><span class="na">pipelining</span><span class="w">          </span><span class="o">=</span><span class="w">    </span><span class="s">True</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#001-verify-ansible-__codelineno-1-3"></a><span class="w">    </span><span class="na">control_path_dir</span><span class="w">    </span><span class="o">=</span><span class="w">    </span><span class="s">~/.ansible/cp</span>
</span></code></pre></div></li>
</ul>
<h3 id="001-verify-ansible-defaults"><code>[defaults]</code><a class="headerlink" href="#001-verify-ansible-defaults" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>[defaults]</code> section contains the general settings for Ansible (such as inventory location, verbosity and log settings).</li>
<li>It is the most commonly used section and is often the first place users look to customize their Ansible environment.</li>
<li>
<p>Here are some commonly used settings in the <code>[defaults]</code> section:</p>
<ul>
<li><code>ask_pass</code> - If set to true, Ansible will prompt for the SSH password.</li>
<li><code>host_key_checking</code> - If set to false, Ansible will not check SSH host keys.</li>
<li><code>inventory</code> - Specifies the path to the inventory file.</li>
<li><code>log_path</code> - Specifies the path to the log file.</li>
<li><code>remote_user</code> - Specifies the default remote user for SSH connections.</li>
<li><code>timeout</code> - Specifies the timeout for SSH connections in seconds.</li>
<li><code>private_key_file</code> - Specifies the path to the private key file for SSH authentication.</li>
<li><code>become</code> - If set to true, privilege escalation (e.g., sudo) will be used.</li>
<li><code>become_method</code> - Specifies the method to use for privilege escalation (e.g., sudo, su).</li>
<li><code>become_user</code> - Specifies the user to become when using privilege escalation.</li>
<li><code>retry_files_enabled</code> - If set to false, Ansible will not create retry files.</li>
<li><code>gathering</code> - Specifies how facts are gathered (e.g., smart, explicit, none).</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#001-verify-ansible-__codelineno-2-1"></a><span class="k">[defaults]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#001-verify-ansible-__codelineno-2-2"></a><span class="w">    </span><span class="na">ask_pass</span><span class="w">            </span><span class="o">=</span><span class="w">    </span><span class="s">false</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#001-verify-ansible-__codelineno-2-3"></a><span class="w">    </span><span class="na">host_key_checking</span><span class="w">   </span><span class="o">=</span><span class="w">    </span><span class="s">false</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#001-verify-ansible-__codelineno-2-4"></a><span class="w">    </span><span class="na">inventory</span><span class="w">           </span><span class="o">=</span><span class="w">    </span><span class="s">/etc/ansible/hosts</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#001-verify-ansible-__codelineno-2-5"></a><span class="w">    </span><span class="na">log_path</span><span class="w">            </span><span class="o">=</span><span class="w">    </span><span class="s">/var/log/ansible.log</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#001-verify-ansible-__codelineno-2-6"></a><span class="w">    </span><span class="na">remote_user</span><span class="w">         </span><span class="o">=</span><span class="w">    </span><span class="s">ansible</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#001-verify-ansible-__codelineno-2-7"></a><span class="w">    </span><span class="na">timeout</span><span class="w">             </span><span class="o">=</span><span class="w">    </span><span class="s">30</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="001-verify-ansible-diff"><code>[diff]</code><a class="headerlink" href="#001-verify-ansible-diff" title="Permanent link">&para;</a></h3>
<ul>
<li>Controls whether Ansible shows differences when applying configurations.</li>
<li>
<p>This can be useful for debugging and understanding changes.</p>
<ul>
<li><code>always</code> - Show differences even when the playbook is not run in check mode.</li>
<li><code>context</code> - The number of lines of context to show around changes.</li>
<li><code>ignore</code> - Do not show differences.</li>
<li><code>diff</code> - Show a unified diff of changes.</li>
<li><code>unified</code> - Show a unified diff of changes with context lines.</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#001-verify-ansible-__codelineno-3-1"></a><span class="k">[diff]</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#001-verify-ansible-__codelineno-3-2"></a><span class="w">    </span><span class="na">always</span><span class="w">              </span><span class="o">=</span><span class="w">    </span><span class="s">True</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#001-verify-ansible-__codelineno-3-3"></a><span class="w">    </span><span class="na">context</span><span class="w">             </span><span class="o">=</span><span class="w">    </span><span class="s">5</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="001-verify-ansible-galaxy"><code>[galaxy]</code><a class="headerlink" href="#001-verify-ansible-galaxy" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>[galaxy]</code> section configures settings for Ansible Galaxy, which is a hub for sharing and downloading Ansible roles and collections.</li>
<li>This section can be used to specify custom Galaxy servers, caching options, and other related settings.</li>
<li>
<p>Here is an example configuration for the <code>[galaxy]</code> section:</p>
<ul>
<li><code>server_list</code> - Specifies the list of Galaxy servers to use.</li>
<li><code>cache_dir</code> - Specifies the directory to cache downloaded roles and collections.</li>
<li><code>role_file</code> - Specifies the path to the file containing role definitions.</li>
<li><code>collection_file</code> - Specifies the path to the file containing collection definitions.</li>
<li><code>requirements_file</code> - Specifies the path to the file containing Galaxy requirements.</li>
<li><code>role_file</code> - Specifies the path to the file containing role definitions.</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#001-verify-ansible-__codelineno-4-1"></a><span class="k">[galaxy]</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#001-verify-ansible-__codelineno-4-2"></a><span class="w">    </span><span class="na">server_list</span><span class="w">         </span><span class="o">=</span><span class="w">    </span><span class="s">release_galaxy</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#001-verify-ansible-__codelineno-4-3"></a><span class="w">    </span><span class="na">cache_dir</span><span class="w">           </span><span class="o">=</span><span class="w">    </span><span class="s">~/.ansible/galaxy_cache</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="001-verify-ansible-inventory"><code>[inventory]</code><a class="headerlink" href="#001-verify-ansible-inventory" title="Permanent link">&para;</a></h3>
<ul>
<li>Defines options related to inventory parsing and caching.</li>
<li>Inventory is a critical component of Ansible, as it defines the hosts and groups of hosts that Ansible will manage.</li>
<li>The inventory can be specified in various formats, including <code>INI</code> files, <code>YAML</code> files, and dynamic inventory scripts.</li>
<li>The inventory can also be cached to improve performance.</li>
<li>
<p>Here are some commonly used settings in the <code>[inventory]</code> section:</p>
<ul>
<li><code>enable_plugins</code> - Specifies the inventory plugins to use.</li>
<li><code>cache</code> - If set to true, inventory caching will be enabled.</li>
<li><code>cache_plugin</code> - Specifies the inventory cache plugin to use.</li>
<li><code>cache_timeout</code> - Specifies the timeout for inventory caching in seconds.</li>
<li><code>inventory_ignore_extensions</code> - Specifies file extensions to ignore when loading inventory files.</li>
<li><code>inventory_loader</code> - Specifies the inventory loader to use.</li>
<li><code>strict</code> - If set to true, Ansible will enforce strict inventory parsing.</li>
<li><code>host_key_checking</code> - If set to true, Ansible will check SSH host keys for inventory hosts.</li>
<li><code>enable_inventory_cache</code> - If set to true, inventory caching will be enabled.</li>
<li><code>inventory_cache_timeout</code> - Specifies the timeout for inventory caching in seconds.</li>
<li><code>inventory_cache_connection</code> - Specifies the connection string for the inventory cache plugin.</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#001-verify-ansible-__codelineno-5-1"></a><span class="k">[inventory]</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#001-verify-ansible-__codelineno-5-2"></a><span class="w">    </span><span class="na">enable_plugins</span><span class="w">      </span><span class="o">=</span><span class="w">    </span><span class="s">host_list, ini, auto</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#001-verify-ansible-__codelineno-5-3"></a><span class="w">    </span><span class="na">cache</span><span class="w">               </span><span class="o">=</span><span class="w">    </span><span class="s">True</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#001-verify-ansible-__codelineno-5-4"></a><span class="w">    </span><span class="na">cache_plugin</span><span class="w">        </span><span class="o">=</span><span class="w">    </span><span class="s">memory</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#001-verify-ansible-__codelineno-5-5"></a><span class="w">    </span><span class="na">cache_timeout</span><span class="w">       </span><span class="o">=</span><span class="w">    </span><span class="s">3600</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="001-verify-ansible-logging"><code>[logging]</code><a class="headerlink" href="#001-verify-ansible-logging" title="Permanent link">&para;</a></h3>
<ul>
<li>Ansible does not have a dedicated <code>[logging]</code> section in <code>ansible.cfg</code>. </li>
<li>Instead, logging is typically configured under the <code>[defaults]</code> section using the <code>log_path</code> directive.</li>
<li><code>log_path</code> controls where Ansible logs its output. </li>
<li>If <code>log_path</code> is set, Ansible will write logs to the specified file, where as if it is not set, or left empty, logging will be disabled.</li>
<li>Here is an example of how to configure logging in the <code>[defaults]</code> section:
    <div class="language-ini highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#001-verify-ansible-__codelineno-6-1"></a><span class="k">[defaults]</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#001-verify-ansible-__codelineno-6-2"></a><span class="w">    </span><span class="na">log_path</span><span class="w">            </span><span class="o">=</span><span class="w">     </span><span class="s">/var/log/ansible.log</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#001-verify-ansible-__codelineno-6-3"></a><span class="w">    </span><span class="na">log_level</span><span class="w">           </span><span class="o">=</span><span class="w">     </span><span class="s">info</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#001-verify-ansible-__codelineno-6-4"></a><span class="w">    </span><span class="na">log_format</span><span class="w">          </span><span class="o">=</span><span class="w">     </span><span class="s">default</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#001-verify-ansible-__codelineno-6-5"></a><span class="w">    </span><span class="na">log_date_format</span><span class="w">     </span><span class="o">=</span><span class="w">     </span><span class="s">iso8601</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#001-verify-ansible-__codelineno-6-6"></a><span class="w">    </span><span class="na">log_ansi</span><span class="w">            </span><span class="o">=</span><span class="w">     </span><span class="s">True</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#001-verify-ansible-__codelineno-6-7"></a><span class="w">    </span><span class="na">log_color</span><span class="w">           </span><span class="o">=</span><span class="w">     </span><span class="s">auto</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#001-verify-ansible-__codelineno-6-8"></a><span class="w">    </span><span class="na">log_file</span><span class="w">            </span><span class="o">=</span><span class="w">     </span><span class="s">/var/log/ansible.log</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#001-verify-ansible-__codelineno-6-9"></a><span class="w">    </span><span class="na">log_rotate</span><span class="w">          </span><span class="o">=</span><span class="w">     </span><span class="s">True</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#001-verify-ansible-__codelineno-6-10"></a><span class="w">    </span><span class="na">log_max_size</span><span class="w">        </span><span class="o">=</span><span class="w">     </span><span class="s">10485760</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#001-verify-ansible-__codelineno-6-11"></a><span class="w">    </span><span class="na">log_compress</span><span class="w">        </span><span class="o">=</span><span class="w">     </span><span class="s">True</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#001-verify-ansible-__codelineno-6-12"></a><span class="w">    </span><span class="na">log_backup_count</span><span class="w">    </span><span class="o">=</span><span class="w">     </span><span class="s">5</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#001-verify-ansible-__codelineno-6-13"></a><span class="w">    </span><span class="na">log_http</span><span class="w">            </span><span class="o">=</span><span class="w">     </span><span class="s">False</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#001-verify-ansible-__codelineno-6-14"></a><span class="w">    </span><span class="na">log_json</span><span class="w">            </span><span class="o">=</span><span class="w">     </span><span class="s">True</span>
</span></code></pre></div></li>
</ul>
<h3 id="001-verify-ansible-paramiko_connection"><code>[paramiko_connection]</code><a class="headerlink" href="#001-verify-ansible-paramiko_connection" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>[paramiko_connection]</code> section configures settings specific to the Paramiko SSH library, an alternative to OpenSSH for SSH connections.</li>
<li>
<p>Here are some commonly used settings in the <code>[paramiko_connection]</code> section:</p>
<ul>
<li><code>pty</code> - If set to true, a pseudo-terminal will be allocated for the connection.</li>
<li><code>look_for_keys</code> - If set to true, Paramiko will look for SSH keys</li>
<li><code>banner_timeout</code> - Specifies the timeout for receiving the SSH banner.</li>
<li><code>keepalive</code> - If set to true, keepalive messages will be sent to</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#001-verify-ansible-__codelineno-7-1"></a><span class="k">[paramiko_connection]</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#001-verify-ansible-__codelineno-7-2"></a><span class="w">    </span><span class="na">pty</span><span class="w">                 </span><span class="o">=</span><span class="w">    </span><span class="s">False</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#001-verify-ansible-__codelineno-7-3"></a><span class="w">    </span><span class="na">look_for_keys</span><span class="w">       </span><span class="o">=</span><span class="w">    </span><span class="s">True</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="001-verify-ansible-privilege_escalation"><code>[privilege_escalation]</code><a class="headerlink" href="#001-verify-ansible-privilege_escalation" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>[privilege_escalation]</code> section defines settings related to privilege escalation (such as <strong><code>sudo</code></strong> or <strong><code>become</code></strong>).</li>
<li>
<p>The <code>become</code> directive is used to enable privilege escalation.</p>
</li>
<li>
<p>Here are some commonly used settings in the <code>[privilege_escalation]</code> section:</p>
<ul>
<li><code>become</code> - If set to true, privilege escalation will be used.</li>
<li><code>become_method</code> - Specifies the method to use for privilege escalation (e.g., sudo, su).</li>
<li><code>become_user</code> - Specifies the user to become when using privilege escalation.</li>
<li><code>become_ask_pass</code> - If set to true, Ansible will prompt for the privilege escalation password.</li>
<li><code>become_flags</code> - Specifies any additional flags to pass to the privilege escalation command.</li>
<li><code>become_exe</code> - Specifies the path to the privilege escalation executable.</li>
<li><code>become_pass</code> - Specifies the password to use for privilege escalation.</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#001-verify-ansible-__codelineno-8-1"></a><span class="k">[privilege_escalation]</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#001-verify-ansible-__codelineno-8-2"></a><span class="w">    </span><span class="na">become</span><span class="w">              </span><span class="o">=</span><span class="w">    </span><span class="s">True</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#001-verify-ansible-__codelineno-8-3"></a><span class="w">    </span><span class="na">become_method</span><span class="w">       </span><span class="o">=</span><span class="w">    </span><span class="s">sudo</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#001-verify-ansible-__codelineno-8-4"></a><span class="w">    </span><span class="na">become_user</span><span class="w">         </span><span class="o">=</span><span class="w">    </span><span class="s">root</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#001-verify-ansible-__codelineno-8-5"></a><span class="w">    </span><span class="na">become_ask_pass</span><span class="w">     </span><span class="o">=</span><span class="w">    </span><span class="s">False</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="001-verify-ansible-ssh_connection"><code>[ssh_connection]</code><a class="headerlink" href="#001-verify-ansible-ssh_connection" title="Permanent link">&para;</a></h3>
<ul>
<li>Settings for SSH connections, (timeout, control settings etc).</li>
<li>ControlMaster and ControlPersist options are used for SSH multiplexing, allowing multiple SSH sessions to share a single connection.</li>
<li><code>ssh_args</code> can be used to pass additional options to the SSH command.</li>
<li><code>pipelining</code> can be enabled to reduce the number of SSH connections.</li>
<li>
<p><code>scp_if_ssh</code> specifies whether to use <code>SCP</code> for file transfers when using SSH.</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#001-verify-ansible-__codelineno-9-1"></a><span class="k">[ssh_connection]</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#001-verify-ansible-__codelineno-9-2"></a><span class="w">    </span><span class="na">ssh_args</span><span class="w">            </span><span class="o">=</span><span class="w">    </span><span class="s">-o ControlMaster=auto -o ControlPersist=60s</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#001-verify-ansible-__codelineno-9-3"></a><span class="w">    </span><span class="na">pipelining</span><span class="w">          </span><span class="o">=</span><span class="w">    </span><span class="s">True</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#001-verify-ansible-__codelineno-9-4"></a><span class="w">    </span><span class="na">scp_if_ssh</span><span class="w">          </span><span class="o">=</span><span class="w">    </span><span class="s">True</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="001-verify-ansible-winrm"><code>[winrm]</code><a class="headerlink" href="#001-verify-ansible-winrm" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>[winrm]</code> section configures settings for Windows Remote Management (WinRM) connections, used for managing Windows hosts.</li>
<li>
<p>Here are some commonly used settings in the <code>[winrm]</code> section:</p>
<ul>
<li><code>transport</code> - Specifies the transport method to use (e.g., basic, ntlm).</li>
<li><code>cert_validation</code> - Controls certificate validation (e.g., ignore, validate).</li>
<li><code>read_timeout_sec</code> - Specifies the read timeout for WinRM connections in seconds.</li>
<li><code>operation_timeout_sec</code> - Specifies the operation timeout for WinRM connections in seconds.</li>
<li><code>max_retries</code> - Specifies the maximum number of retries for WinRM connections.</li>
<li><code>retry_delay</code> - Specifies the delay between retries for WinRM connections.</li>
</ul>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#001-verify-ansible-__codelineno-10-1"></a><span class="k">[winrm]</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#001-verify-ansible-__codelineno-10-2"></a><span class="w">    </span><span class="na">transport</span><span class="w">           </span><span class="o">=</span><span class="w">    </span><span class="s">basic</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#001-verify-ansible-__codelineno-10-3"></a><span class="w">    </span><span class="na">cert_validation</span><span class="w">     </span><span class="o">=</span><span class="w">    </span><span class="s">ignore</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="001-verify-ansible-05-auto-generate-ansiblecfg">05. Auto Generate <code>ansible.cfg</code><a class="headerlink" href="#001-verify-ansible-05-auto-generate-ansiblecfg" title="Permanent link">&para;</a></h2>
<ul>
<li>You can choose to execute <code>ansible-config init</code>, which will generate a sample Ansible configuration file. </li>
<li>
<p>As this is the main configuration file for our demo application, it is the content of <code>ansible.cfg</code> which we will use in this lab.</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#001-verify-ansible-__codelineno-11-1"></a><span class="c1"># File location: $RUNTIME_FOLDER/labs-scripts/ansible.cfg.</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#001-verify-ansible-__codelineno-11-2"></a><span class="c1"># This is the default location of the inventory file, script, or directory that </span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#001-verify-ansible-__codelineno-11-3"></a><span class="na">Ansible will use to determine what hosts it has available to talk to.</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#001-verify-ansible-__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#001-verify-ansible-__codelineno-11-5"></a><span class="c1"># Defines that the inventory info is in a file named ‚Äúinventory‚Äù.</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#001-verify-ansible-__codelineno-11-6"></a><span class="k">[defaults]</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#001-verify-ansible-__codelineno-11-7"></a><span class="w">    </span><span class="na">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">inventory</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#001-verify-ansible-__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#001-verify-ansible-__codelineno-11-9"></a><span class="c1"># Specifies remote hosts, so we do not need to config them in main SSH config.</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#001-verify-ansible-__codelineno-11-10"></a><span class="k">[ssh_connection]</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#001-verify-ansible-__codelineno-11-11"></a><span class="w">    </span><span class="na">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">ssh</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#001-verify-ansible-__codelineno-11-12"></a><span class="w">    </span><span class="na">transfer_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">scp</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#001-verify-ansible-__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#001-verify-ansible-__codelineno-11-14"></a><span class="w">    </span><span class="c1"># The location of the SSH config file.</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#001-verify-ansible-__codelineno-11-15"></a><span class="w">    </span><span class="c1"># We will create this file in our next step.</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#001-verify-ansible-__codelineno-11-16"></a><span class="w">    </span><span class="na">ssh_args</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">-F ssh.config                   </span>\
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#001-verify-ansible-__codelineno-11-17"></a><span class="w">                </span><span class="s">-o ControlMaster=auto           </span>\
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#001-verify-ansible-__codelineno-11-18"></a><span class="w">                </span><span class="s">-o ControlPersist=60s           </span>\
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#001-verify-ansible-__codelineno-11-19"></a><span class="w">                </span><span class="s">-o StrictHostKeyChecking=no     </span>\
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#001-verify-ansible-__codelineno-11-20"></a><span class="w">                </span><span class="s">-o UserKnownHostsFile=/root/.ssh/known_hosts</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="001-verify-ansible-06-create-the-sshconfig-file">06. Create the <code>ssh.config</code> file<a class="headerlink" href="#001-verify-ansible-06-create-the-sshconfig-file" title="Permanent link">&para;</a></h2>
<ul>
<li>Ansible operates in Linux environments using <code>SSH</code> protocol, in order to run Ansible playbooks.</li>
<li>By default, Ansible uses the default SSH keys, unless provided with an SSH configuration file.</li>
<li>Ansible ssh.config file allows you to define custom SSH settings for connecting to remote hosts.</li>
<li>In this demo we will use our own <code>ssh.config</code> configuration file.
    <div class="language-ini highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#001-verify-ansible-__codelineno-12-1"></a><span class="c1"># File location: $RUNTIME_FOLDER/labs-scripts/ssh.config</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#001-verify-ansible-__codelineno-12-2"></a><span class="c1"># Set up the desired hosts</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#001-verify-ansible-__codelineno-12-3"></a><span class="c1"># keep in mind that we have set up the hosts in the docker-compose</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#001-verify-ansible-__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#001-verify-ansible-__codelineno-12-5"></a><span class="na">Host *</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#001-verify-ansible-__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#001-verify-ansible-__codelineno-12-7"></a><span class="c1"># Disable host key checking</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#001-verify-ansible-__codelineno-12-8"></a><span class="c1"># Avoid asking for the key-print authenticity</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#001-verify-ansible-__codelineno-12-9"></a><span class="na">StrictHostKeyChecking no        </span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#001-verify-ansible-__codelineno-12-10"></a><span class="na">UserKnownHostsFile    /dev/null</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#001-verify-ansible-__codelineno-12-11"></a>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#001-verify-ansible-__codelineno-12-12"></a><span class="c1"># Enable hashing known_host file</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#001-verify-ansible-__codelineno-12-13"></a><span class="na">HashKnownHosts        yes</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#001-verify-ansible-__codelineno-12-14"></a>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#001-verify-ansible-__codelineno-12-15"></a><span class="c1"># IdentityFile allows to specify private keys we wish to use for authentication</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#001-verify-ansible-__codelineno-12-16"></a><span class="c1"># Authentication = the process of authentication</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#001-verify-ansible-__codelineno-12-17"></a><span class="c1"># We will use the auto-generated SSH keys from our Docker container</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#001-verify-ansible-__codelineno-12-18"></a>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#001-verify-ansible-__codelineno-12-19"></a><span class="c1"># List the desired servers</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#001-verify-ansible-__codelineno-12-20"></a><span class="c1"># The hosts are defined in the docker-compose which we created in the setup lab</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#001-verify-ansible-__codelineno-12-21"></a>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#001-verify-ansible-__codelineno-12-22"></a><span class="na">Host                  linux-server-1</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#001-verify-ansible-__codelineno-12-23"></a><span class="w">    </span><span class="na">HostName          linux-server-1</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#001-verify-ansible-__codelineno-12-24"></a><span class="w">    </span><span class="na">IdentityFile      /root/.ssh/linux-server-1</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#001-verify-ansible-__codelineno-12-25"></a><span class="w">    </span><span class="na">User              root</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#001-verify-ansible-__codelineno-12-26"></a><span class="w">    </span><span class="na">Port              22</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#001-verify-ansible-__codelineno-12-27"></a>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#001-verify-ansible-__codelineno-12-28"></a><span class="na">Host                  linux-server-2</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#001-verify-ansible-__codelineno-12-29"></a><span class="w">    </span><span class="na">HostName          linux-server-2</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#001-verify-ansible-__codelineno-12-30"></a><span class="w">    </span><span class="na">IdentityFile      /root/.ssh/linux-server-2</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#001-verify-ansible-__codelineno-12-31"></a><span class="w">    </span><span class="na">User              root</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#001-verify-ansible-__codelineno-12-32"></a><span class="w">    </span><span class="na">Port              22</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#001-verify-ansible-__codelineno-12-33"></a>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#001-verify-ansible-__codelineno-12-34"></a><span class="na">Host                  linux-server-3</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#001-verify-ansible-__codelineno-12-35"></a><span class="w">    </span><span class="na">HostName          linux-server-3</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#001-verify-ansible-__codelineno-12-36"></a><span class="w">    </span><span class="na">IdentityFile      /root/.ssh/linux-server-3</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#001-verify-ansible-__codelineno-12-37"></a><span class="w">    </span><span class="na">User              root</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#001-verify-ansible-__codelineno-12-38"></a><span class="w">    </span><span class="na">Port              22</span>
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="001-verify-ansible-07-create-the-inventory-file">07. Create the <code>inventory</code> file<a class="headerlink" href="#001-verify-ansible-07-create-the-inventory-file" title="Permanent link">&para;</a></h2>
<ul>
<li>See Ansible documentation: <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html">How to build your inventory</a>.</li>
<li>An Ansible inventory file is a <code>configuration file</code> that <strong>lists and categorizes</strong> the hosts Ansible will <strong>manage</strong>. </li>
<li>It provides a structured way to define <code>hosts</code> and <code>groups</code>, enabling efficient targeting and execution of tasks on specific hosts or groups of hosts.</li>
<li>The simplest inventory is a <strong>single file</strong> with a list of <code>hosts</code> and <code>groups</code>.</li>
<li>The inventory is written using the <code>INI</code> format.</li>
<li><code>inventory</code> can be written in other formats as well, such as <code>YAML</code> and <code>Dynamic Inventory</code> which dynamically configure the inventory with scripts. </li>
<li>The default location for this file is <code>/etc/ansible/hosts</code>.</li>
<li>If <code>/etc/ansible/hosts</code> doesn&rsquo;t exists, ansible will look for user specific inventory file, to be placed at <code>$HOME/.ansible/hosts</code></li>
<li>You can specify a different inventory file at the command line using the <code>-i &lt;path&gt;</code> inventory option when executing Ansible commands or by exporting the <code>ANSIBLE_INVENTORY</code> environment variable.</li>
<li>Using <code>-i &lt;path&gt;</code> inventory option takes precedence over environment variable.</li>
<li>The inventory configuration we will use for the labs:
    <div class="language-ini highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#001-verify-ansible-__codelineno-13-1"></a><span class="c1"># File location: $RUNTIME_FOLDER/labs-scripts/inventory</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#001-verify-ansible-__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#001-verify-ansible-__codelineno-13-3"></a><span class="c1"># List of servers which we want ansible to connect to</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#001-verify-ansible-__codelineno-13-4"></a><span class="c1"># The names are defined in the docker-compose</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#001-verify-ansible-__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#001-verify-ansible-__codelineno-13-6"></a><span class="k">[servers]</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#001-verify-ansible-__codelineno-13-7"></a><span class="w">    </span><span class="na">linux-server-1 ansible_ssh_common_args</span><span class="o">=</span><span class="s">&#39;-o UserKnownHostsFile=/root/.ssh/known_hosts&#39;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#001-verify-ansible-__codelineno-13-8"></a><span class="w">    </span><span class="na">linux-server-2 ansible_ssh_common_args</span><span class="o">=</span><span class="s">&#39;-o UserKnownHostsFile=/root/.ssh/known_hosts&#39;</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#001-verify-ansible-__codelineno-13-9"></a><span class="w">    </span><span class="na">linux-server-3 ansible_ssh_common_args</span><span class="o">=</span><span class="s">&#39;-o UserKnownHostsFile=/root/.ssh/known_hosts&#39;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#001-verify-ansible-__codelineno-13-10"></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#001-verify-ansible-__codelineno-13-11"></a><span class="k">[all:vars]</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#001-verify-ansible-__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#001-verify-ansible-__codelineno-13-13"></a><span class="c1"># Extra &quot;global&quot; variables for the inventory</span>
</span></code></pre></div></li>
</ul>
<p><strong>This inventory file is written following these rules:</strong></p>
<ul>
<li>Information is described by <strong>one node per line</strong>, such as <code>linux-server-xx</code>.</li>
<li>A node line consists of an <code>identifier of the node (ex. linux-server-X)</code> and a <code>host variable(s) (ex. ansible_host=xxxx)</code>, to be given to the node .</li>
<li>You can also specify an IP address or FQDN for the <code>linux-server-xx</code> part.</li>
<li>You can create a group of hosts with <code>[group_name]</code>. In our inventory the group name is <code>[servers]</code>.</li>
<li>
<p>You can use any group name except <code>[all]</code> and <code>[localhost]</code> (e.g., <code>[webservers]</code> or <code>[databases]</code> can be used as <strong>group</strong> names for servers).</p>
<p><strong><code>[all]</code></strong></p>
<ul>
<li><code>all</code> is a special group that points to all nodes described in the inventory.</li>
<li>The <code>[all:vars]</code> &amp; <code>group variables</code> are defined for the group <code>all</code>.<ul>
<li>When we use a <strong>group</strong>, we can use the whole group as &ldquo;hosts&rdquo; for ansible.</li>
</ul>
</li>
<li>A <a href="https://docs.ansible.com/ansible/latest/reference_appendices/special_variables.html">magic variable</a>, represented by <code>ansible_xxxx</code>, 
contains special values that control Ansible&rsquo;s behavior and environment information that Ansible will automatically retrieve.  </li>
<li>Details are explained in the <a href="#001-verify-ansible-need to add a link to variables section">variables section</a>.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="001-verify-ansible-08-prepare-for-execution">08. Prepare for execution<a class="headerlink" href="#001-verify-ansible-08-prepare-for-execution" title="Permanent link">&para;</a></h2>
<ul>
<li>Place the files under the shared folder or simply execute the script <a href="../001-verify-ansible/Labs/000-setup/02-init-ansible.sh">/Labs/000-setup/02-init-ansible.sh</a></li>
<li>Verify that the controller can execute ansible <a href="../001-verify-ansible/Labs/000-setup/01-init-servers.sh">/Labs/000-setup/01-init-servers.sh</a></li>
</ul>
<hr />
<h2 id="001-verify-ansible-09-test-ansible-configuration">09. Test Ansible configuration<a class="headerlink" href="#001-verify-ansible-09-test-ansible-configuration" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Now we are ready to start play with <code>Ansible</code>!</p>
</li>
<li>
<p>The first step is to test <code>Ansible</code> configuration
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#001-verify-ansible-__codelineno-14-1"></a><span class="c1"># Verify that Ansible is installed correctly</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#001-verify-ansible-__codelineno-14-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>ansible<span class="w"> </span>--version
</span></code></pre></div></p>
</li>
<li>
<p>Sample output</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#001-verify-ansible-__codelineno-15-1"></a>ansible<span class="w"> </span><span class="o">[</span>core<span class="w"> </span><span class="m">2</span>.17.9<span class="o">]</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#001-verify-ansible-__codelineno-15-2"></a>config<span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/labs-scripts/ansible.cfg
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#001-verify-ansible-__codelineno-15-3"></a>configured<span class="w"> </span>module<span class="w"> </span>search<span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;/root/.ansible/plugins/modules&#39;</span>,<span class="w"> </span><span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="o">]</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#001-verify-ansible-__codelineno-15-4"></a>ansible<span class="w"> </span>python<span class="w"> </span>module<span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/usr/lib/python3/dist-packages/ansible
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#001-verify-ansible-__codelineno-15-5"></a>ansible<span class="w"> </span>collection<span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/root/.ansible/collections:/usr/share/ansible/collections
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#001-verify-ansible-__codelineno-15-6"></a>executable<span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/usr/bin/ansible
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#001-verify-ansible-__codelineno-15-7"></a>python<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>.12.3<span class="w"> </span><span class="o">(</span>main,<span class="w"> </span>Feb<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">2025</span>,<span class="w"> </span><span class="m">14</span>:48:35<span class="o">)</span><span class="w"> </span><span class="o">[</span>GCC<span class="w"> </span><span class="m">13</span>.3.0<span class="o">]</span><span class="w"> </span><span class="o">(</span>/usr/bin/python3<span class="o">)</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#001-verify-ansible-__codelineno-15-8"></a>jinja<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>.1.2
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#001-verify-ansible-__codelineno-15-9"></a><span class="nv">libyaml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</span></code></pre></div>
</li>
<li>
<p>We are looking for the following line:
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#001-verify-ansible-__codelineno-16-1"></a>config<span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/labs-scripts/ansible.cfg
</span></code></pre></div></p>
</li>
</ul>
<hr />
<h2 id="001-verify-ansible-10-basic-ansible-configuration">10. Basic ansible configuration<a class="headerlink" href="#001-verify-ansible-10-basic-ansible-configuration" title="Permanent link">&para;</a></h2>
<ul>
<li>Once all is ready, lets check if the controller can connect to the servers with the Ansible <code>ping</code> command.</li>
<li>
<p><code>ping</code> is an <code>Ad-Hoc</code> Ansible command that we will cover later on.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#001-verify-ansible-__codelineno-17-1"></a><span class="c1"># Ping the servers and check that they are &quot;alive&quot;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#001-verify-ansible-__codelineno-17-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible all -m ping&quot;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#001-verify-ansible-__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#001-verify-ansible-__codelineno-17-4"></a><span class="c1">### Output</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#001-verify-ansible-__codelineno-17-5"></a>*<span class="w"> </span>Executing:<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#001-verify-ansible-__codelineno-17-6"></a>linux-server-2<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#001-verify-ansible-__codelineno-17-7"></a><span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#001-verify-ansible-__codelineno-17-8"></a><span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/bin/python3&quot;</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#001-verify-ansible-__codelineno-17-9"></a><span class="w">    </span><span class="o">}</span>,
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#001-verify-ansible-__codelineno-17-10"></a><span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#001-verify-ansible-__codelineno-17-11"></a><span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#001-verify-ansible-__codelineno-17-12"></a><span class="o">}</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#001-verify-ansible-__codelineno-17-13"></a>linux-server-1<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#001-verify-ansible-__codelineno-17-14"></a><span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#001-verify-ansible-__codelineno-17-15"></a><span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/bin/python3&quot;</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#001-verify-ansible-__codelineno-17-16"></a><span class="w">    </span><span class="o">}</span>,
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#001-verify-ansible-__codelineno-17-17"></a><span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#001-verify-ansible-__codelineno-17-18"></a><span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#001-verify-ansible-__codelineno-17-19"></a><span class="o">}</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#001-verify-ansible-__codelineno-17-20"></a>linux-server-3<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#001-verify-ansible-__codelineno-17-21"></a><span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#001-verify-ansible-__codelineno-17-22"></a><span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/bin/python3&quot;</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#001-verify-ansible-__codelineno-17-23"></a><span class="w">    </span><span class="o">}</span>,
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#001-verify-ansible-__codelineno-17-24"></a><span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#001-verify-ansible-__codelineno-17-25"></a><span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#001-verify-ansible-__codelineno-17-26"></a><span class="o">}</span>
</span></code></pre></div>
</li>
</ul></section><section class="print-page" id="002-no-inventory" heading-number="2.4"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-002.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-002.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="002-no-inventory-lab-002-no-inventory">Lab 002 - No Inventory<a class="headerlink" href="#002-no-inventory-lab-002-no-inventory" title="Permanent link">&para;</a></h1>
<ul>
<li>In this lab we will learn about Ansible inventory and how it affects automation tasks.</li>
<li>We will start with an empty inventory and observe Ansible‚Äôs behavior with no hosts defined. Later, we will create and test the inventory file.</li>
<li>This lab is based upon the previous lab and its docker-compose setup.</li>
</ul>
<h3 id="002-no-inventory-pre-requirements">Pre-Requirements<a class="headerlink" href="#002-no-inventory-pre-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>Complete the <a href="#001-verify-ansible-usage">previous lab</a> in order to have <code>Ansible</code> configured.</li>
</ul>
<hr />
<h3 id="002-no-inventory-01-clear-the-inventory">01. &ldquo;Clear&rdquo; the inventory<a class="headerlink" href="#002-no-inventory-01-clear-the-inventory" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s clear the inventory from previous labs and walk through what is <code>inventory</code>.</li>
</ul>
<hr />
<h3 id="002-no-inventory-02-create-the-inventory-file">02. Create the <code>inventory</code> file<a class="headerlink" href="#002-no-inventory-02-create-the-inventory-file" title="Permanent link">&para;</a></h3>
<h4 id="002-no-inventory-ansible-inventory">Ansible Inventory<a class="headerlink" href="#002-no-inventory-ansible-inventory" title="Permanent link">&para;</a></h4>
<ul>
<li>An <code>Ansible</code> <code>inventory</code> can either be a single file or a <strong>collection of files</strong> </li>
<li>The <code>inventory</code> defines the <strong><code>[hosts]</code></strong> and <strong><code>[groups]</code></strong> of hosts upon which <code>Ansible</code> will operate. </li>
<li>It&rsquo;s simply a list of servers that <code>Ansible</code> can connect with and manage.</li>
</ul>
<h4 id="002-no-inventory-key-features-of-ansible-inventory">Key features of Ansible inventory<a class="headerlink" href="#002-no-inventory-key-features-of-ansible-inventory" title="Permanent link">&para;</a></h4>
<ul>
<li>Can be in various formats, such as <code>INI</code>, <code>JSON</code>, <code>YAML</code> and more.</li>
<li><code>YAML</code>  being the most common format.</li>
<li><code>inventory</code> defines the target hosts for <code>playbook</code> execution.</li>
<li><code>inventory</code> organizes hosts into <strong>logical groups</strong> for easier management.</li>
<li><code>inventory</code> can store <strong>host-specific</strong> variables and <strong>group</strong> variables.</li>
<li><code>inventory</code> supports nested groups (groups of groups).</li>
</ul>
<hr />
<h3 id="002-no-inventory-03-inventory-samples">03. <code>inventory</code> samples<a class="headerlink" href="#002-no-inventory-03-inventory-samples" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>INI</code> format
    <div class="language-ini highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#002-no-inventory-__codelineno-0-1"></a><span class="k">[webservers]</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#002-no-inventory-__codelineno-0-2"></a><span class="na">web1.example.com</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#002-no-inventory-__codelineno-0-3"></a><span class="na">web2.example.com</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#002-no-inventory-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#002-no-inventory-__codelineno-0-5"></a><span class="k">[database]</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#002-no-inventory-__codelineno-0-6"></a><span class="na">db1.example.com</span>
</span></code></pre></div></p>
</li>
<li>
<p><code>YAML</code> format
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#002-no-inventory-__codelineno-1-1"></a><span class="nt">all</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#002-no-inventory-__codelineno-1-2"></a><span class="w">    </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#002-no-inventory-__codelineno-1-3"></a><span class="w">        </span><span class="nt">web1.example.com</span><span class="p">:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#002-no-inventory-__codelineno-1-4"></a><span class="w">        </span><span class="nt">web2.example.com</span><span class="p">:</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#002-no-inventory-__codelineno-1-5"></a><span class="w">    </span><span class="nt">children</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#002-no-inventory-__codelineno-1-6"></a><span class="w">        </span><span class="nt">database</span><span class="p">:</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#002-no-inventory-__codelineno-1-7"></a><span class="w">        </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#002-no-inventory-__codelineno-1-8"></a><span class="w">            </span><span class="nt">db1.example.com</span><span class="p">:</span>
</span></code></pre></div></p>
</li>
<li>
<p><code>JSON</code> format
    <div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#002-no-inventory-__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#002-no-inventory-__codelineno-2-2"></a><span class="nt">&quot;all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#002-no-inventory-__codelineno-2-3"></a><span class="w">    </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#002-no-inventory-__codelineno-2-4"></a><span class="w">    </span><span class="nt">&quot;web1.example.com&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#002-no-inventory-__codelineno-2-5"></a><span class="w">        </span><span class="nt">&quot;ansible_port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2222</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#002-no-inventory-__codelineno-2-6"></a><span class="w">        </span><span class="nt">&quot;http_port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#002-no-inventory-__codelineno-2-7"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#002-no-inventory-__codelineno-2-8"></a><span class="w">    </span><span class="nt">&quot;web2.example.com&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#002-no-inventory-__codelineno-2-9"></a><span class="w">        </span><span class="nt">&quot;ansible_port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2223</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#002-no-inventory-__codelineno-2-10"></a><span class="w">        </span><span class="nt">&quot;http_port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8080</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#002-no-inventory-__codelineno-2-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#002-no-inventory-__codelineno-2-12"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#002-no-inventory-__codelineno-2-13"></a><span class="w">    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#002-no-inventory-__codelineno-2-14"></a><span class="w">    </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#002-no-inventory-__codelineno-2-15"></a><span class="w">        </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#002-no-inventory-__codelineno-2-16"></a><span class="w">        </span><span class="s2">&quot;db1.example.com&quot;</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#002-no-inventory-__codelineno-2-17"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#002-no-inventory-__codelineno-2-18"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#002-no-inventory-__codelineno-2-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#002-no-inventory-__codelineno-2-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#002-no-inventory-__codelineno-2-21"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ul>
<hr />
<h4 id="002-no-inventory-inventory-types-in-ansible">Inventory types in Ansible<a class="headerlink" href="#002-no-inventory-inventory-types-in-ansible" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Static Inventory</strong></p>
<ul>
<li>This is generally a simple text file (usually in INI or YAML format) that lists the hosts and their corresponding groups.</li>
</ul>
</li>
<li>
<p><strong>Dynamic Inventory</strong></p>
<ul>
<li>This is generated by a script or a program that retrieves host information from an external source (such as cloud providers like <code>AWS</code>, <code>Azure</code>, etc.), <code>LDAP</code> or from a <code>database</code>. </li>
<li>This allows for real-time updates and adaptability as environments change.</li>
</ul>
<p>See an example of generating a <code>dynamic inventory</code> using <code>Python</code> code for fetching data from a database:</p>
<div class="codehilite"><pre><span></span><code><span class="err">```</span><span class="n">python</span>
<span class="c1">#!/usr/bin/env python</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_inventory</span><span class="p">():</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;servers.db&#39;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT hostname, group_name, ansible_user FROM servers&#39;</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="n">inventory</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hosts&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;vars&#39;</span><span class="p">:</span> <span class="p">{}}}</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">hostname</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">ansible_user</span> <span class="o">=</span> <span class="n">row</span>

        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inventory</span><span class="p">:</span>
            <span class="n">inventory</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hosts&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;vars&#39;</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="n">inventory</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;hosts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
        <span class="n">inventory</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="s1">&#39;hosts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
        <span class="n">inventory</span><span class="p">[</span><span class="n">group_name</span><span class="p">][</span><span class="s1">&#39;vars&#39;</span><span class="p">][</span><span class="s1">&#39;ansible_user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ansible_user</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">inventory</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">get_inventory</span><span class="p">()))</span>
<span class="err">```</span>
</code></pre></div>

</li>
</ol>
<hr />
<h3 id="002-no-inventory-04-lab-exercise">04. Lab exercise<a class="headerlink" href="#002-no-inventory-04-lab-exercise" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Let&rsquo;s create the inventory configuration that we will use for the labs:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#002-no-inventory-__codelineno-4-1"></a><span class="c1">### File location: $RUNTIME_FOLDER/labs-scripts/inventory</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#002-no-inventory-__codelineno-4-2"></a><span class="c1">###</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#002-no-inventory-__codelineno-4-3"></a><span class="c1">### List of servers which we want Ansible to connect to</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#002-no-inventory-__codelineno-4-4"></a><span class="c1">### The names are defined in the docker-compose</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#002-no-inventory-__codelineno-4-5"></a><span class="c1">###</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#002-no-inventory-__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#002-no-inventory-__codelineno-4-7"></a><span class="k">[servers]</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#002-no-inventory-__codelineno-4-8"></a><span class="c1"># No server will be defined at this step</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="002-no-inventory-05-no-inventory-invocation">05. No inventory invocation<a class="headerlink" href="#002-no-inventory-05-no-inventory-invocation" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Once all is ready, let&rsquo;s check if the controller can connect to the servers using <code>ping</code></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#002-no-inventory-__codelineno-5-1"></a><span class="c1"># Ping the servers and check that they are &quot;alive&quot;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#002-no-inventory-__codelineno-5-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible all -m ping&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#002-no-inventory-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#002-no-inventory-__codelineno-5-4"></a><span class="c1">## Output</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#002-no-inventory-__codelineno-5-5"></a><span class="c1">## -------------------------------------------------------------------------------</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#002-no-inventory-__codelineno-5-6"></a><span class="o">[</span>WARNING<span class="o">]</span>:<span class="w"> </span>provided<span class="w"> </span>hosts<span class="w"> </span>list<span class="w"> </span>is<span class="w"> </span>empty,<span class="w"> </span>only<span class="w"> </span>localhost<span class="w"> </span>is<span class="w"> </span>available.<span class="w"> </span>Note<span class="w"> </span>that
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#002-no-inventory-__codelineno-5-7"></a>the<span class="w"> </span>implicit<span class="w"> </span>localhost<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>match<span class="w"> </span><span class="s1">&#39;all&#39;</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="002-no-inventory-06-inventory-invocation">06. <code>inventory</code> invocation<a class="headerlink" href="#002-no-inventory-06-inventory-invocation" title="Permanent link">&para;</a></h3>
<ul>
<li>Fill in the inventory based upon the previous labs&rsquo; configuration and test it.</li>
<li>Verify that the inventory is defined correctly with: 
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#002-no-inventory-__codelineno-6-1"></a>ansible-inventory<span class="w"> </span>-i<span class="w"> </span>&lt;inventory_file&gt;<span class="w"> </span>--graph
</span></code></pre></div></li>
<li>Test the inventory file with
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#002-no-inventory-__codelineno-7-1"></a>ansible<span class="w"> </span>-i<span class="w"> </span>&lt;inventory_file&gt;<span class="w"> </span>-m<span class="w"> </span>ping
</span></code></pre></div></li>
<li>
<p><details>
      <summary>Suggested Solution</summary></p>
<p><div class="language-ini highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#002-no-inventory-__codelineno-8-1"></a><span class="c1">###</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#002-no-inventory-__codelineno-8-2"></a><span class="c1">### List of servers which we want ansible to connect to</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#002-no-inventory-__codelineno-8-3"></a><span class="c1">### The names are defined in the docker-compose</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#002-no-inventory-__codelineno-8-4"></a><span class="c1">###</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#002-no-inventory-__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#002-no-inventory-__codelineno-8-6"></a><span class="k">[servers]</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#002-no-inventory-__codelineno-8-7"></a><span class="w">  </span><span class="na">linux-server-1 ansible_ssh_common_args</span><span class="o">=</span><span class="s">&#39;-o UserKnownHostsFile=/root/.ssh/known_hosts&#39;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#002-no-inventory-__codelineno-8-8"></a><span class="w">  </span><span class="na">linux-server-2 ansible_ssh_common_args</span><span class="o">=</span><span class="s">&#39;-o UserKnownHostsFile=/root/.ssh/known_hosts&#39;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#002-no-inventory-__codelineno-8-9"></a><span class="w">  </span><span class="na">linux-server-3 ansible_ssh_common_args</span><span class="o">=</span><span class="s">&#39;-o UserKnownHostsFile=/root/.ssh/known_hosts&#39;</span>
</span></code></pre></div>
</details></p>
</li>
</ul></section><section class="print-page" id="003-modules" heading-number="2.5"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-003.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-003.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="003-modules-lab-003-commands-modules">Lab 003 - Commands &amp; Modules<a class="headerlink" href="#003-modules-lab-003-commands-modules" title="Permanent link">&para;</a></h1>
<ul>
<li>In this section, we will cover the <strong>Modules</strong>.</li>
<li><strong>Modules</strong> are important elements and act as the &ldquo;heart&rdquo; of <code>Ansible</code>.</li>
</ul>
<p><img src="../assets/images/ansible-engine.jpg" alt="Ansible Architecture" width="800"/></p>
<h3 id="003-modules-pre-requirements">Pre-Requirements<a class="headerlink" href="#003-modules-pre-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>Complete the <a href="#002-no-inventory-usage">previous lab</a> in order to have a working <code>Ansible</code> controller and inventory configuration.</li>
</ul>
<hr />
<h3 id="003-modules-01-what-is-a-module">01. What is a module?<a class="headerlink" href="#003-modules-01-what-is-a-module" title="Permanent link">&para;</a></h3>
<ul>
<li>A module is a unit of code in <code>Ansible</code> that performs <strong>common operations in infrastructure management</strong> (such as configuring systems, installing software and managing resources). </li>
<li><code>Ansible</code> has a <strong>huge</strong> number of modules. </li>
<li>You can browse and search <code>Ansible</code> builtin modules in the <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html#modules">Builtin Ansible modules</a>.</li>
<li>Module are used for task automation.</li>
</ul>
<hr />
<h3 id="003-modules-02-a-sample-module">02. A sample module<a class="headerlink" href="#003-modules-02-a-sample-module" title="Permanent link">&para;</a></h3>
<ul>
<li>In this lab we will explore the builtin <code>ping</code> module.</li>
<li>You can read about this module in the <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html">Ansible documentation</a>.</li>
<li>You can find the source code for this module in <a href="https://github.com/ansible/ansible/blob/devel/lib/ansible/modules/ping.py">Builtin ping module repo</a>.</li>
</ul>
<hr />
<h3 id="003-modules-03-the-ping-module">03. The ping module<a class="headerlink" href="#003-modules-03-the-ping-module" title="Permanent link">&para;</a></h3>
<blockquote>
<p><strong>From the docs:</strong></p>
<ul>
<li><em>ansible.builtin.ping</em> module ‚Äì <em>Try to connect to host, verify a usable python and return pong on success</em></li>
<li><em>This module is part of ansible-core and included in all Ansible installations.</em></li>
<li><em>In most cases, you can use the short module name <code>ping</code></em></li>
</ul>
</blockquote>
<ul>
<li>Now, as we break down the code, feel free to browse and look at the full code.</li>
</ul>
<hr />
<h3 id="003-modules-04-the-ping-source-code">04. The ping source code<a class="headerlink" href="#003-modules-04-the-ping-source-code" title="Permanent link">&para;</a></h3>
<ul>
<li>At the time of writing this tutorial, the &ldquo;implementation&rdquo; of the <code>ping</code> module is as follows:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#003-modules-__codelineno-0-1"></a><span class="n">RETURN</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#003-modules-__codelineno-0-2"></a><span class="s1">ping:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#003-modules-__codelineno-0-3"></a><span class="s1">    description:  Value provided with the O(data) parameter.</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#003-modules-__codelineno-0-4"></a><span class="s1">    returned:     success</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#003-modules-__codelineno-0-5"></a><span class="s1">    type:         str</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#003-modules-__codelineno-0-6"></a><span class="s1">    sample:       pong</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#003-modules-__codelineno-0-7"></a><span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#003-modules-__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#003-modules-__codelineno-0-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ansible.module_utils.basic</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnsibleModule</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#003-modules-__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#003-modules-__codelineno-0-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#003-modules-__codelineno-0-12"></a>    <span class="n">module</span> <span class="o">=</span> <span class="n">AnsibleModule</span><span class="p">(</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#003-modules-__codelineno-0-13"></a>        <span class="n">argument_spec</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#003-modules-__codelineno-0-14"></a>            <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;pong&#39;</span><span class="p">),</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#003-modules-__codelineno-0-15"></a>        <span class="p">),</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#003-modules-__codelineno-0-16"></a>        <span class="n">supports_check_mode</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#003-modules-__codelineno-0-17"></a>    <span class="p">)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#003-modules-__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#003-modules-__codelineno-0-19"></a>    <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;crash&#39;</span><span class="p">:</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#003-modules-__codelineno-0-20"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;boom&quot;</span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#003-modules-__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#003-modules-__codelineno-0-22"></a>    <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#003-modules-__codelineno-0-23"></a>        <span class="n">ping</span><span class="o">=</span><span class="n">module</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#003-modules-__codelineno-0-24"></a>    <span class="p">)</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#003-modules-__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#003-modules-__codelineno-0-26"></a>    <span class="n">module</span><span class="o">.</span><span class="n">exit_json</span><span class="p">(</span><span class="o">**</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#003-modules-__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#003-modules-__codelineno-0-28"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#003-modules-__codelineno-0-29"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="003-modules-05-list-of-modules">05. List of modules<a class="headerlink" href="#003-modules-05-list-of-modules" title="Permanent link">&para;</a></h2>
<ul>
<li>Modules are managed in the form of <code>collections</code>, as each <code>collection</code> contains multiple related modules. </li>
<li>See here for a <a href="https://docs.ansible.com/ansible/latest/collections/index.html">List of Collections</a>.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Note</p>
<p>Up to version 2.9, <code>Ansible</code> included <strong>all modules</strong> by default, 
but as the number of modules increased tremendously, it has been changed to the current format (ver. 2.10 and later).</p>
</div>
<hr />
<h2 id="003-modules-06-using-modules">06. Using modules<a class="headerlink" href="#003-modules-06-using-modules" title="Permanent link">&para;</a></h2>
<ul>
<li>By default <code>Ansible</code> is installed with <code>ansible.builtin</code> as the only collection. </li>
<li><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html#modules">Click here</a> for a list of modules that are available in the <code>ansible.builtin</code>.</li>
</ul>
<hr />
<h2 id="003-modules-07-find-modules-for-your-os">07. Find modules for your OS<a class="headerlink" href="#003-modules-07-find-modules-for-your-os" title="Permanent link">&para;</a></h2>
<ul>
<li>To see which modules are available for your OS, use the following command:
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#003-modules-__codelineno-1-1"></a>ansible-doc<span class="w"> </span>-l
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#003-modules-__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#003-modules-__codelineno-1-3"></a><span class="c1">### Output (only first few lines)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#003-modules-__codelineno-1-4"></a>add_host<span class="w">        </span>Add<span class="w"> </span>a<span class="w"> </span>host<span class="w"> </span><span class="o">(</span>and<span class="w"> </span>alternatively<span class="w"> </span>a<span class="w"> </span>group<span class="o">)</span><span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>ansible-playbook<span class="w"> </span><span class="k">in</span>-memory<span class="w"> </span>inventor...
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#003-modules-__codelineno-1-5"></a>apt<span class="w">             </span>Manages<span class="w"> </span>apt-packages
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#003-modules-__codelineno-1-6"></a>apt_key<span class="w">         </span>Add<span class="w"> </span>or<span class="w"> </span>remove<span class="w"> </span>an<span class="w"> </span>apt<span class="w"> </span>key
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#003-modules-__codelineno-1-7"></a>apt_repository<span class="w">  </span>Add<span class="w"> </span>and<span class="w"> </span>remove<span class="w"> </span>APT<span class="w"> </span>repositories
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#003-modules-__codelineno-1-8"></a>assemble<span class="w">        </span>Assemble<span class="w"> </span>configuration<span class="w"> </span>files<span class="w"> </span>from<span class="w"> </span>fragments
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#003-modules-__codelineno-1-9"></a>assert<span class="w">          </span>Asserts<span class="w"> </span>given<span class="w"> </span>expressions<span class="w"> </span>are<span class="w"> </span><span class="nb">true</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#003-modules-__codelineno-1-10"></a>async_status<span class="w">    </span>Obtain<span class="w"> </span>status<span class="w"> </span>of<span class="w"> </span>asynchronous<span class="w"> </span>task
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#003-modules-__codelineno-1-11"></a>blockinfile<span class="w">     </span>Insert/update/remove<span class="w"> </span>a<span class="w"> </span>text<span class="w"> </span>block<span class="w"> </span>surrounded<span class="w"> </span>by<span class="w"> </span>marker<span class="w"> </span>lines
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="003-modules-08-documentation">08. Documentation<a class="headerlink" href="#003-modules-08-documentation" title="Permanent link">&para;</a></h2>
<ul>
<li>To view documentation for a specific module, use the following command:
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#003-modules-__codelineno-2-1"></a><span class="c1"># Display the ping documentation</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#003-modules-__codelineno-2-2"></a>$<span class="w"> </span>ansible-doc<span class="w"> </span>ping
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#003-modules-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#003-modules-__codelineno-2-4"></a><span class="c1">### Output (only first few lines)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#003-modules-__codelineno-2-5"></a>&gt;<span class="w"> </span>ANSIBLE.BUILTIN.PING<span class="w">    </span><span class="o">(</span>/opt/homebrew/Cellar/ansible/9.4.0_1/libexec/lib/python3.12/site-packages/ansible/modules/ping&gt;
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#003-modules-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#003-modules-__codelineno-2-7"></a><span class="w">      </span>A<span class="w"> </span>trivial<span class="w"> </span><span class="nb">test</span><span class="w"> </span>module,<span class="w"> </span>this<span class="w"> </span>module<span class="w"> </span>always<span class="w"> </span>returns<span class="w"> </span><span class="sb">`</span>pong<span class="s1">&#39; on successful contact. It does</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#003-modules-__codelineno-2-8"></a><span class="s1">      not make sense in playbooks, but it is useful from `/usr/bin/ansible&#39;</span><span class="w"> </span>to<span class="w"> </span>verify<span class="w"> </span>the
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#003-modules-__codelineno-2-9"></a><span class="w">      </span>ability<span class="w"> </span>to<span class="w"> </span>login<span class="w"> </span>and<span class="w"> </span>that<span class="w"> </span>a<span class="w"> </span>usable<span class="w"> </span>Python<span class="w"> </span>is<span class="w"> </span>configured.<span class="w"> </span>This<span class="w"> </span>is<span class="w"> </span>NOT<span class="w"> </span>ICMP<span class="w"> </span>ping,<span class="w"> </span>this<span class="w"> </span>is
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#003-modules-__codelineno-2-10"></a><span class="w">      </span>just<span class="w"> </span>a<span class="w"> </span>trivial<span class="w"> </span><span class="nb">test</span><span class="w"> </span>module<span class="w"> </span>that<span class="w"> </span>requires<span class="w"> </span>Python<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>remote-node.<span class="w"> </span>For<span class="w"> </span>Windows<span class="w"> </span>targets,
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#003-modules-__codelineno-2-11"></a><span class="w">      </span>use<span class="w"> </span>the<span class="w"> </span><span class="o">[</span>ansible.windows.win_ping<span class="o">]</span><span class="w"> </span>module<span class="w"> </span>instead.<span class="w"> </span>For<span class="w"> </span>Network<span class="w"> </span>targets,<span class="w"> </span>use<span class="w"> </span>the
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#003-modules-__codelineno-2-12"></a><span class="w">      </span><span class="o">[</span>ansible.netcommon.net_ping<span class="o">]</span><span class="w"> </span>module<span class="w"> </span>instead.
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#003-modules-__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#003-modules-__codelineno-2-14"></a>ADDED<span class="w"> </span>IN:<span class="w"> </span>historical
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#003-modules-__codelineno-2-15"></a>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#003-modules-__codelineno-2-16"></a>OPTIONS<span class="w"> </span><span class="o">(=</span><span class="w"> </span>is<span class="w"> </span>mandatory<span class="o">)</span>:
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#003-modules-__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#003-modules-__codelineno-2-18"></a>-<span class="w"> </span>data
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#003-modules-__codelineno-2-19"></a><span class="w">      </span>Data<span class="w"> </span>to<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span><span class="sb">`</span>ping<span class="err">&#39;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>value.
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="003-modules-09-common-ad-hoc-commands">09. Common ad-hoc commands<a class="headerlink" href="#003-modules-09-common-ad-hoc-commands" title="Permanent link">&para;</a></h2>
<ul>
<li>Invoking a module is referred to as an <code>ad-hoc command</code>.</li>
<li>
<p>The syntax of an <code>ad-hoc command</code> is as follows:
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#003-modules-__codelineno-3-1"></a>$<span class="w"> </span>ansible<span class="w"> </span>&lt;servers&gt;<span class="w"> </span>-m<span class="w"> </span>&lt;module_name&gt;<span class="w"> </span>-a<span class="w"> </span><span class="s1">&#39;&lt;parameters&gt;&#39;</span>
</span></code></pre></div></p>
<table>
<thead>
<tr>
<th>CLI option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;servers&gt;</code></td>
<td>Any server (single, group or all) as defined in the inventory file</td>
</tr>
<tr>
<td><code>-m &lt;module_name&gt;</code></td>
<td>Specifies the module name</td>
</tr>
<tr>
<td><code>-a &lt;parameters&gt;</code></td>
<td>Specifies the parameters to be passed to the module. Optional in most cases</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr />
<h2 id="003-modules-10-ping-usage">10. <code>Ping</code> usage<a class="headerlink" href="#003-modules-10-ping-usage" title="Permanent link">&para;</a></h2>
<ul>
<li>We are already familiarized with the <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html">ping module</a>. </li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Tips</p>
<ul>
<li>The <code>ping</code> module is a module that determines whether Ansible can &ldquo;communicate as Ansible&rdquo; with the node it is working on (which is different from ICMP used in the network). </li>
<li>The <code>ping</code> module parameters are optional.</li>
</ul>
</div>
<ul>
<li>Usage:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#003-modules-__codelineno-4-1"></a><span class="c1"># Ping all server in the inventory</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#003-modules-__codelineno-4-2"></a>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#003-modules-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#003-modules-__codelineno-4-4"></a><span class="c1"># In our demo lab we will execute it, as follows:</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#003-modules-__codelineno-4-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible all -m ping&quot;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#003-modules-__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#003-modules-__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#003-modules-__codelineno-4-8"></a><span class="c1">### Output</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#003-modules-__codelineno-4-9"></a>linux-server-1<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#003-modules-__codelineno-4-10"></a><span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#003-modules-__codelineno-4-11"></a><span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/bin/python3&quot;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#003-modules-__codelineno-4-12"></a><span class="w">    </span><span class="o">}</span>,
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#003-modules-__codelineno-4-13"></a><span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#003-modules-__codelineno-4-14"></a><span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#003-modules-__codelineno-4-15"></a><span class="o">}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#003-modules-__codelineno-4-16"></a>linux-server-3<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#003-modules-__codelineno-4-17"></a><span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#003-modules-__codelineno-4-18"></a><span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/bin/python3&quot;</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#003-modules-__codelineno-4-19"></a><span class="w">    </span><span class="o">}</span>,
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#003-modules-__codelineno-4-20"></a><span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#003-modules-__codelineno-4-21"></a><span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#003-modules-__codelineno-4-22"></a><span class="o">}</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#003-modules-__codelineno-4-23"></a>linux-server-2<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#003-modules-__codelineno-4-24"></a><span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#003-modules-__codelineno-4-25"></a><span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/bin/python3&quot;</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#003-modules-__codelineno-4-26"></a><span class="w">    </span><span class="o">}</span>,
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#003-modules-__codelineno-4-27"></a><span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#003-modules-__codelineno-4-28"></a><span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#003-modules-__codelineno-4-29"></a><span class="o">}</span>
</span></code></pre></div>
<hr />
<h2 id="003-modules-11-the-shell-module">11. The <code>shell</code> module<a class="headerlink" href="#003-modules-11-the-shell-module" title="Permanent link">&para;</a></h2>
<ul>
<li>This is a module that executes shell commands on targets&rsquo; nodes.</li>
<li>See <code>Ansible</code> <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html">documentation about the <code>shell</code> module</a>.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">TIP</p>
<p>Be cautious when using the <code>shell</code> module, as it can introduce security risks if not used properly. Always validate and sanitize any user input that may be passed to shell commands.</p>
</div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#003-modules-__codelineno-5-1"></a><span class="c1"># Let&#39;s get the hostname of the server</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#003-modules-__codelineno-5-2"></a>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s1">&#39;hostname&#39;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#003-modules-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#003-modules-__codelineno-5-4"></a><span class="c1"># In our demo lab we will execute it like this:</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#003-modules-__codelineno-5-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible all -m shell -a &#39;hostname&#39;&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#003-modules-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#003-modules-__codelineno-5-7"></a><span class="c1"># Output</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#003-modules-__codelineno-5-8"></a><span class="c1"># ansible all -m shell -a &#39;hostname&#39; </span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#003-modules-__codelineno-5-9"></a>linux-server-3<span class="w"> </span><span class="p">|</span><span class="w"> </span>CHANGED<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">rc</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>&gt;&gt;
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#003-modules-__codelineno-5-10"></a>linux-server-3
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#003-modules-__codelineno-5-11"></a>linux-server-2<span class="w"> </span><span class="p">|</span><span class="w"> </span>CHANGED<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">rc</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>&gt;&gt;
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#003-modules-__codelineno-5-12"></a>linux-server-2
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#003-modules-__codelineno-5-13"></a>linux-server-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>CHANGED<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">rc</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>&gt;&gt;
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#003-modules-__codelineno-5-14"></a>linux-server-1
</span></code></pre></div>
<hr />
<p><img src="../assets/images/practice.png" alt="Practice" width="800"/></p>
<h2 id="003-modules-12-hands-on">12. Hands-on<a class="headerlink" href="#003-modules-12-hands-on" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Figure out a way to run the following (shell) command with <code>Ansible</code>, on any of the servers:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#003-modules-__codelineno-6-1"></a><span class="c1"># Get kernel information</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#003-modules-__codelineno-6-2"></a>uname<span class="w"> </span>-a
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#003-modules-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#003-modules-__codelineno-6-4"></a><span class="c1"># Get a date</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#003-modules-__codelineno-6-5"></a>date
</span></code></pre></div>
</li>
<li>
<p>Use the Ansible <code>command</code> module to print out the previous shell commands.</p>
</li>
<li>
<p>Try to run the following command: 
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#003-modules-__codelineno-7-1"></a>git<span class="w"> </span>config<span class="w"> </span>-l
</span></code></pre></div>
  What is the result of this command?</p>
</li>
</ol>
<h2 id="003-modules-13-solution">13. Solution<a class="headerlink" href="#003-modules-13-solution" title="Permanent link">&para;</a></h2>
<details>
    <summary>uname -a</summary>

    <div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#003-modules-__codelineno-8-1"></a><span class="c1"># Using the shell module</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#003-modules-__codelineno-8-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible linux-server-1 -m shell -a &#39;uname -a&#39;&quot;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#003-modules-__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#003-modules-__codelineno-8-4"></a><span class="c1">#Using the ansible `command` module</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#003-modules-__codelineno-8-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible linux-server-1 -m command -a &#39;uname -a&#39;&quot;</span>
</span></code></pre></div>
  </details>

<details>
    <summary>date</summary>

    <div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#003-modules-__codelineno-9-1"></a><span class="c1"># Using the shell module</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#003-modules-__codelineno-9-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible linux-server-1 -m shell -a &#39;date&#39;&quot;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#003-modules-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#003-modules-__codelineno-9-4"></a><span class="c1">#Using the ansible `command` module</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#003-modules-__codelineno-9-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible linux-server-1 -m command -a &#39;date&#39;&quot;</span>
</span></code></pre></div>
  </details>

<details>
    <summary>previous shell commands</summary>

    <div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#003-modules-__codelineno-10-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible all -m command -a &#39;uname -a&#39;&quot;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#003-modules-__codelineno-10-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ansible-controller<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cd /labs-scripts &amp;&amp; ansible all -m command -a &#39;date&#39;&quot;</span>
</span></code></pre></div>
  </details>

<details>
    <summary>git config</summary>

    <div class="language-sh highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#003-modules-__codelineno-11-1"></a><span class="c1"># The command</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#003-modules-__codelineno-11-2"></a>git<span class="w"> </span>config<span class="w"> </span>-l
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#003-modules-__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#003-modules-__codelineno-11-4"></a><span class="c1">### Output</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#003-modules-__codelineno-11-5"></a>user.name<span class="o">=</span>Your<span class="w"> </span>Name
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#003-modules-__codelineno-11-6"></a>user.email<span class="o">=</span>your.email@example.com
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#003-modules-__codelineno-11-7"></a>core.repositoryformatversion<span class="o">=</span><span class="m">0</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#003-modules-__codelineno-11-8"></a>core.filemode<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#003-modules-__codelineno-11-9"></a>core.bare<span class="o">=</span><span class="nb">false</span>
</span></code></pre></div>
  </details></section><section class="print-page" id="004-playbooks" heading-number="2.6"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-004.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-004.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="004-playbooks-lab-004-playbooks">Lab 004 - Playbooks<a class="headerlink" href="#004-playbooks-lab-004-playbooks" title="Permanent link">&para;</a></h1>
<p><br/></p>
<div style="display: flex; align-items: flex-start;">
  <img src="../assets/images/Ansible-Playbook.jpeg" alt="Ansible Playbook" width="200" style="border: 2px solid #ccc; border-radius: 10px; box-shadow: 2px 2px 8px #aaa; margin-right: 32px;"/>
  <div>
    <ul>
      <li>In this section, we will cover the <strong>Ansible Playbooks</strong>.</li>
      <li><strong>Playbooks</strong> are essentially "Ansible scripts" serving as one of <code>Ansible's</code> building blocks.</li>
    </ul>
  </div>
</div>

<hr />
<h3 id="004-playbooks-pre-requirements">Pre-Requirements<a class="headerlink" href="#004-playbooks-pre-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>Complete the <a href="#002-no-inventory-usage">lab 002</a> in order to have <code>Ansible</code> set up.</li>
</ul>
<hr />
<h2 id="004-playbooks-01-what-are-playbooks">01. What are playbooks?<a class="headerlink" href="#004-playbooks-01-what-are-playbooks" title="Permanent link">&para;</a></h2>
<ul>
<li>In the previous labs, we have executed an <code>Ansible ad-hoc command</code> which invoked modules.</li>
<li>In real life we need more than just <code>modules</code>&hellip;</li>
<li>This is where <code>Ansible playbook</code> jumps in for the rescue.</li>
<li><code>Ansible playbooks</code> are essentially <strong>blueprints of automation tasks</strong>. </li>
<li>They are written in <code>YAML</code> format, and are used to <strong>automate tasks on remote hosts</strong>. </li>
<li>In summary, <code>Ansible playbooks</code> offer a repeatable, reusable and simple configuration management &amp; multi-machine deployment system, well suited to deploying complex applications. </li>
<li><code>Ansible playbooks</code> are a <strong>powerful</strong> tool for automating infrastructure management.</li>
</ul>
<hr />
<h2 id="004-playbooks-02-key-points">02. Key points<a class="headerlink" href="#004-playbooks-02-key-points" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Structure</strong> - A playbook is composed of one or more <code>plays</code>, in an <strong>ordered list</strong> (Sequence). 
  Each play executes <strong>part</strong> of the overall goal of the playbook, running one or more tasks, whereas each task calls an <code>Ansible module</code>.</p>
</li>
<li>
<p><strong>Execution</strong> - A playbook runs in sequential order, from top to bottom. Within each play, tasks also run in a sequential order, from top to bottom. Playbooks containing multiple <code>plays</code> can orchestrate <strong>multi-machine deployments</strong>.</p>
</li>
<li>
<p><strong>Functionality</strong> - Playbooks can declare <strong>configurations</strong> and <strong>orchestrate steps</strong> of any manual ordered process, on <strong>multiple</strong> sets of machines, in a pre-defined order, while launching tasks, either synchronously or asynchronously.</p>
</li>
<li>
<p><strong>Use Cases</strong> - Playbooks are regularly used to automate IT infrastructure, networks, security systems and code repositories (like GitHub). IT staff can also use playbooks to program applications, services, server nodes and other devices.</p>
</li>
<li>
<p><strong>Reusability</strong> - The conditions, variables and tasks within playbooks can be saved, shared or reused indefinitely. This makes it easier for IT teams to codify operational knowledge and ensure that the same actions are performed consistently across different environments.</p>
</li>
</ul>
<hr />
<h2 id="004-playbooks-03-playbook-basics">03. Playbook basics<a class="headerlink" href="#004-playbooks-03-playbook-basics" title="Permanent link">&para;</a></h2>
<h4 id="004-playbooks-yaml">YAML<a class="headerlink" href="#004-playbooks-yaml" title="Permanent link">&para;</a></h4>
<ul>
<li>The <code>playbook</code> is usually written in <a href="https://ja.wikipedia.org/wiki/YAML">YAML</a> format.</li>
<li>Nevertheless, <code>playbooks</code> can be written in <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> format as well.</li>
<li>In this lab we will be using only YAML format for <code>playbooks</code>.</li>
<li>YAML is a text file that uses &ldquo;Python-style&rdquo; indentation to indicate nesting, which <strong>does not require quotes</strong> around most string values.</li>
<li>Files should start with <code>---</code>.</li>
<li>As <strong>indentations have meanings</strong>, they are extremely important!!!</li>
<li>Indentation should be written using <code>space</code>, as using <code>tab</code> will result in an error.</li>
<li>The level of indentation (using spaces, not tabs) is used to <strong>denote structure</strong>.</li>
<li>Building the playbook using <strong>Key-Value Pairs</strong>, making them as dictionary in YAML that is represented in a simple <code>key</code>: <code>value</code> form.</li>
<li>The <code>:</code> (colon) <strong>must</strong> be followed by a space.</li>
<li>All members of a <code>list</code> are lines beginning at the <strong>same indentation level</strong> starting with a <code>-</code> (a dash and a space).</li>
<li>As values can span multiple lines, using <code>|</code> or <code>&gt;</code>, <code>playbooks</code> support <strong>Multi-Line Strings</strong>. </li>
<li>Using a <code>Literal Block Scalar</code>  [<code>|</code>] will include the newlines and any trailing spaces. </li>
<li>Using a <code>Folded Block Scalar</code>   [<code>&gt;</code>] will fold new lines into spaces.</li>
<li><strong>Boolean Values</strong> (true/false) can be specified in several forms. For example, use a lowercase <code>true</code> or <code>false</code> boolean value in dictionaries in order to be compatible with default yamllint options.</li>
<li>YAML is <strong>case sensitive</strong>, so be careful with your capitalization.</li>
</ul>
<p><img src="../assets/images/ansible-playbook-yaml.png" style="background-color: white; border-radius: 15px" height="400px" width="900px"></p>
<hr />
<h2 id="004-playbooks-04-our-first-playbook">04. Our first playbook<a class="headerlink" href="#004-playbooks-04-our-first-playbook" title="Permanent link">&para;</a></h2>
<ul>
<li>Here is our first playbook example that will list files in a given directory.</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#004-playbooks-__codelineno-0-1"></a><span class="nn">---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#004-playbooks-__codelineno-0-2"></a><span class="c1"># Run on all the hosts</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#004-playbooks-__codelineno-0-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#004-playbooks-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#004-playbooks-__codelineno-0-5"></a><span class="w">  </span><span class="c1"># Here we define our tasks</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#004-playbooks-__codelineno-0-6"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w">  </span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#004-playbooks-__codelineno-0-7"></a><span class="w">    </span><span class="c1"># This is the first task </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#004-playbooks-__codelineno-0-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">List files in a directory</span><span class="w">  </span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#004-playbooks-__codelineno-0-9"></a><span class="w">      </span><span class="c1"># As learned before this is the command module</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#004-playbooks-__codelineno-0-10"></a><span class="w">      </span><span class="c1"># This command will list files in the home directory</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#004-playbooks-__codelineno-0-11"></a><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ls ~</span><span class="w">  </span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#004-playbooks-__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#004-playbooks-__codelineno-0-13"></a><span class="w">      </span><span class="c1"># register is used whenever we wish to save the output </span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#004-playbooks-__codelineno-0-14"></a><span class="w">      </span><span class="c1"># In this case it will be saved to a variable named &#39;files&#39;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#004-playbooks-__codelineno-0-15"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">files</span><span class="w">  </span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#004-playbooks-__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#004-playbooks-__codelineno-0-17"></a><span class="w">    </span><span class="c1"># This is the second task</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#004-playbooks-__codelineno-0-18"></a><span class="w">    </span><span class="c1"># In this case the tasks will run in the declared sequence </span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#004-playbooks-__codelineno-0-19"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print the list of files</span><span class="w">  </span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#004-playbooks-__codelineno-0-20"></a><span class="w">      </span><span class="c1"># Using the builtin debug module </span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#004-playbooks-__codelineno-0-21"></a><span class="w">      </span><span class="c1"># The debug will print out our files list</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#004-playbooks-__codelineno-0-22"></a><span class="w">      </span><span class="c1"># ** We need to use `stdout_lines` for that</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#004-playbooks-__codelineno-0-23"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span><span class="w">  </span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#004-playbooks-__codelineno-0-24"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">files.stdout_lines</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span>
</span></code></pre></div>
<h4 id="004-playbooks-writing-a-playbook">Writing a playbook<a class="headerlink" href="#004-playbooks-writing-a-playbook" title="Permanent link">&para;</a></h4>
<ul>
<li>Let&rsquo;s open the editor and write the first playbook in <code>YAML</code> format.</li>
</ul>
<h4 id="004-playbooks-playbook-content">Playbook content:<a class="headerlink" href="#004-playbooks-playbook-content" title="Permanent link">&para;</a></h4>
<ul>
<li><code>YAML</code> should start with the <code>---</code></li>
<li>Define the hosts we wish to run on. In this sample we will use our <code>localhost</code>.  </li>
<li>Define the playbook tasks.</li>
</ul>
<h5 id="004-playbooks-its-as-simple-as-that"><strong>It&rsquo;s as simple as that!</strong><a class="headerlink" href="#004-playbooks-its-as-simple-as-that" title="Permanent link">&para;</a></h5>
<hr />
<h4 id="004-playbooks-hands-on">Hands-on<a class="headerlink" href="#004-playbooks-hands-on" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Use the following code skeleton for our first playbook:
  <div class="language-YAML highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#004-playbooks-__codelineno-1-1"></a><span class="c1"># List of hosts</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#004-playbooks-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#004-playbooks-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#004-playbooks-__codelineno-1-4"></a><span class="w">  </span><span class="c1"># List of tasks</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#004-playbooks-__codelineno-1-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#004-playbooks-__codelineno-1-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Execute &#39;uname -a&#39;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#004-playbooks-__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#004-playbooks-__codelineno-1-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print &#39;uname -a&#39; output</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#004-playbooks-__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#004-playbooks-__codelineno-1-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Execute &#39;id&#39;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#004-playbooks-__codelineno-1-11"></a>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#004-playbooks-__codelineno-1-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print &#39;id&#39; output</span>
</span></code></pre></div></p>
</li>
<li>
<p>Now let&rsquo;s fill it in with content.</p>
</li>
<li>First lets define localhost as the host for this playbook:
  <div class="language-YAML highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#004-playbooks-__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#004-playbooks-__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span></code></pre></div></li>
<li>Next steps is to define the tasks:</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">TIP</p>
<p>Like in every other programming / scripting language, there is no one &ldquo;right&rdquo; or &ldquo;wrong&rdquo;
solution. The bellow solution will work like any other solution that will work
for you, so feel free to write it any way which works best for you.</p>
</div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#004-playbooks-__codelineno-3-1"></a><span class="c1"># List of hosts</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#004-playbooks-__codelineno-3-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#004-playbooks-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#004-playbooks-__codelineno-3-4"></a><span class="w">  </span><span class="c1">###</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#004-playbooks-__codelineno-3-5"></a><span class="w">  </span><span class="c1">### In this sample we display several solutions</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#004-playbooks-__codelineno-3-6"></a><span class="w">  </span><span class="c1">### </span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#004-playbooks-__codelineno-3-7"></a><span class="w">  </span><span class="c1">### We combine few commands like: `shell`, `debug`, `command` and more</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#004-playbooks-__codelineno-3-8"></a><span class="w">  </span><span class="c1">###</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#004-playbooks-__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#004-playbooks-__codelineno-3-10"></a><span class="w">  </span><span class="c1"># List of tasks</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#004-playbooks-__codelineno-3-11"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#004-playbooks-__codelineno-3-12"></a><span class="w">    </span><span class="c1"># Using shell it will work, but no out put will be displayed out</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#004-playbooks-__codelineno-3-13"></a><span class="w">    </span><span class="c1"># We will need to use register to display output</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#004-playbooks-__codelineno-3-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Execute &#39;uname -a&#39;</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#004-playbooks-__codelineno-3-15"></a><span class="w">      </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uname -a</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#004-playbooks-__codelineno-3-16"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">task_output</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#004-playbooks-__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#004-playbooks-__codelineno-3-18"></a><span class="w">    </span><span class="c1"># Using register we can now display the output contents</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#004-playbooks-__codelineno-3-19"></a><span class="w">    </span><span class="c1"># We must use `.stdout` to display the output itself</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#004-playbooks-__codelineno-3-20"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print &#39;uname -a&#39; output</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#004-playbooks-__codelineno-3-21"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#004-playbooks-__codelineno-3-22"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">task_output.stdout}}&quot;</span><span class="w">    </span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#004-playbooks-__codelineno-3-23"></a>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#004-playbooks-__codelineno-3-24"></a><span class="c1">### Output:</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#004-playbooks-__codelineno-3-25"></a>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#004-playbooks-__codelineno-3-26"></a><span class="err">*</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Executing Ansible ad-hoc commands</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#004-playbooks-__codelineno-3-27"></a>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#004-playbooks-__codelineno-3-28"></a><span class="l l-Scalar l-Scalar-Plain">$ ansible localhost -m shell -a &#39;uname -a&#39;</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#004-playbooks-__codelineno-3-29"></a><span class="l l-Scalar l-Scalar-Plain">localhost | CHANGED | rc=0 &gt;&gt;</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#004-playbooks-__codelineno-3-30"></a><span class="l l-Scalar l-Scalar-Plain">Linux 1fa29998d58c 5.15.0-105-generic 115-Ubuntu SMP Mon Apr 15 09:52:04</span><span class="w"> </span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#004-playbooks-__codelineno-3-31"></a><span class="l l-Scalar l-Scalar-Plain">UTC 2024 aarch64 aarch64 aarch64 GNU/Linux</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#004-playbooks-__codelineno-3-32"></a><span class="l l-Scalar l-Scalar-Plain">-----------------------------------</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#004-playbooks-__codelineno-3-33"></a>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#004-playbooks-__codelineno-3-34"></a><span class="err">*</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Executing ansible playbook</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#004-playbooks-__codelineno-3-35"></a>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#004-playbooks-__codelineno-3-36"></a><span class="l l-Scalar l-Scalar-Plain">$ cat 004-playbook.yaml</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#004-playbooks-__codelineno-3-37"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain"># List of hosts</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#004-playbooks-__codelineno-3-38"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- hosts</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#004-playbooks-__codelineno-3-39"></a>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#004-playbooks-__codelineno-3-40"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">###</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#004-playbooks-__codelineno-3-41"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">### In this sample we display several solutions</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#004-playbooks-__codelineno-3-42"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">###</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#004-playbooks-__codelineno-3-43"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">### We combine few commands like</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="err">`</span><span class="l l-Scalar l-Scalar-Plain">shell`, `debug`, `command` and more</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#004-playbooks-__codelineno-3-44"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">###</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#004-playbooks-__codelineno-3-45"></a>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#004-playbooks-__codelineno-3-46"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># List of tasks</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#004-playbooks-__codelineno-3-47"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#004-playbooks-__codelineno-3-48"></a><span class="w">      </span><span class="c1"># Using shell it will work, but no out put will be displayed out</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#004-playbooks-__codelineno-3-49"></a><span class="w">      </span><span class="c1"># We will need to use register to display output</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#004-playbooks-__codelineno-3-50"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Execute &#39;uname -a&#39;</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#004-playbooks-__codelineno-3-51"></a><span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uname -a</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#004-playbooks-__codelineno-3-52"></a><span class="w">        </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">task_output</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#004-playbooks-__codelineno-3-53"></a>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#004-playbooks-__codelineno-3-54"></a><span class="w">      </span><span class="c1"># Using register we can now display the output contents</span>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#004-playbooks-__codelineno-3-55"></a><span class="w">      </span><span class="c1"># We must use `.stdout` to display the output itself</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#004-playbooks-__codelineno-3-56"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print &#39;uname -a&#39; output</span>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#004-playbooks-__codelineno-3-57"></a><span class="w">        </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58" href="#004-playbooks-__codelineno-3-58"></a><span class="w">          </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">task_output.stdout}}&quot;</span><span class="w">   </span>
</span></code></pre></div>
<hr />
<p><img src="../assets/images/practice.png" alt="Practice" width="1000"/>
  <br/></p>
<ul>
<li>Complete the playbook, this time use <code>command</code> instead of shell:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#004-playbooks-__codelineno-4-1"></a>$<span class="w"> </span>ansible-playbook<span class="w"> </span><span class="m">004</span>-install-nginx.yaml
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#004-playbooks-__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#004-playbooks-__codelineno-4-3"></a>PLAY<span class="w"> </span><span class="o">[</span>localhost<span class="o">]</span><span class="w"> </span>***************************************************************
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#004-playbooks-__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#004-playbooks-__codelineno-4-5"></a>TASK<span class="w"> </span><span class="o">[</span>Gathering<span class="w"> </span>Facts<span class="o">]</span><span class="w"> </span>*********************************************************
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#004-playbooks-__codelineno-4-6"></a>ok:<span class="w"> </span><span class="o">[</span>localhost<span class="o">]</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#004-playbooks-__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#004-playbooks-__codelineno-4-8"></a>TASK<span class="w"> </span><span class="o">[</span>Execute<span class="w"> </span><span class="s1">&#39;uname -a&#39;</span><span class="o">]</span><span class="w"> </span>******************************************************
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#004-playbooks-__codelineno-4-9"></a>changed:<span class="w"> </span><span class="o">[</span>localhost<span class="o">]</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#004-playbooks-__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#004-playbooks-__codelineno-4-11"></a>TASK<span class="w"> </span><span class="o">[</span>Display<span class="w"> </span>the<span class="w"> </span>output<span class="o">]</span><span class="w"> </span>******************************************************
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#004-playbooks-__codelineno-4-12"></a>ok:<span class="w"> </span><span class="o">[</span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#004-playbooks-__codelineno-4-13"></a><span class="w">    </span><span class="s2">&quot;msg&quot;</span>:<span class="w"> </span><span class="s2">&quot;Linux 1fa29998d58c 5.15.0-105-generic #115-Ubuntu SMP Mon Apr 15</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#004-playbooks-__codelineno-4-14"></a><span class="s2">    09:52:04 UTC 2024 aarch64 aarch64 aarch64 GNU/Linux&quot;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#004-playbooks-__codelineno-4-15"></a><span class="o">}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#004-playbooks-__codelineno-4-16"></a>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#004-playbooks-__codelineno-4-17"></a>PLAY<span class="w"> </span>RECAP<span class="w"> </span>*********************************************************************
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#004-playbooks-__codelineno-4-18"></a>localhost<span class="w">                  </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">3</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</span></code></pre></div>
<hr />
<h2 id="004-playbooks-05-playbook-syntax">05. Playbook syntax<a class="headerlink" href="#004-playbooks-05-playbook-syntax" title="Permanent link">&para;</a></h2>
<ul>
<li>In this section, we will learn further about playbook&rsquo;s syntax.</li>
</ul>
<h4 id="004-playbooks-play"><code>Play</code><a class="headerlink" href="#004-playbooks-play" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html#play">See official documentation</a>.</li>
<li>The <strong>top</strong> part of the playbook is called <code>Play</code> and it <strong>defines</strong> the <strong>global behavior</strong> of for the <strong>entire</strong> playbook.</li>
<li>Here are some definitions which are set in the <code>Play</code> section:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#004-playbooks-__codelineno-5-1"></a><span class="nn">---</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#004-playbooks-__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The name of the play</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#004-playbooks-__codelineno-5-3"></a><span class="w">  </span><span class="c1"># A list of groups, hosts or host pattern that translates into a list </span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#004-playbooks-__codelineno-5-4"></a><span class="w">  </span><span class="c1"># of hosts that are the play‚Äôs target.</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#004-playbooks-__codelineno-5-5"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#004-playbooks-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#004-playbooks-__codelineno-5-7"></a><span class="w">  </span><span class="c1"># Boolean that controls if privilege escalation is used or not on </span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#004-playbooks-__codelineno-5-8"></a><span class="w">  </span><span class="c1"># Task execution.</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#004-playbooks-__codelineno-5-9"></a><span class="w">  </span><span class="c1"># Implemented by the become plugin</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#004-playbooks-__codelineno-5-10"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#004-playbooks-__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#004-playbooks-__codelineno-5-12"></a><span class="w">  </span><span class="c1"># User that you ‚Äòbecome‚Äô after using privilege escalation. </span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#004-playbooks-__codelineno-5-13"></a><span class="w">  </span><span class="c1"># The remote/login user must have permissions to become this user.</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#004-playbooks-__codelineno-5-14"></a><span class="w">  </span><span class="nt">become_user</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#004-playbooks-__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#004-playbooks-__codelineno-5-16"></a><span class="w">  </span><span class="c1"># A dictionary that gets converted into environment vars to be provided </span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#004-playbooks-__codelineno-5-17"></a><span class="w">  </span><span class="c1"># for the task upon execution. </span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#004-playbooks-__codelineno-5-18"></a><span class="w">  </span><span class="c1"># This can ONLY be used with modules. </span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#004-playbooks-__codelineno-5-19"></a><span class="w">  </span><span class="c1"># This is not supported for any other type of plugins nor Ansible itself </span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#004-playbooks-__codelineno-5-20"></a><span class="w">  </span><span class="c1"># nor its configuration, it just sets the variables for the code responsible</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#004-playbooks-__codelineno-5-21"></a><span class="w">  </span><span class="c1"># for executing the task. </span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#004-playbooks-__codelineno-5-22"></a><span class="w">  </span><span class="c1"># This is not a recommended way to pass in confidential data.</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#004-playbooks-__codelineno-5-23"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#004-playbooks-__codelineno-5-24"></a>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#004-playbooks-__codelineno-5-25"></a><span class="w">  </span><span class="c1"># Dictionary/map of variables</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#004-playbooks-__codelineno-5-26"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span><span class="w"> </span>
</span></code></pre></div>
<hr />
<h2 id="004-playbooks-06-quiz">06. Quiz<a class="headerlink" href="#004-playbooks-06-quiz" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Review the example below and try to answer the following questions:</p>
<ul>
<li>On which hosts the playbook should be executed?</li>
<li>How do we define the play?</li>
<li>Which directives are defined in the below playbook?</li>
<li>How do we define variables?</li>
<li>How do we use variables?</li>
<li>How do we set up a root user?</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#004-playbooks-__codelineno-6-1"></a><span class="c1">#</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#004-playbooks-__codelineno-6-2"></a><span class="c1"># Install nginx</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#004-playbooks-__codelineno-6-3"></a><span class="c1">#</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#004-playbooks-__codelineno-6-4"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install and start nginx</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#004-playbooks-__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#004-playbooks-__codelineno-6-6"></a><span class="c1"># We should have this group in our inventory</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#004-playbooks-__codelineno-6-7"></a><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webservers</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#004-playbooks-__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#004-playbooks-__codelineno-6-9"></a><span class="c1"># Variables</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#004-playbooks-__codelineno-6-10"></a><span class="c1"># The `lookup` function is used to fetch the value of the environment variables </span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#004-playbooks-__codelineno-6-11"></a><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#004-playbooks-__codelineno-6-12"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#004-playbooks-__codelineno-6-13"></a><span class="w">    </span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,&#39;PORT&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#004-playbooks-__codelineno-6-14"></a><span class="w">    </span><span class="nt">PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,&#39;PASSWORD&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#004-playbooks-__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#004-playbooks-__codelineno-6-16"></a><span class="c1"># Define the tasks    </span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#004-playbooks-__codelineno-6-17"></a><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#004-playbooks-__codelineno-6-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#004-playbooks-__codelineno-6-19"></a><span class="w">    </span><span class="nt">apt</span><span class="p">:</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#004-playbooks-__codelineno-6-20"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#004-playbooks-__codelineno-6-21"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#004-playbooks-__codelineno-6-22"></a><span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#004-playbooks-__codelineno-6-23"></a>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#004-playbooks-__codelineno-6-24"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start nginx service</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#004-playbooks-__codelineno-6-25"></a><span class="w">    </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#004-playbooks-__codelineno-6-26"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#004-playbooks-__codelineno-6-27"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#004-playbooks-__codelineno-6-28"></a><span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#004-playbooks-__codelineno-6-29"></a>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#004-playbooks-__codelineno-6-30"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create a new secret with environment variable</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#004-playbooks-__codelineno-6-31"></a><span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;secret:{{ PASSWORD }}&quot; &gt; /etc/secret</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#004-playbooks-__codelineno-6-32"></a><span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#004-playbooks-__codelineno-6-33"></a>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#004-playbooks-__codelineno-6-34"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Open the port in firewall</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#004-playbooks-__codelineno-6-35"></a><span class="w">    </span><span class="nt">ufw</span><span class="p">:</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#004-playbooks-__codelineno-6-36"></a><span class="w">      </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#004-playbooks-__codelineno-6-37"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">PORT</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#004-playbooks-__codelineno-6-38"></a><span class="w">      </span><span class="nt">proto</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#004-playbooks-__codelineno-6-39"></a><span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="004-playbooks-07-playbook-demo">07. Playbook demo<a class="headerlink" href="#004-playbooks-07-playbook-demo" title="Permanent link">&para;</a></h2>
<ul>
<li>Execute the playbook by adding the required parameters.</li>
<li>This can be done by setting up the parameters prior to executing the playbook, or by adding the parameters to the playbook itself.</li>
</ul>
<h4 id="004-playbooks-setting-the-env-variable-in-the-ansible-controller">Setting the env variable in the Ansible controller<a class="headerlink" href="#004-playbooks-setting-the-env-variable-in-the-ansible-controller" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#004-playbooks-__codelineno-7-1"></a><span class="c1"># Example: </span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#004-playbooks-__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#004-playbooks-__codelineno-7-3"></a><span class="c1"># 01. Setting the env variable in the Ansible controller</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#004-playbooks-__codelineno-7-4"></a><span class="l l-Scalar l-Scalar-Plain">export PORT=8080</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#004-playbooks-__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#004-playbooks-__codelineno-7-6"></a><span class="l l-Scalar l-Scalar-Plain"># Use the -e/--extra-vars to inject environment variables into the playbook</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#004-playbooks-__codelineno-7-7"></a><span class="l l-Scalar l-Scalar-Plain">ansible-playbook playbook.yaml -e &quot;my_var=$MY_VAR&quot;</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#004-playbooks-__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#004-playbooks-__codelineno-7-9"></a><span class="l l-Scalar l-Scalar-Plain"># Using the lookup Plug to fetch the value of the environment variables</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#004-playbooks-__codelineno-7-10"></a><span class="l l-Scalar l-Scalar-Plain">PORT</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,&#39;PORT&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<h4 id="004-playbooks-passing-the-variable-to-the-playbook">Passing the variable to the playbook<a class="headerlink" href="#004-playbooks-passing-the-variable-to-the-playbook" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#004-playbooks-__codelineno-8-1"></a><span class="c1"># Example:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#004-playbooks-__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#004-playbooks-__codelineno-8-3"></a><span class="c1"># 02. Passing the variable to the playbook</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#004-playbooks-__codelineno-8-4"></a><span class="l l-Scalar l-Scalar-Plain">PORT=&quot;8080&quot; ansible-playbook playbook.yaml</span>
</span></code></pre></div>
<h4 id="004-playbooks-using-the-environment">Using the environment<a class="headerlink" href="#004-playbooks-using-the-environment" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#004-playbooks-__codelineno-9-1"></a><span class="c1"># Example:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#004-playbooks-__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#004-playbooks-__codelineno-9-3"></a><span class="c1"># 0.3 Using the environment keyword in a **task** to set variables for that task</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#004-playbooks-__codelineno-9-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Open the port in firewall</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#004-playbooks-__codelineno-9-5"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#004-playbooks-__codelineno-9-6"></a><span class="w">    </span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#004-playbooks-__codelineno-9-7"></a><span class="w">  </span><span class="nt">ufw</span><span class="p">:</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#004-playbooks-__codelineno-9-8"></a><span class="w">    </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">allow</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#004-playbooks-__codelineno-9-9"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">PORT</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#004-playbooks-__codelineno-9-10"></a><span class="w">    </span><span class="nt">proto</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
</span></code></pre></div>
<h4 id="004-playbooks-passing-the-environment">Passing the environment<a class="headerlink" href="#004-playbooks-passing-the-environment" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#004-playbooks-__codelineno-10-1"></a><span class="c1"># Example:</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#004-playbooks-__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#004-playbooks-__codelineno-10-3"></a><span class="c1"># 0.4 Passing the environment to all the tasks in Playbook</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#004-playbooks-__codelineno-10-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#004-playbooks-__codelineno-10-5"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#004-playbooks-__codelineno-10-6"></a><span class="w">    </span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#004-playbooks-__codelineno-10-7"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#004-playbooks-__codelineno-10-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Open the port in firewall</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#004-playbooks-__codelineno-10-9"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</span></code></pre></div>
<h4 id="004-playbooks-set-environment">Set environment<a class="headerlink" href="#004-playbooks-set-environment" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#004-playbooks-__codelineno-11-1"></a><span class="c1"># Example:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#004-playbooks-__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#004-playbooks-__codelineno-11-3"></a><span class="c1"># 05. Permanently set environment variables on remote hosts to persist variables </span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#004-playbooks-__codelineno-11-4"></a><span class="c1">#     (e.g., in .bashrc or /etc/environment)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#004-playbooks-__codelineno-11-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set permanent environment variable</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#004-playbooks-__codelineno-11-6"></a><span class="w">  </span><span class="nt">lineinfile</span><span class="p">:</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#004-playbooks-__codelineno-11-7"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/environment</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#004-playbooks-__codelineno-11-8"></a><span class="w">    </span><span class="nt">line</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;PORT=&quot;8080&quot;&#39;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#004-playbooks-__codelineno-11-9"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#004-playbooks-__codelineno-11-10"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span></code></pre></div>
<h4 id="004-playbooks-using-var_files-to-include-variables">Using <code>var_files</code> to include variables<a class="headerlink" href="#004-playbooks-using-var_files-to-include-variables" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#004-playbooks-__codelineno-12-1"></a><span class="c1"># Example</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#004-playbooks-__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#004-playbooks-__codelineno-12-3"></a><span class="c1"># 06. We can use a variable file to pass variables in a playbook</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#004-playbooks-__codelineno-12-4"></a><span class="c1"># Check the vars.yaml file in the same directory</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#004-playbooks-__codelineno-12-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#004-playbooks-__codelineno-12-6"></a><span class="w">  </span><span class="nt">vars_files</span><span class="p">:</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#004-playbooks-__codelineno-12-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vars.yaml</span><span class="w">  </span><span class="c1"># Include variables from vars.yaml</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#004-playbooks-__codelineno-12-8"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#004-playbooks-__codelineno-12-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print a variable</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#004-playbooks-__codelineno-12-10"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#004-playbooks-__codelineno-12-11"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">http_port</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<hr />
<h2 id="004-playbooks-08-tasks">08. Tasks<a class="headerlink" href="#004-playbooks-08-tasks" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>See documentation on <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_intro.html#running-playbooks-in-check-mode">running playbooks in check mode</a>.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#004-playbooks-__codelineno-13-1"></a><span class="c1"># To run a playbook in check mode, </span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#004-playbooks-__codelineno-13-2"></a><span class="c1"># you can pass the -C or --check flag to </span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#004-playbooks-__codelineno-13-3"></a><span class="c1"># the ansible-playbook command:</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#004-playbooks-__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#004-playbooks-__codelineno-13-5"></a>ansible-playbook<span class="w"> </span>--check<span class="w"> </span>playbook.yaml
</span></code></pre></div></p>
</li>
<li>
<p>Let&rsquo;s write some playbook tasks with parameters.</p>
</li>
<li>Take a look on <code>004-list-files.yaml</code> and follow the instructions in the comments.</li>
<li>Answer the questions in the comments about the <code>with_items</code> output of the playbook.</li>
</ul>
<hr />
<h2 id="004-playbooks-09-additional-tasks">09. Additional tasks<a class="headerlink" href="#004-playbooks-09-additional-tasks" title="Permanent link">&para;</a></h2>
<ul>
<li>Run the playbook and watch the output.</li>
<li>Run the playbook in <code>check mode</code> and watch the output.</li>
<li>Run the playbook with <code>--diff</code> flag and watch the output.</li>
<li>Run the playbook with <code>--verbose</code> flag and watch the output.</li>
<li>Run the playbook with <code>--verbose</code> and <code>--diff</code> flags and watch the output.</li>
<li>Run the playbook with <code>--verbose</code>, <code>--diff</code> and <code>--check</code> flags and watch the output.</li>
</ul>
<hr />
<div class="admonition warning">
<p class="admonition-title">TIP</p>
<p>It&rsquo;s considered best practice to use the FQDN name of all modules used in your playbook.
It is done to prevent naming collision between builtin modules and community modules or self made ones.</p>
</div></section><section class="print-page" id="005-facts" heading-number="2.7"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-005.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-005.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="005-facts-lab-005-facts">Lab 005 - Facts<a class="headerlink" href="#005-facts-lab-005-facts" title="Permanent link">&para;</a></h1>
<ul>
<li>In this section, we will cover <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_vars_facts.html#ansible-facts"><strong>Ansible Facts</strong></a>.</li>
<li><strong>Ansible facts</strong> are essentially &ldquo;Ansible Scripts&rdquo; and constitute one of the building blocks of Ansible.</li>
<li><strong>Ansible facts</strong> are data corresponding to your <strong>remote systems</strong>, which includes operating systems, IP addresses, attached filesystems, and more.</li>
<li><strong>Ansible facts</strong> are gathered, and relate to target nodes (host nodes to be configured). They are returned back to the controller node.</li>
</ul>
<h2 id="005-facts-01-how-to-view-facts">01. <strong>How to View Facts?</strong><a class="headerlink" href="#005-facts-01-how-to-view-facts" title="Permanent link">&para;</a></h2>
<ul>
<li>Ansible gathers facts about remote systems using the <code>setup</code> module.</li>
<li>
<p>You can view facts of a remote machine by running the following command:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#005-facts-__codelineno-0-1"></a>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>setup
</span></code></pre></div></p>
</li>
<li>
<p>Example Output (Truncated for brevity):
  <div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#005-facts-__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#005-facts-__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;ansible_facts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#005-facts-__codelineno-1-3"></a><span class="w">      </span><span class="nt">&quot;ansible_distribution&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Ubuntu&quot;</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#005-facts-__codelineno-1-4"></a><span class="w">      </span><span class="nt">&quot;ansible_distribution_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;22.04&quot;</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#005-facts-__codelineno-1-5"></a><span class="w">      </span><span class="nt">&quot;ansible_architecture&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x86_64&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#005-facts-__codelineno-1-6"></a><span class="w">      </span><span class="nt">&quot;ansible_memory_mb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#005-facts-__codelineno-1-7"></a><span class="w">          </span><span class="nt">&quot;real&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#005-facts-__codelineno-1-8"></a><span class="w">              </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7989</span><span class="p">,</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#005-facts-__codelineno-1-9"></a><span class="w">              </span><span class="nt">&quot;used&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2034</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#005-facts-__codelineno-1-10"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#005-facts-__codelineno-1-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#005-facts-__codelineno-1-12"></a><span class="w">      </span><span class="nt">&quot;ansible_default_ipv4&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#005-facts-__codelineno-1-13"></a><span class="w">          </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.10&quot;</span><span class="p">,</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#005-facts-__codelineno-1-14"></a><span class="w">          </span><span class="nt">&quot;netmask&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;255.255.255.0&quot;</span><span class="p">,</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#005-facts-__codelineno-1-15"></a><span class="w">          </span><span class="nt">&quot;gateway&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.1&quot;</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#005-facts-__codelineno-1-16"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#005-facts-__codelineno-1-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#005-facts-__codelineno-1-18"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ul>
<hr />
<h2 id="005-facts-02-how-to-use-facts-in-playbooks">02. <strong>How to use facts in playbooks?</strong><a class="headerlink" href="#005-facts-02-how-to-use-facts-in-playbooks" title="Permanent link">&para;</a></h2>
<ul>
<li>Facts allow you to base your playbook logic on the properties of the target hosts.</li>
<li>All facts are prefixed with <code>ansible_x</code>.</li>
<li>For example, to access the operating system distribution of a host, you would use <code>ansible_distribution</code>.</li>
<li>Here are some examples of how to use facts in playbooks:</li>
</ul>
<p><br></p>
<h4 id="005-facts-example-installing-packages-based-on-os"><strong>Example: Installing Packages Based on OS</strong><a class="headerlink" href="#005-facts-example-installing-packages-based-on-os" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#005-facts-__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#005-facts-__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#005-facts-__codelineno-2-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#005-facts-__codelineno-2-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Nginx on Debian using APT</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#005-facts-__codelineno-2-5"></a><span class="w">      </span><span class="nt">ansible.builtin.apt</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#005-facts-__codelineno-2-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#005-facts-__codelineno-2-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#005-facts-__codelineno-2-8"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_distribution == &quot;Ubuntu&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#005-facts-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#005-facts-__codelineno-2-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Nginx on RedHat using DNF</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#005-facts-__codelineno-2-11"></a><span class="w">      </span><span class="nt">ansible.builtin.dnf</span><span class="p">:</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#005-facts-__codelineno-2-12"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#005-facts-__codelineno-2-13"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#005-facts-__codelineno-2-14"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_distribution == &quot;CentOS&quot;</span>
</span></code></pre></div>
<h4 id="005-facts-example-conditional-execution-based-on-memory"><strong>Example: Conditional execution based on memory</strong><a class="headerlink" href="#005-facts-example-conditional-execution-based-on-memory" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#005-facts-__codelineno-3-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart Service if Memory is Low</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#005-facts-__codelineno-3-2"></a><span class="w">  </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#005-facts-__codelineno-3-3"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_service</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#005-facts-__codelineno-3-4"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#005-facts-__codelineno-3-5"></a><span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_memory_mb.real.total &lt; 4000</span>
</span></code></pre></div>
<hr />
<h2 id="005-facts-03-commonly-used-facts">03. <strong>Commonly used facts</strong><a class="headerlink" href="#005-facts-03-commonly-used-facts" title="Permanent link">&para;</a></h2>
<h4 id="005-facts-system-information"><strong>System Information</strong><a class="headerlink" href="#005-facts-system-information" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Fact</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ansible_distribution</code></td>
<td>OS name (Ubuntu, CentOS, Windows)</td>
</tr>
<tr>
<td><code>ansible_distribution_version</code></td>
<td>OS version (22.04, 9.1, 10)</td>
</tr>
<tr>
<td><code>ansible_architecture</code></td>
<td>System architecture (x86_64, arm)</td>
</tr>
<tr>
<td><code>ansible_hostname</code></td>
<td>Hostname of the machine</td>
</tr>
<tr>
<td><code>ansible_os_family</code></td>
<td>OS family (Debian, RedHat, Windows)</td>
</tr>
<tr>
<td><code>ansible_facts</code></td>
<td>All gathered facts</td>
</tr>
</tbody>
</table>
<h4 id="005-facts-networking"><strong>Networking</strong><a class="headerlink" href="#005-facts-networking" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Fact</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ansible_default_ipv4.address</code></td>
<td>Default IP address</td>
</tr>
<tr>
<td><code>ansible_default_ipv4.gateway</code></td>
<td>Default gateway</td>
</tr>
<tr>
<td><code>ansible_fqdn</code></td>
<td>Fully Qualified Domain Name</td>
</tr>
<tr>
<td><code>ansible_dns.nameservers</code></td>
<td>DNS servers</td>
</tr>
</tbody>
</table>
<h4 id="005-facts-hardware"><strong>Hardware</strong><a class="headerlink" href="#005-facts-hardware" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Fact</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ansible_memory_mb.real.total</code></td>
<td>Total RAM in MB</td>
</tr>
<tr>
<td><code>ansible_processor_count</code></td>
<td>Number of CPUs</td>
</tr>
<tr>
<td><code>ansible_processor_cores</code></td>
<td>Number of CPU cores</td>
</tr>
</tbody>
</table>
<h4 id="005-facts-user-defined-facts"><strong>User-defined Facts</strong><a class="headerlink" href="#005-facts-user-defined-facts" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Fact</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ansible_user</code></td>
<td>Current user</td>
</tr>
<tr>
<td><code>ansible_group</code></td>
<td>Current group</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="005-facts-04-disabling-fact-gathering">04. <strong>Disabling fact gathering</strong><a class="headerlink" href="#005-facts-04-disabling-fact-gathering" title="Permanent link">&para;</a></h2>
<ul>
<li>By default, Ansible gathers facts before running a playbook. </li>
<li>In order to disable it, add the following at the beginning of your playbook:</li>
<li>To disable fact gathering, set <code>gather_facts</code> to <code>no</code> in your playbook:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#005-facts-__codelineno-4-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#005-facts-__codelineno-4-2"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#005-facts-__codelineno-4-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#005-facts-__codelineno-4-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print a message</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#005-facts-__codelineno-4-5"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#005-facts-__codelineno-4-6"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Facts</span><span class="nv"> </span><span class="s">gathering</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">disabled!&quot;</span>
</span></code></pre></div>
<hr />
<h2 id="005-facts-05-custom-facts">05. <strong>Custom Facts</strong><a class="headerlink" href="#005-facts-05-custom-facts" title="Permanent link">&para;</a></h2>
<ul>
<li>You can define custom facts by creating <code>.fact</code> files, placing them inside <code>/etc/ansible/facts.d/</code> directory on the managed host.</li>
</ul>
<h4 id="005-facts-example-creating-a-custom-fact"><strong>Example: Creating a custom fact</strong><a class="headerlink" href="#005-facts-example-creating-a-custom-fact" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create the file <code>/etc/ansible/facts.d/custom.fact</code> with:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#005-facts-__codelineno-5-1"></a><span class="k">[custom]</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#005-facts-__codelineno-5-2"></a><span class="na">environment</span><span class="o">=</span><span class="s">production</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#005-facts-__codelineno-5-3"></a><span class="na">app_version</span><span class="o">=</span><span class="s">1.2.3</span>
</span></code></pre></div>
</li>
<li>
<p>Retrieve the fact in a playbook:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#005-facts-__codelineno-6-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#005-facts-__codelineno-6-2"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#005-facts-__codelineno-6-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#005-facts-__codelineno-6-4"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;App</span><span class="nv"> </span><span class="s">version</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_local.custom.app_version</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
</li>
</ul>
<h4 id="005-facts-using-custom-facts"><strong>Using Custom Facts</strong><a class="headerlink" href="#005-facts-using-custom-facts" title="Permanent link">&para;</a></h4>
<ul>
<li>Another way to define your own custom facts using the <code>set_fact</code> module in your playbooks.</li>
<li>
<p>Here is an example:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#005-facts-__codelineno-7-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#005-facts-__codelineno-7-2"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#005-facts-__codelineno-7-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set custom fact</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#005-facts-__codelineno-7-4"></a><span class="w">      </span><span class="nt">ansible.builtin.set_fact</span><span class="p">:</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#005-facts-__codelineno-7-5"></a><span class="w">        </span><span class="nt">my_custom_fact</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello,</span><span class="nv"> </span><span class="s">Ansible!&quot;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#005-facts-__codelineno-7-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print custom fact</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#005-facts-__codelineno-7-7"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#005-facts-__codelineno-7-8"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">my_custom_fact</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="005-facts-06-hands-on">06. <strong>Hands-on</strong><a class="headerlink" href="#005-facts-06-hands-on" title="Permanent link">&para;</a></h2>
<p><img src="../assets/images/practice.png" width="800px">
  <br/></p>
<ul>
<li>
<p>Use the <code>setup</code> module to gather and print all facts from <code>linux-server-1</code>.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#005-facts-__codelineno-8-1"></a>ansible<span class="w"> </span>linux-server-1<span class="w"> </span>-m<span class="w"> </span>setup
</span></code></pre></div>
</details>
</li>
<li>
<p>Use the <code>setup</code> module to gather and print only the network-related facts from <code>linux-server-2</code>.</p>
<p><details>
<summary>Solution</summary></p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#005-facts-__codelineno-9-1"></a>ansible<span class="w"> </span>linux-server-2<span class="w"> </span>-m<span class="w"> </span>setup<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;filter=ansible_default_ipv4*&quot;</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p>Create a playbook that installs <code>nginx</code> only if the target host is running <code>Ubuntu</code>.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#005-facts-__codelineno-10-1"></a><span class="nn">---</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#005-facts-__codelineno-10-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#005-facts-__codelineno-10-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#005-facts-__codelineno-10-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx on Ubuntu</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#005-facts-__codelineno-10-5"></a><span class="w">      </span><span class="nt">ansible.builtin.apt</span><span class="p">:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#005-facts-__codelineno-10-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#005-facts-__codelineno-10-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#005-facts-__codelineno-10-8"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_distribution == &quot;Ubuntu&quot;</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Create a playbook that restarts a service only if the host has less than <code>4GB</code> of RAM.</p>
<p><details>
<summary>Solution</summary></p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#005-facts-__codelineno-11-1"></a><span class="nn">---</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#005-facts-__codelineno-11-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#005-facts-__codelineno-11-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#005-facts-__codelineno-11-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart service if memory low</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#005-facts-__codelineno-11-5"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#005-facts-__codelineno-11-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_service</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#005-facts-__codelineno-11-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#005-facts-__codelineno-11-8"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_memory_mb.real.total &lt; 4096</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p>Create a custom fact that defines the environment as <code>development</code> and print it in a playbook.</p>
<p><details>
<summary>Solution</summary></p>
<p>First, create <code>/etc/ansible/facts.d/custom.fact</code> on the host:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#005-facts-__codelineno-12-1"></a><span class="k">[custom]</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#005-facts-__codelineno-12-2"></a><span class="na">environment</span><span class="o">=</span><span class="s">development</span>
</span></code></pre></div>
<p>Then playbook:</p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#005-facts-__codelineno-13-1"></a><span class="nn">---</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#005-facts-__codelineno-13-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#005-facts-__codelineno-13-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#005-facts-__codelineno-13-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#005-facts-__codelineno-13-5"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Environment</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_local.custom.environment</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p>Create a playbook that sets a custom fact <code>deployment_stage</code> to <code>staging</code> and prints it.</p>
<p><details>
<summary>Solution</summary></p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#005-facts-__codelineno-14-1"></a><span class="nn">---</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#005-facts-__codelineno-14-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#005-facts-__codelineno-14-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#005-facts-__codelineno-14-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set custom fact</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#005-facts-__codelineno-14-5"></a><span class="w">      </span><span class="nt">ansible.builtin.set_fact</span><span class="p">:</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#005-facts-__codelineno-14-6"></a><span class="w">        </span><span class="nt">deployment_stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#005-facts-__codelineno-14-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print custom fact</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#005-facts-__codelineno-14-8"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#005-facts-__codelineno-14-9"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deployment</span><span class="nv"> </span><span class="s">stage:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">deployment_stage</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p>Disable fact gathering in a playbook and print a message indicating that facts are not gathered.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#005-facts-__codelineno-15-1"></a><span class="nn">---</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#005-facts-__codelineno-15-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#005-facts-__codelineno-15-3"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#005-facts-__codelineno-15-4"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#005-facts-__codelineno-15-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print message</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#005-facts-__codelineno-15-6"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#005-facts-__codelineno-15-7"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Facts</span><span class="nv"> </span><span class="s">gathering</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">disabled!&quot;</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Create a playbook that prints the hostname of each target host using the appropriate fact.</p>
<p><details>
<summary>Solution</summary></p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#005-facts-__codelineno-16-1"></a><span class="nn">---</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#005-facts-__codelineno-16-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#005-facts-__codelineno-16-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#005-facts-__codelineno-16-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print hostname</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#005-facts-__codelineno-16-5"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#005-facts-__codelineno-16-6"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hostname:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p>Create a playbook that checks the OS family and installs a package accordingly (e.g., <code>nginx</code> for <code>Debian</code>, <code>httpd</code> for <code>RedHat</code>).</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#005-facts-__codelineno-17-1"></a><span class="nn">---</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#005-facts-__codelineno-17-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#005-facts-__codelineno-17-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#005-facts-__codelineno-17-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install nginx on Debian</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#005-facts-__codelineno-17-5"></a><span class="w">      </span><span class="nt">ansible.builtin.apt</span><span class="p">:</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#005-facts-__codelineno-17-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#005-facts-__codelineno-17-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#005-facts-__codelineno-17-8"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#005-facts-__codelineno-17-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install httpd on RedHat</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#005-facts-__codelineno-17-10"></a><span class="w">      </span><span class="nt">ansible.builtin.dnf</span><span class="p">:</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#005-facts-__codelineno-17-11"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#005-facts-__codelineno-17-12"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#005-facts-__codelineno-17-13"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Create a playbook that gathers facts and prints the total memory of each host.</p>
<p><details>
<summary>Solution</summary></p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#005-facts-__codelineno-18-1"></a><span class="nn">---</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#005-facts-__codelineno-18-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#005-facts-__codelineno-18-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#005-facts-__codelineno-18-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print total memory</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#005-facts-__codelineno-18-5"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#005-facts-__codelineno-18-6"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Total</span><span class="nv"> </span><span class="s">memory:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_memory_mb.real.total</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">MB&quot;</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p>Create a playbook that checks the default gateway and prints it.</p>
<p><details>
<summary>Solution</summary></p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#005-facts-__codelineno-19-1"></a><span class="nn">---</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#005-facts-__codelineno-19-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#005-facts-__codelineno-19-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#005-facts-__codelineno-19-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print default gateway</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#005-facts-__codelineno-19-5"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#005-facts-__codelineno-19-6"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Default</span><span class="nv"> </span><span class="s">gateway:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_default_ipv4.gateway</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p>Create a playbook that sets a custom fact <code>backup_required</code> to <code>yes</code> and prints a message if backup is required.</p>
<p><details>
<summary>Solution</summary></p>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#005-facts-__codelineno-20-1"></a><span class="nn">---</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#005-facts-__codelineno-20-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#005-facts-__codelineno-20-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#005-facts-__codelineno-20-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set custom fact</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#005-facts-__codelineno-20-5"></a><span class="w">      </span><span class="nt">ansible.builtin.set_fact</span><span class="p">:</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#005-facts-__codelineno-20-6"></a><span class="w">        </span><span class="nt">backup_required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#005-facts-__codelineno-20-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print message if backup required</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#005-facts-__codelineno-20-8"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#005-facts-__codelineno-20-9"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Backup</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">required&quot;</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#005-facts-__codelineno-20-10"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backup_required == &quot;yes&quot;</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p>Create a playbook that uses the <code>ansible_user</code> fact to print the current user on each host.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#005-facts-__codelineno-21-1"></a><span class="nn">---</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#005-facts-__codelineno-21-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#005-facts-__codelineno-21-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#005-facts-__codelineno-21-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print current user</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#005-facts-__codelineno-21-5"></a><span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#005-facts-__codelineno-21-6"></a><span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Current</span><span class="nv"> </span><span class="s">user:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_user</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Print the IP addresses of all the machines.</p>
<p><details>
<summary>Solution</summary></p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#005-facts-__codelineno-22-1"></a>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>setup<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;filter=ansible_default_ipv4.address&quot;</span>
</span></code></pre></div>
</details></p>
</li>
<li>
<p><strong>Bonus</strong> - Try printing the address of <code>linux-server-2</code> only, without modifying the inventory file.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#005-facts-__codelineno-23-1"></a>ansible<span class="w"> </span>linux-server-2<span class="w"> </span>-m<span class="w"> </span>setup<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;filter=ansible_default_ipv4.address&quot;</span>
</span></code></pre></div>
</details>
</li>
</ul>
<hr />
<h2 id="005-facts-07-summary">07. <strong>Summary</strong><a class="headerlink" href="#005-facts-07-summary" title="Permanent link">&para;</a></h2>
<p>üîπ Ansible <strong>facts</strong> provide system details dynamically.<br />
üîπ They are automatically gathered using the <code>setup</code> module.<br />
üîπ They are useful for <strong>conditional logic</strong> in playbooks.<br />
üîπ Facts may include <strong>OS, networking, CPU, memory and more</strong>.<br />
üîπ Custom facts can be created for <strong>customized automation</strong>.</p></section><section class="print-page" id="006-git" heading-number="2.8"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-006.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-006.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="006-git-lab-006-git-integration-with-ansible">Lab 006 - Git Integration with Ansible<a class="headerlink" href="#006-git-lab-006-git-integration-with-ansible" title="Permanent link">&para;</a></h1>
<ul>
<li>In this section, we will cover <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html"><strong>Git integration with Ansible</strong></a>.</li>
<li>We will learn how to automate <strong>Git</strong> operations on remote servers using <strong>Ansible</strong> playbooks.</li>
<li>This is useful for deploying code, managing repositories, and keeping your infrastructure up to date.</li>
</ul>
<p><img src="../assets/images/Ansible-Git.png" width="800px" style="border-radius: 10px;"></p>
<hr />
<h2 id="006-git-01-git-module-basics">01. Git Module Basics<a class="headerlink" href="#006-git-01-git-module-basics" title="Permanent link">&para;</a></h2>
<ul>
<li>Ansible provides the <code>ansible.builtin.git</code> module to manage Git repositories on remote hosts.</li>
<li>The module supports cloning, pulling, checking out branches/tags, and more.</li>
<li>
<p>Key parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>repo</code></td>
<td>URL of the Git repository</td>
</tr>
<tr>
<td><code>dest</code></td>
<td>Destination path on the remote host</td>
</tr>
<tr>
<td><code>version</code></td>
<td>Branch, tag, or commit to checkout (default: HEAD)</td>
</tr>
<tr>
<td><code>force</code></td>
<td>Force checkout/update even if working directory is dirty</td>
</tr>
<tr>
<td><code>update</code></td>
<td>Pull latest changes if repository already exists (default: yes)</td>
</tr>
<tr>
<td><code>clone</code></td>
<td>Perform clone operation (default: yes)</td>
</tr>
</tbody>
</table>
<ul>
<li>For more details, refer to the <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html">Ansible Git module documentation</a>.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="006-git-ansible-git-ansiblebuiltingit-examples">Ansible Git <code>ansible.builtin.git</code> examples:<a class="headerlink" href="#006-git-ansible-git-ansiblebuiltingit-examples" title="Permanent link">&para;</a></h4>
<h2 id="006-git-02-cloning-repositories">02. Cloning Repositories<a class="headerlink" href="#006-git-02-cloning-repositories" title="Permanent link">&para;</a></h2>
<ul>
<li>Use the <code>git</code> module to clone a repository to a remote server.</li>
<li>Specify the <code>repo</code> and <code>dest</code> parameters.</li>
<li>If the repository already exists at the destination, it will not be cloned again unless <code>force</code> is set to <code>yes</code>.</li>
<li>By default, the latest commit from the default branch is checked out.</li>
<li>
<p>Here is an example playbook that clones a public Git repository:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#006-git-__codelineno-0-1"></a><span class="nn">---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#006-git-__codelineno-0-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#006-git-__codelineno-0-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#006-git-__codelineno-0-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clone a public Git repository</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#006-git-__codelineno-0-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#006-git-__codelineno-0-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/octocat/Hello-World.git&#39;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#006-git-__codelineno-0-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/hello-world</span>
</span></code></pre></div>
</li>
<li>
<p><strong>Example: Cloning with Specific Branch</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#006-git-__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#006-git-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#006-git-__codelineno-1-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#006-git-__codelineno-1-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clone repository and checkout specific branch</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#006-git-__codelineno-1-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#006-git-__codelineno-1-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/repo.git&#39;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#006-git-__codelineno-1-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#006-git-__codelineno-1-8"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="006-git-03-updating-repositories">03. <strong>Updating Repositories</strong><a class="headerlink" href="#006-git-03-updating-repositories" title="Permanent link">&para;</a></h2>
<ul>
<li>The <code>git</code> module automatically pulls changes if the repository exists and <code>update</code> is true.</li>
<li>Use <code>force: yes</code> to overwrite local changes.</li>
</ul>
<h4 id="006-git-example-pull-latest-changes"><strong>Example: Pull Latest Changes</strong><a class="headerlink" href="#006-git-example-pull-latest-changes" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#006-git-__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#006-git-__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#006-git-__codelineno-2-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#006-git-__codelineno-2-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update repository to latest commit</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#006-git-__codelineno-2-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#006-git-__codelineno-2-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/repo.git&#39;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#006-git-__codelineno-2-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#006-git-__codelineno-2-8"></a><span class="w">        </span><span class="nt">update</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#006-git-__codelineno-2-9"></a><span class="w">        </span><span class="nt">force</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span></code></pre></div>
<hr />
<h2 id="006-git-04-working-with-branches-and-tags">04. <strong>Working with Branches and Tags</strong><a class="headerlink" href="#006-git-04-working-with-branches-and-tags" title="Permanent link">&para;</a></h2>
<ul>
<li>Use the <code>version</code> parameter to checkout specific branches, tags, or commits.</li>
</ul>
<h4 id="006-git-example-checkout-a-tag"><strong>Example: Checkout a Tag</strong><a class="headerlink" href="#006-git-example-checkout-a-tag" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#006-git-__codelineno-3-1"></a><span class="nn">---</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#006-git-__codelineno-3-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#006-git-__codelineno-3-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#006-git-__codelineno-3-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout specific tag</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#006-git-__codelineno-3-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#006-git-__codelineno-3-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/repo.git&#39;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#006-git-__codelineno-3-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#006-git-__codelineno-3-8"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0.0</span>
</span></code></pre></div>
<h4 id="006-git-example-switch-branches"><strong>Example: Switch Branches</strong><a class="headerlink" href="#006-git-example-switch-branches" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#006-git-__codelineno-4-1"></a><span class="nn">---</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#006-git-__codelineno-4-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#006-git-__codelineno-4-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#006-git-__codelineno-4-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Switch to main branch</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#006-git-__codelineno-4-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#006-git-__codelineno-4-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/repo.git&#39;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#006-git-__codelineno-4-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#006-git-__codelineno-4-8"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span></code></pre></div>
<hr />
<h2 id="006-git-05-authentication-and-ssh">05. <strong>Authentication and SSH</strong><a class="headerlink" href="#006-git-05-authentication-and-ssh" title="Permanent link">&para;</a></h2>
<ul>
<li>For private repositories, use SSH keys or HTTPS with credentials.</li>
<li>Ensure SSH keys are properly configured on the Ansible controller and remote hosts.</li>
</ul>
<h4 id="006-git-example-using-ssh-key"><strong>Example: Using SSH Key</strong><a class="headerlink" href="#006-git-example-using-ssh-key" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#006-git-__codelineno-5-1"></a><span class="nn">---</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#006-git-__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#006-git-__codelineno-5-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#006-git-__codelineno-5-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clone private repo using SSH</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#006-git-__codelineno-5-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#006-git-__codelineno-5-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;git@github.com:example/private-repo.git&#39;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#006-git-__codelineno-5-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/private-app</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#006-git-__codelineno-5-8"></a><span class="w">        </span><span class="nt">key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/ansible/.ssh/id_rsa</span>
</span></code></pre></div>
<h4 id="006-git-example-using-https-with-token"><strong>Example: Using HTTPS with Token</strong><a class="headerlink" href="#006-git-example-using-https-with-token" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#006-git-__codelineno-6-1"></a><span class="nn">---</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#006-git-__codelineno-6-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#006-git-__codelineno-6-3"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#006-git-__codelineno-6-4"></a><span class="w">    </span><span class="nt">git_token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;GIT_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#006-git-__codelineno-6-5"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#006-git-__codelineno-6-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clone with HTTPS authentication</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#006-git-__codelineno-6-7"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#006-git-__codelineno-6-8"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://{{</span><span class="nv"> </span><span class="s">git_token</span><span class="nv"> </span><span class="s">}}@github.com/example/repo.git&quot;</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#006-git-__codelineno-6-9"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span></code></pre></div>
<hr />
<h2 id="006-git-06-common-patterns-and-best-practices">06. <strong>Common Patterns and Best Practices</strong><a class="headerlink" href="#006-git-06-common-patterns-and-best-practices" title="Permanent link">&para;</a></h2>
<ul>
<li>Always use absolute paths for <code>dest</code>.</li>
<li>Handle idempotency by letting the module manage updates.</li>
<li>Use <code>force: yes</code> carefully as it can overwrite changes.</li>
<li>Store sensitive information like tokens in Ansible Vault.</li>
</ul>
<h4 id="006-git-example-idempotent-deployment"><strong>Example: Idempotent Deployment</strong><a class="headerlink" href="#006-git-example-idempotent-deployment" title="Permanent link">&para;</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#006-git-__codelineno-7-1"></a><span class="nn">---</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#006-git-__codelineno-7-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#006-git-__codelineno-7-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#006-git-__codelineno-7-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure application is at latest version</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#006-git-__codelineno-7-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#006-git-__codelineno-7-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/app.git&#39;</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#006-git-__codelineno-7-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#006-git-__codelineno-7-8"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#006-git-__codelineno-7-9"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git_result</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#006-git-__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#006-git-__codelineno-7-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart service if code changed</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#006-git-__codelineno-7-12"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#006-git-__codelineno-7-13"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#006-git-__codelineno-7-14"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#006-git-__codelineno-7-15"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git_result.changed</span>
</span></code></pre></div>
<hr />
<h2 id="006-git-07-hands-on">07. <strong>Hands-on</strong><a class="headerlink" href="#006-git-07-hands-on" title="Permanent link">&para;</a></h2>
<p><img src="../assets/images/practice.png" width="800px">
<br/></p>
<ul>
<li>
<p>Clone a public Git repository to <code>/opt/hello-world</code> on your target servers.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#006-git-__codelineno-8-1"></a><span class="nn">---</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#006-git-__codelineno-8-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#006-git-__codelineno-8-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#006-git-__codelineno-8-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clone Hello World repository</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#006-git-__codelineno-8-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#006-git-__codelineno-8-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/octocat/Hello-World.git&#39;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#006-git-__codelineno-8-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/hello-world</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Create a playbook that clones a repository and checks out a specific branch called <code>develop</code>.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#006-git-__codelineno-9-1"></a><span class="nn">---</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#006-git-__codelineno-9-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#006-git-__codelineno-9-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#006-git-__codelineno-9-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clone and checkout develop branch</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#006-git-__codelineno-9-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#006-git-__codelineno-9-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/repo.git&#39;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#006-git-__codelineno-9-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#006-git-__codelineno-9-8"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Write a playbook that updates an existing repository to the latest commit on the main branch.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#006-git-__codelineno-10-1"></a><span class="nn">---</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#006-git-__codelineno-10-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#006-git-__codelineno-10-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#006-git-__codelineno-10-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update repository to latest main</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#006-git-__codelineno-10-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#006-git-__codelineno-10-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/repo.git&#39;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#006-git-__codelineno-10-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#006-git-__codelineno-10-8"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#006-git-__codelineno-10-9"></a><span class="w">        </span><span class="nt">update</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Create a playbook that checks out a specific tag (e.g., <code>v1.0.0</code>) from a repository.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#006-git-__codelineno-11-1"></a><span class="nn">---</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#006-git-__codelineno-11-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#006-git-__codelineno-11-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#006-git-__codelineno-11-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout specific tag</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#006-git-__codelineno-11-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#006-git-__codelineno-11-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/repo.git&#39;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#006-git-__codelineno-11-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#006-git-__codelineno-11-8"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0.0</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Modify a playbook to force update a repository, overwriting any local changes.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#006-git-__codelineno-12-1"></a><span class="nn">---</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#006-git-__codelineno-12-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#006-git-__codelineno-12-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#006-git-__codelineno-12-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Force update repository</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#006-git-__codelineno-12-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#006-git-__codelineno-12-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/repo.git&#39;</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#006-git-__codelineno-12-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#006-git-__codelineno-12-8"></a><span class="w">        </span><span class="nt">force</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Create a playbook that clones a repository and restarts a service if the code was updated.</p>
<p><details>
<summary>Solution</summary></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#006-git-__codelineno-13-1"></a><span class="nn">---</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#006-git-__codelineno-13-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#006-git-__codelineno-13-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#006-git-__codelineno-13-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#006-git-__codelineno-13-5"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#006-git-__codelineno-13-6"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://github.com/example/app.git&#39;</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#006-git-__codelineno-13-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/myapp</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#006-git-__codelineno-13-8"></a><span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git_deploy</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#006-git-__codelineno-13-9"></a>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#006-git-__codelineno-13-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart service if changed</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#006-git-__codelineno-13-11"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#006-git-__codelineno-13-12"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#006-git-__codelineno-13-13"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#006-git-__codelineno-13-14"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git_deploy.changed</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>Set up SSH key authentication for cloning a private repository.</p>
<p><details>
<summary>Solution</summary></p>
<p>First, ensure SSH key is copied to the remote host:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#006-git-__codelineno-14-1"></a><span class="nn">---</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#006-git-__codelineno-14-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#006-git-__codelineno-14-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#006-git-__codelineno-14-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy SSH private key</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#006-git-__codelineno-14-5"></a><span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#006-git-__codelineno-14-6"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.ssh/id_rsa</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#006-git-__codelineno-14-7"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/ansible/.ssh/id_rsa</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#006-git-__codelineno-14-8"></a><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0600&#39;</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#006-git-__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#006-git-__codelineno-14-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Clone private repository</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#006-git-__codelineno-14-11"></a><span class="w">      </span><span class="nt">ansible.builtin.git</span><span class="p">:</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#006-git-__codelineno-14-12"></a><span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;git@github.com:example/private-repo.git&#39;</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#006-git-__codelineno-14-13"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/private-app</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#006-git-__codelineno-14-14"></a><span class="w">        </span><span class="nt">key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/ansible/.ssh/id_rsa</span>
</span></code></pre></div>
</details>
</li>
</ul>
<hr />
<h2 id="006-git-08-summary">08. <strong>Summary</strong><a class="headerlink" href="#006-git-08-summary" title="Permanent link">&para;</a></h2>
<p>üîπ Use <code>ansible.builtin.git</code> module for Git operations in playbooks.<br />
üîπ Supports cloning, pulling, and checking out branches/tags.<br />
üîπ Ensure proper authentication for private repositories.<br />
üîπ Leverage idempotency for safe repeated runs.<br />
üîπ Combine with other modules for complete deployment workflows.</p></section><section class="print-page" id="007-create-user" heading-number="2.9"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-007.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-007.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="007-create-user-lab-007-create-user-with-ansible">Lab 007 - Create user with Ansible<a class="headerlink" href="#007-create-user-lab-007-create-user-with-ansible" title="Permanent link">&para;</a></h1>
<ul>
<li>In this section we will understand how to use the <code>Create User Playbook</code>.</li>
<li>We will have hands-on experience in writing it ourselves using a sample playbook.</li>
<li>We will review the playbook&rsquo;s <code>vars</code>, <code>become</code>, <code>changed_when</code> sections.</li>
<li>We will edit the script to create another user with different name and password.</li>
</ul>
<p><img src="../assets/images/ansible-user.jpeg" width="400px">
  <br/></p>
<hr />
<h2 id="007-create-user-01-ansibles-user-module">01. Ansible&rsquo;s <code>user</code> module<a class="headerlink" href="#007-create-user-01-ansibles-user-module" title="Permanent link">&para;</a></h2>
<ul>
<li>Ansible&rsquo;s <code>user</code> module is a powerful tool for managing user accounts on remote systems. It allows you to create, update, and remove users, set passwords, manage groups, and configure SSH keys. This is essential in automating system administration tasks.</li>
<li>See the <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html">Ansible <code>user module</code> documentation</a>.</li>
</ul>
<hr />
<h2 id="007-create-user-02-create-a-user">02. Create a user<a class="headerlink" href="#007-create-user-02-create-a-user" title="Permanent link">&para;</a></h2>
<ul>
<li>See the below basic example for creating a user named <code>username</code> with a hashed password, adding them to the <code>wheel</code> group, and generating an SSH key.</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#007-create-user-__codelineno-0-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create a new user</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#007-create-user-__codelineno-0-2"></a><span class="w">  </span><span class="nt">ansible.builtin.user</span><span class="p">:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#007-create-user-__codelineno-0-3"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;username&quot;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#007-create-user-__codelineno-0-4"></a><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">&#39;password&#39;</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">password_hash(&#39;sha512&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#007-create-user-__codelineno-0-5"></a><span class="w">    </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wheel&quot;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#007-create-user-__codelineno-0-6"></a><span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#007-create-user-__codelineno-0-7"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#007-create-user-__codelineno-0-8"></a><span class="w">    </span><span class="nt">create_home</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#007-create-user-__codelineno-0-9"></a><span class="w">    </span><span class="nt">generate_ssh_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<ul>
<li>See the below advanced example, including <code>custom home</code>, <code>expiry</code>, and <code>comment</code></li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#007-create-user-__codelineno-1-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create a user with custom options</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#007-create-user-__codelineno-1-2"></a><span class="w">  </span><span class="nt">ansible.builtin.user</span><span class="p">:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#007-create-user-__codelineno-1-3"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;devops&quot;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#007-create-user-__codelineno-1-4"></a><span class="w">    </span><span class="nt">comment</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DevOps</span><span class="nv"> </span><span class="s">Engineer&quot;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#007-create-user-__codelineno-1-5"></a><span class="w">    </span><span class="nt">home</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/opt/devops&quot;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#007-create-user-__codelineno-1-6"></a><span class="w">    </span><span class="nt">expires</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1751328000</span><span class="w">  </span><span class="c1"># Unix timestamp for expiry</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#007-create-user-__codelineno-1-7"></a><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">&#39;SuperSecret123&#39;</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">password_hash(&#39;sha512&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#007-create-user-__codelineno-1-8"></a><span class="w">    </span><span class="nt">groups</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sudo&quot;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#007-create-user-__codelineno-1-9"></a><span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/zsh</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#007-create-user-__codelineno-1-10"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#007-create-user-__codelineno-1-11"></a><span class="w">    </span><span class="nt">create_home</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<hr />
<h2 id="007-create-user-03-password-management">03. Password management<a class="headerlink" href="#007-create-user-03-password-management" title="Permanent link">&para;</a></h2>
<ul>
<li>Always hash passwords using the <code>password_hash</code> filter for security.</li>
<li>Example:
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#007-create-user-__codelineno-2-1"></a><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">&#39;mysecret&#39;</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">password_hash(&#39;sha512&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div></li>
<li>You can generate a hash in Python:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#007-create-user-__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">crypt</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#007-create-user-__codelineno-3-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">crypt</span><span class="o">.</span><span class="n">crypt</span><span class="p">(</span><span class="s1">&#39;mysecret&#39;</span><span class="p">,</span> <span class="n">crypt</span><span class="o">.</span><span class="n">mksalt</span><span class="p">(</span><span class="n">crypt</span><span class="o">.</span><span class="n">METHOD_SHA512</span><span class="p">)))</span>
</span></code></pre></div></li>
<li>See the <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html#hashing"><code>password hash</code> in Ansible documentation</a>.</li>
</ul>
<hr />
<h2 id="007-create-user-04-ssh-key-setup">04. SSH key setup<a class="headerlink" href="#007-create-user-04-ssh-key-setup" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>generate_ssh_key: true</code> to automatically create an SSH key for the user.</li>
<li>You can specify key type and file:
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#007-create-user-__codelineno-4-1"></a><span class="nt">generate_ssh_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#007-create-user-__codelineno-4-2"></a><span class="nt">ssh_key_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rsa</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#007-create-user-__codelineno-4-3"></a><span class="nt">ssh_key_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4096</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#007-create-user-__codelineno-4-4"></a><span class="nt">ssh_key_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.ssh/id_rsa</span>
</span></code></pre></div></li>
</ul>
<h2 id="007-create-user-05-troubleshooting-verification">05. Troubleshooting &amp; verification<a class="headerlink" href="#007-create-user-05-troubleshooting-verification" title="Permanent link">&para;</a></h2>
<ul>
<li>Use the <code>command</code> module to verify user creation:
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#007-create-user-__codelineno-5-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify user</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#007-create-user-__codelineno-5-2"></a><span class="w">  </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;id</span><span class="nv"> </span><span class="s">username&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#007-create-user-__codelineno-5-3"></a><span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user_info</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#007-create-user-__codelineno-5-4"></a><span class="w">  </span><span class="nt">changed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#007-create-user-__codelineno-5-5"></a><span class="w">  </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user_info.rc != 0</span>
</span></code></pre></div></li>
<li>See <code>/etc/passwd</code> and <code>/etc/group</code> for user and group info.</li>
</ul>
<h2 id="007-create-user-06-best-practices">06. Best practices<a class="headerlink" href="#007-create-user-06-best-practices" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>become: true</code> for privilege escalation.</li>
<li>Use variables for usernames and passwords to avoid hardcoding.</li>
<li>Document your playbooks for clarity.</li>
<li>Clean up users with <code>state: absent</code> when needed.</li>
</ul></section><section class="print-page" id="008-challenges" heading-number="2.10"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-008.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-008.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="008-challenges-lab-008-challenges">Lab 008 - Challenges<a class="headerlink" href="#008-challenges-lab-008-challenges" title="Permanent link">&para;</a></h1>
<h2 id="008-challenges-01-task-01">01. Task 01:<a class="headerlink" href="#008-challenges-01-task-01" title="Permanent link">&para;</a></h2>
<p>1Ô∏è‚É£ Create a user named <code>&lt;hostname&gt;</code> for each machine.</p>
<p>2Ô∏è‚É£ Verify that the user was created.</p>
<p>3Ô∏è‚É£ Create an ansible inventory with the username in the configuration, using the format below:
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#008-challenges-__codelineno-0-1"></a>&lt;hostname&gt;<span class="w">    </span><span class="nv">ansible_host</span><span class="o">=</span>&lt;hostname&gt;<span class="w"> </span><span class="nv">ansible_ssh_user</span><span class="o">=</span>&lt;user&gt;
</span></code></pre></div></p>
<hr />
<h2 id="008-challenges-02-task-02">02. Task 02:<a class="headerlink" href="#008-challenges-02-task-02" title="Permanent link">&para;</a></h2>
<p>1Ô∏è‚É£ Clone a <code>git</code> repository from your <a href="https://github.com">GitHub</a> or <a href="https://gitlab.com">GitLab</a> account.</p>
<p>2Ô∏è‚É£ Commit changes to the repository.</p>
<p>3Ô∏è‚É£ Push the changes to the repository.</p></section><section class="print-page" id="009-roles" heading-number="2.11"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-009.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-009.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="009-roles-lab-009-roles">Lab 009 - Roles<a class="headerlink" href="#009-roles-lab-009-roles" title="Permanent link">&para;</a></h1>
<h2 id="009-roles-01-what-are-ansible-roles">01. What are Ansible roles?<a class="headerlink" href="#009-roles-01-what-are-ansible-roles" title="Permanent link">&para;</a></h2>
<ul>
<li>Roles let you <strong>automatically load</strong> related <code>vars</code>, <code>files</code>, <code>tasks</code>, <code>handlers</code>, and other Ansible artifacts based on a <strong>known file structure</strong>. </li>
<li>After you group your content into roles, you can easily reuse them and share them with other users.</li>
<li>By default, Ansible will look in <strong>each directory</strong> within a role for the file names <code>main</code>/<code>main.yml</code>/<code>main.yaml</code>.</li>
</ul>
<p><img src="../assets/images/ansible-roles.jpg" width="700px">
  <br/></p>
<hr />
<h2 id="009-roles-02-ansible-roles-file-structure">02. Ansible roles file structure<a class="headerlink" href="#009-roles-02-ansible-roles-file-structure" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Files</th>
<th><u>Description</u></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>tasks</strong></td>
<td>the main list of tasks that the role executes</td>
</tr>
<tr>
<td><strong>handlers</strong></td>
<td>handlers, which may be used within or outside this role</td>
</tr>
<tr>
<td><strong>library</strong></td>
<td>modules, which may be used within this role (see <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse_roles.html#embedding-modules-and-plugins-in-roles">Embedding modules and plugins in roles</a> for more information)</td>
</tr>
<tr>
<td><strong>defaults</strong></td>
<td>default variables for the role (see <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html">Using Variables</a> for more information) <br/>these variables have the lowest priority of any variables available and can be easily overridden by any other variable, including <code>inventory variables</code></td>
</tr>
<tr>
<td><strong>vars</strong></td>
<td>other variables for the role (see <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html">Using Variables</a> for more information)</td>
</tr>
<tr>
<td><strong>files</strong></td>
<td>files that the role deploys</td>
</tr>
<tr>
<td><strong>templates</strong></td>
<td>templates that the role deploys</td>
</tr>
<tr>
<td><strong>meta</strong></td>
<td>metadata for the role, including role dependencies and optional Galaxy metadata, such as supported platforms</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="009-roles-03-building-an-ansible-role">03. Building an Ansible role<a class="headerlink" href="#009-roles-03-building-an-ansible-role" title="Permanent link">&para;</a></h2>
<ul>
<li>In this demo we will create a role for deploying a <code>nodeJS</code> app.</li>
<li>The app will be deployed from a pre-defined code.</li>
<li>Each server will be deployed with its own configuration (values).</li>
<li>We will also deploy some other files for learning purposes.</li>
</ul>
<hr />
<h2 id="009-roles-04-initialize-file-structure">04. Initialize file structure<a class="headerlink" href="#009-roles-04-initialize-file-structure" title="Permanent link">&para;</a></h2>
<p><div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#009-roles-__codelineno-0-1"></a><span class="c1"># Lets create the roles file structure</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#009-roles-__codelineno-0-2"></a>ansible-galaxy<span class="w"> </span>init<span class="w"> </span>codewizard_lab_role
</span></code></pre></div>
 <br/>
- The file system of the role will look like:</p>
<p><img src="../assets/images/ansible-role-structure.png" width="700px">
 <br/></p>
<h2 id="009-roles-05-create-the-role-content">05. Create the role content<a class="headerlink" href="#009-roles-05-create-the-role-content" title="Permanent link">&para;</a></h2>
<ul>
<li>
<h4 id="009-roles-create-the-defaultsmainyml">Create the <code>defaults/main.yml</code><a class="headerlink" href="#009-roles-create-the-defaultsmainyml" title="Permanent link">&para;</a></h4>
</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#009-roles-__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#009-roles-__codelineno-1-2"></a><span class="c1">### defaults/main.yml</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#009-roles-__codelineno-1-3"></a><span class="c1">###</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#009-roles-__codelineno-1-4"></a><span class="c1">### This file contains the variables for the Demo lab</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#009-roles-__codelineno-1-5"></a><span class="c1">###</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#009-roles-__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#009-roles-__codelineno-1-7"></a><span class="c1"># Defaults file for codewizard_lab_role</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#009-roles-__codelineno-1-8"></a><span class="nt">motd_message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Welcome</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Ansible</span><span class="nv"> </span><span class="s">Roles</span><span class="nv"> </span><span class="s">Lab&quot;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#009-roles-__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#009-roles-__codelineno-1-10"></a><span class="c1">### The packages we wish to install on the servers</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#009-roles-__codelineno-1-11"></a><span class="nt">apt_packages</span><span class="p">:</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#009-roles-__codelineno-1-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#009-roles-__codelineno-1-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nodejs</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#009-roles-__codelineno-1-14"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#009-roles-__codelineno-1-15"></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#009-roles-__codelineno-1-16"></a><span class="c1"># Packages to verify that they were installed</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#009-roles-__codelineno-1-17"></a><span class="nt">apt_packages_verify</span><span class="p">:</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#009-roles-__codelineno-1-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python3</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#009-roles-__codelineno-1-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#009-roles-__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#009-roles-__codelineno-1-21"></a><span class="nt">package_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span></code></pre></div>
<ul>
<li>
<h4 id="009-roles-create-the-templates">Create the templates<a class="headerlink" href="#009-roles-create-the-templates" title="Permanent link">&para;</a></h4>
</li>
</ul>
<p>&ndash; templates/motd.j2
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#009-roles-__codelineno-2-1"></a><span class="c1">### templates/motd.j2</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#009-roles-__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#009-roles-__codelineno-2-3"></a><span class="l l-Scalar l-Scalar-Plain">_____             _          _    _  _                      _</span><span class="w"> </span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#009-roles-__codelineno-2-4"></a><span class="l l-Scalar l-Scalar-Plain">/  __ \           | |        | |  | |(_)                    | |</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#009-roles-__codelineno-2-5"></a><span class="l l-Scalar l-Scalar-Plain">| /  \/  ___    __| |  ___   | |  | | _  ____ __ _  _ __  __| |</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#009-roles-__codelineno-2-6"></a><span class="l l-Scalar l-Scalar-Plain">| |     / _ \  / _` | / _ \  | |/\| || ||_  // _` || &#39;__|/ _` |</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#009-roles-__codelineno-2-7"></a><span class="l l-Scalar l-Scalar-Plain">| \__/\| (_) || (_| ||  __/  \  /\  /| | / /| (_| || |  | (_| |</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#009-roles-__codelineno-2-8"></a><span class="l l-Scalar l-Scalar-Plain">\____/ \___/  \__,_| \___|   \/  \/ |_|/___|\__,_||_|   \__,_|</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#009-roles-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#009-roles-__codelineno-2-10"></a><span class="l l-Scalar l-Scalar-Plain">{{ motd_message }}</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#009-roles-__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#009-roles-__codelineno-2-12"></a><span class="l l-Scalar l-Scalar-Plain">System information</span><span class="p p-Indicator">:</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#009-roles-__codelineno-2-13"></a><span class="l l-Scalar l-Scalar-Plain">-------------------</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#009-roles-__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#009-roles-__codelineno-2-15"></a><span class="nt">OS</span><span class="p">:</span><span class="w">         </span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">ansible_distribution</span><span class="w"> </span><span class="p p-Indicator">}}</span><span class="w"> </span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">ansible_distribution_version</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#009-roles-__codelineno-2-16"></a><span class="nt">Hostname</span><span class="p">:</span><span class="w">   </span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">inventory_hostname</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#009-roles-__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#009-roles-__codelineno-2-18"></a><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">custom_message | default(&#39;&#39;)</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</span></code></pre></div></p>
<p><br/></p>
<p>&ndash; templates/node-server.j2
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#009-roles-__codelineno-3-1"></a><span class="c1">### templates/node-server.j2</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#009-roles-__codelineno-3-2"></a><span class="l l-Scalar l-Scalar-Plain">const</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#009-roles-__codelineno-3-3"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">// Set the server port which will be listening to</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#009-roles-__codelineno-3-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">// Those 2 values are passed from the env file</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#009-roles-__codelineno-3-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">SERVER_PORT = 5000,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#009-roles-__codelineno-3-6"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">SERVER_NAME = &quot;{{ inventory_hostname }}&quot;;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#009-roles-__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#009-roles-__codelineno-3-8"></a><span class="l l-Scalar l-Scalar-Plain">// Create the basic http server</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#009-roles-__codelineno-3-9"></a><span class="l l-Scalar l-Scalar-Plain">require(&#39;http&#39;)</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#009-roles-__codelineno-3-10"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">.createServer((request, response) =&gt; {</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#009-roles-__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#009-roles-__codelineno-3-12"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">// Send reply to user</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#009-roles-__codelineno-3-13"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">response.end(`&lt;h1&gt;Hello from ${SERVER_NAME}.&lt;/h1&gt;`);</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#009-roles-__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#009-roles-__codelineno-3-15"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}).listen(SERVER_PORT, () =&gt; {</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#009-roles-__codelineno-3-16"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">// Notify users that the server is up and running</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#009-roles-__codelineno-3-17"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">console.log(`${SERVER_NAME} is up.</span><span class="w"> </span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#009-roles-__codelineno-3-18"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">Please click or point your browser to</span><span class="p p-Indicator">:</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#009-roles-__codelineno-3-19"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:${SERVER_PORT}`);</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#009-roles-__codelineno-3-20"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">});</span>
</span></code></pre></div></p>
<ul>
<li>
<h4 id="009-roles-create-the-tasks-for-the-role">Create the tasks for the role<a class="headerlink" href="#009-roles-create-the-tasks-for-the-role" title="Permanent link">&para;</a></h4>
</li>
<li>
<p>In this example we will have multiple tasks for learning purposes.</p>
</li>
<li>We will need to create the tasks for each role.</li>
<li>Once the tasks are ready, we can define them in the main task file.</li>
</ul>
<p>&mdash; tasks/pre-requirements.yaml
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#009-roles-__codelineno-4-1"></a><span class="c1">### tasks/pre-requirements.yaml</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#009-roles-__codelineno-4-2"></a><span class="nn">---</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#009-roles-__codelineno-4-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Packages</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#009-roles-__codelineno-4-4"></a><span class="w">  </span><span class="nt">ansible.builtin.apt</span><span class="p">:</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#009-roles-__codelineno-4-5"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#009-roles-__codelineno-4-6"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">package_state</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#009-roles-__codelineno-4-7"></a><span class="w">  </span><span class="c1"># Loop over the required packages to install</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#009-roles-__codelineno-4-8"></a><span class="w">  </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">apt_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#009-roles-__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#009-roles-__codelineno-4-10"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify Packages Installation</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#009-roles-__codelineno-4-11"></a><span class="w">  </span><span class="nt">ansible.builtin.command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">--version&quot;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#009-roles-__codelineno-4-12"></a><span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">packages_version</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#009-roles-__codelineno-4-13"></a><span class="w">  </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">apt_packages_verify</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#009-roles-__codelineno-4-14"></a>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#009-roles-__codelineno-4-15"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print package version</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#009-roles-__codelineno-4-16"></a><span class="w">  </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#009-roles-__codelineno-4-17"></a><span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.stdout_lines</span><span class="nv">  </span><span class="s">}}&quot;</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#009-roles-__codelineno-4-18"></a><span class="w">  </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">packages_version.results</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div></p>
<p>&mdash; tasks/node-server.yaml</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#009-roles-__codelineno-5-1"></a><span class="w">  </span><span class="c1">### tasks/node-server.yaml</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#009-roles-__codelineno-5-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">---</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#009-roles-__codelineno-5-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy Node server</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#009-roles-__codelineno-5-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">ansible.builtin.template</span><span class="p p-Indicator">:</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#009-roles-__codelineno-5-5"></a><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">templates/node-server.j2</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#009-roles-__codelineno-5-6"></a><span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/node-server.js</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#009-roles-__codelineno-5-7"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#009-roles-__codelineno-5-8"></a><span class="w">  </span><span class="w w-Error">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#009-roles-__codelineno-5-9"></a><span class="w">    </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible.builtin.su</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#009-roles-__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#009-roles-__codelineno-5-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install &quot;pm2&quot; node.js package.</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#009-roles-__codelineno-5-12"></a><span class="w">    </span><span class="nt">community.general.npm</span><span class="p">:</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#009-roles-__codelineno-5-13"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pm2&quot;</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#009-roles-__codelineno-5-14"></a><span class="w">      </span><span class="nt">global</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#009-roles-__codelineno-5-15"></a><span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#009-roles-__codelineno-5-16"></a><span class="w">    </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible.builtin.su</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#009-roles-__codelineno-5-17"></a>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#009-roles-__codelineno-5-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get running node processes</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#009-roles-__codelineno-5-19"></a><span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ps</span><span class="nv"> </span><span class="s">-ef</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">grep</span><span class="nv"> </span><span class="s">-v</span><span class="nv"> </span><span class="s">grep</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">grep</span><span class="nv"> </span><span class="s">-w</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">awk</span><span class="nv"> </span><span class="s">&#39;{print</span><span class="nv"> </span><span class="s">$2}&#39;&quot;</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#009-roles-__codelineno-5-20"></a><span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">running_processes</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#009-roles-__codelineno-5-21"></a>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#009-roles-__codelineno-5-22"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kill running node server (if any)</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#009-roles-__codelineno-5-23"></a><span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kill</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#009-roles-__codelineno-5-24"></a><span class="w">    </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">running_processes.stdout_lines</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#009-roles-__codelineno-5-25"></a>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#009-roles-__codelineno-5-26"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Wait for the process to die</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#009-roles-__codelineno-5-27"></a><span class="w">    </span><span class="nt">wait_for</span><span class="p">:</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#009-roles-__codelineno-5-28"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/proc/{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}/status&quot;</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#009-roles-__codelineno-5-29"></a><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#009-roles-__codelineno-5-30"></a><span class="w">    </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">running_processes.stdout_lines</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#009-roles-__codelineno-5-31"></a><span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#009-roles-__codelineno-5-32"></a><span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">killed_processes</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#009-roles-__codelineno-5-33"></a>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#009-roles-__codelineno-5-34"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Force kill stuck processes</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#009-roles-__codelineno-5-35"></a><span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kill</span><span class="nv"> </span><span class="s">-9</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#009-roles-__codelineno-5-36"></a><span class="w">    </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">killed_processes.results</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">select(&#39;failed&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute=&#39;item&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#009-roles-__codelineno-5-37"></a>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#009-roles-__codelineno-5-38"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Start Node server</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#009-roles-__codelineno-5-39"></a><span class="w">    </span><span class="nt">ansible.builtin.command</span><span class="p">:</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#009-roles-__codelineno-5-40"></a><span class="w">      </span><span class="nt">chdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#009-roles-__codelineno-5-41"></a><span class="w">      </span><span class="nt">cmd</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pm2</span><span class="nv"> </span><span class="s">start</span><span class="nv"> </span><span class="s">-f</span><span class="nv"> </span><span class="s">/node-server.js&quot;</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#009-roles-__codelineno-5-42"></a><span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server_status</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#009-roles-__codelineno-5-43"></a><span class="w">    </span><span class="nt">changed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server_status.rc != 0</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#009-roles-__codelineno-5-44"></a>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#009-roles-__codelineno-5-45"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print server status</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#009-roles-__codelineno-5-46"></a><span class="w">    </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#009-roles-__codelineno-5-47"></a><span class="w">      </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">server_status.stdout_lines</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#009-roles-__codelineno-5-48"></a><span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server_status.rc == 0</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#009-roles-__codelineno-5-49"></a>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#009-roles-__codelineno-5-50"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check server</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#009-roles-__codelineno-5-51"></a><span class="w">    </span><span class="nt">uri</span><span class="p">:</span>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#009-roles-__codelineno-5-52"></a><span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:5000</span>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#009-roles-__codelineno-5-53"></a><span class="w">      </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GET</span>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#009-roles-__codelineno-5-54"></a><span class="w">      </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#009-roles-__codelineno-5-55"></a><span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server_status</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#009-roles-__codelineno-5-56"></a>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#009-roles-__codelineno-5-57"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Print server status</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#009-roles-__codelineno-5-58"></a><span class="w">    </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#009-roles-__codelineno-5-59"></a><span class="w">      </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">server_status.status</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">server_status.msg</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></div>
<p>&mdash; tasks/motd.yaml
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#009-roles-__codelineno-6-1"></a><span class="w">  </span><span class="c1">### tasks/motd.j2</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#009-roles-__codelineno-6-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">---</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#009-roles-__codelineno-6-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy template</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#009-roles-__codelineno-6-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">ansible.builtin.template</span><span class="p p-Indicator">:</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#009-roles-__codelineno-6-5"></a><span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">templates/motd.j2</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#009-roles-__codelineno-6-6"></a><span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/motd</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#009-roles-__codelineno-6-7"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">preserve</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#009-roles-__codelineno-6-8"></a><span class="w">  </span><span class="w w-Error">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#009-roles-__codelineno-6-9"></a><span class="w">    </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible.builtin.su</span>
</span></code></pre></div></p>
<p>&mdash; tasks/main.yml</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#009-roles-__codelineno-7-1"></a><span class="w">  </span><span class="c1">### tasks/main.yml</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#009-roles-__codelineno-7-2"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">---</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#009-roles-__codelineno-7-3"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">- name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include Pre-Requirements task</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#009-roles-__codelineno-7-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">ansible.builtin.include_tasks</span><span class="p p-Indicator">:</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#009-roles-__codelineno-7-5"></a><span class="w">      </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pre-requirements.yaml</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#009-roles-__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#009-roles-__codelineno-7-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include motd task</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#009-roles-__codelineno-7-8"></a><span class="w">    </span><span class="nt">ansible.builtin.include_tasks</span><span class="p">:</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#009-roles-__codelineno-7-9"></a><span class="w">      </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">motd.yaml</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#009-roles-__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#009-roles-__codelineno-7-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy node server</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#009-roles-__codelineno-7-12"></a><span class="w">    </span><span class="nt">ansible.builtin.include_tasks</span><span class="p">:</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#009-roles-__codelineno-7-13"></a><span class="w">      </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-server.yaml</span>
</span></code></pre></div>
<p><br/></p>
<ul>
<li>
<h4 id="009-roles-create-the-playbook-for-the-role">Create the playbook for the role<a class="headerlink" href="#009-roles-create-the-playbook-for-the-role" title="Permanent link">&para;</a></h4>
</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#009-roles-__codelineno-8-1"></a><span class="c1">### 009-role-playbook.yml</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#009-roles-__codelineno-8-2"></a><span class="nn">---</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#009-roles-__codelineno-8-3"></a><span class="c1">###</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#009-roles-__codelineno-8-4"></a><span class="c1">### The playbook for using our role</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#009-roles-__codelineno-8-5"></a><span class="c1">### </span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#009-roles-__codelineno-8-6"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Executing codewizard_lab_role</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#009-roles-__codelineno-8-7"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#009-roles-__codelineno-8-8"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#009-roles-__codelineno-8-9"></a><span class="w">  </span><span class="nt">become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible.builtin.su</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#009-roles-__codelineno-8-10"></a>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#009-roles-__codelineno-8-11"></a><span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#009-roles-__codelineno-8-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard_lab_role</span><span class="w">  </span>
</span></code></pre></div></section><section class="print-page" id="010-loops-and-conditionals" heading-number="2.12"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-010.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-010.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="010-loops-and-conditionals-lab-010-loops-and-conditionals-in-ansible">Lab 010 - Loops and Conditionals in Ansible<a class="headerlink" href="#010-loops-and-conditionals-lab-010-loops-and-conditionals-in-ansible" title="Permanent link">&para;</a></h1>
<ul>
<li>In this section, we will cover <strong>Loops and Conditionals in Ansible</strong>.</li>
<li>Loops assist in efficiently performing repetitive tasks.</li>
<li>Conditions allow tasks to be executed based on specific criteria.</li>
<li>See documentation about <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html">Loops</a> and <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html">Conditionals</a> in Ansible.</li>
</ul>
<p><img src="../assets/images/ansible-Loop-With-items.webp" height="800px"></p>
<hr />
<h2 id="010-loops-and-conditionals-01-ansible-loops">01. Ansible Loops<a class="headerlink" href="#010-loops-and-conditionals-01-ansible-loops" title="Permanent link">&para;</a></h2>
<h4 id="010-loops-and-conditionals-basic-loop">Basic loop<a class="headerlink" href="#010-loops-and-conditionals-basic-loop" title="Permanent link">&para;</a></h4>
<ul>
<li>Ansible provides a <code>loop</code> keyword to execute tasks multiple times with different inputs:</li>
</ul>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#010-loops-and-conditionals-__codelineno-0-1"></a><span class="nn">---</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#010-loops-and-conditionals-__codelineno-0-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#010-loops-and-conditionals-__codelineno-0-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#010-loops-and-conditionals-__codelineno-0-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install multiple packages</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#010-loops-and-conditionals-__codelineno-0-5"></a><span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#010-loops-and-conditionals-__codelineno-0-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#010-loops-and-conditionals-__codelineno-0-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#010-loops-and-conditionals-__codelineno-0-8"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#010-loops-and-conditionals-__codelineno-0-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#010-loops-and-conditionals-__codelineno-0-10"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#010-loops-and-conditionals-__codelineno-0-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vim</span>
</span></code></pre></div>
<br/></p>
<h4 id="010-loops-and-conditionals-loop-with-dictionaries">Loop with dictionaries<a class="headerlink" href="#010-loops-and-conditionals-loop-with-dictionaries" title="Permanent link">&para;</a></h4>
<ul>
<li>Loops can be used with dictionaries to process structured data:</li>
</ul>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#010-loops-and-conditionals-__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#010-loops-and-conditionals-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#010-loops-and-conditionals-__codelineno-1-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#010-loops-and-conditionals-__codelineno-1-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Add multiple users</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#010-loops-and-conditionals-__codelineno-1-5"></a><span class="w">      </span><span class="nt">user</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#010-loops-and-conditionals-__codelineno-1-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#010-loops-and-conditionals-__codelineno-1-7"></a><span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.shell</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#010-loops-and-conditionals-__codelineno-1-8"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#010-loops-and-conditionals-__codelineno-1-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alice&quot;</span><span class="p p-Indicator">,</span><span class="nt"> shell</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/bin/bash&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#010-loops-and-conditionals-__codelineno-1-10"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bob&quot;</span><span class="p p-Indicator">,</span><span class="nt"> shell</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/bin/zsh&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
</span></code></pre></div>
<br/></p>
<h4 id="010-loops-and-conditionals-nested-loops">Nested loops<a class="headerlink" href="#010-loops-and-conditionals-nested-loops" title="Permanent link">&para;</a></h4>
<ul>
<li>Nested loops allow iterating over multiple lists:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#010-loops-and-conditionals-__codelineno-2-1"></a><span class="nn">---</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#010-loops-and-conditionals-__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#010-loops-and-conditionals-__codelineno-2-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#010-loops-and-conditionals-__codelineno-2-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Assign permissions</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#010-loops-and-conditionals-__codelineno-2-5"></a><span class="w">      </span><span class="nt">file</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#010-loops-and-conditionals-__codelineno-2-6"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/home/{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#010-loops-and-conditionals-__codelineno-2-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">touch</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#010-loops-and-conditionals-__codelineno-2-8"></a><span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#010-loops-and-conditionals-__codelineno-2-9"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#010-loops-and-conditionals-__codelineno-2-10"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;alice&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;bob&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#010-loops-and-conditionals-__codelineno-2-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;file1.txt&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;file2.txt&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#010-loops-and-conditionals-__codelineno-2-12"></a><span class="w">      </span><span class="nt">loop_control</span><span class="p">:</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#010-loops-and-conditionals-__codelineno-2-13"></a><span class="w">        </span><span class="nt">loop_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">item</span>
</span></code></pre></div>
<hr />
<h2 id="010-loops-and-conditionals-02-ansible-conditionals">02. Ansible Conditionals<a class="headerlink" href="#010-loops-and-conditionals-02-ansible-conditionals" title="Permanent link">&para;</a></h2>
<h4 id="010-loops-and-conditionals-using-the-when-clause">Using the <code>when</code> clause<a class="headerlink" href="#010-loops-and-conditionals-using-the-when-clause" title="Permanent link">&para;</a></h4>
<ul>
<li>Conditionals can be defined using the <code>when</code> clause:</li>
</ul>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#010-loops-and-conditionals-__codelineno-3-1"></a><span class="nn">---</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#010-loops-and-conditionals-__codelineno-3-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#010-loops-and-conditionals-__codelineno-3-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#010-loops-and-conditionals-__codelineno-3-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Apache only on Ubuntu</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#010-loops-and-conditionals-__codelineno-3-5"></a><span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#010-loops-and-conditionals-__codelineno-3-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#010-loops-and-conditionals-__codelineno-3-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#010-loops-and-conditionals-__codelineno-3-8"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
</span></code></pre></div>
<br/></p>
<h4 id="010-loops-and-conditionals-complex-conditionals">Complex conditionals<a class="headerlink" href="#010-loops-and-conditionals-complex-conditionals" title="Permanent link">&para;</a></h4>
<ul>
<li>Multiple conditionals can be combined with <code>and</code>, <code>or</code>, and <code>not</code> clauses:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#010-loops-and-conditionals-__codelineno-4-1"></a><span class="nn">---</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#010-loops-and-conditionals-__codelineno-4-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#010-loops-and-conditionals-__codelineno-4-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#010-loops-and-conditionals-__codelineno-4-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart service only if running</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#010-loops-and-conditionals-__codelineno-4-5"></a><span class="w">      </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#010-loops-and-conditionals-__codelineno-4-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#010-loops-and-conditionals-__codelineno-4-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#010-loops-and-conditionals-__codelineno-4-8"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot; and ansible_distribution_major_version | int &gt;= 7</span>
</span></code></pre></div>
<hr />
<h2 id="010-loops-and-conditionals-03-combining-loops-and-conditionals">03. Combining loops and conditionals<a class="headerlink" href="#010-loops-and-conditionals-03-combining-loops-and-conditionals" title="Permanent link">&para;</a></h2>
<ul>
<li>Loops and conditionals can be used together:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#010-loops-and-conditionals-__codelineno-5-1"></a><span class="nn">---</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#010-loops-and-conditionals-__codelineno-5-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#010-loops-and-conditionals-__codelineno-5-3"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#010-loops-and-conditionals-__codelineno-5-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create users only if home directory does not exist</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#010-loops-and-conditionals-__codelineno-5-5"></a><span class="w">      </span><span class="nt">user</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#010-loops-and-conditionals-__codelineno-5-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#010-loops-and-conditionals-__codelineno-5-7"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#010-loops-and-conditionals-__codelineno-5-8"></a><span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#010-loops-and-conditionals-__codelineno-5-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#010-loops-and-conditionals-__codelineno-5-10"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bob</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#010-loops-and-conditionals-__codelineno-5-11"></a><span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not ansible_facts[&#39;getent_passwd&#39;][item] is defined</span>
</span></code></pre></div>
<hr />
<p><img src="../assets/images/practice.png" alt="Practice" width="800"/>
<br/></p>
<h2 id="010-loops-and-conditionals-04-hands-on">04. Hands-on<a class="headerlink" href="#010-loops-and-conditionals-04-hands-on" title="Permanent link">&para;</a></h2>
<ul>
<li>Try writing a playbook that installs different packages based on the OS family.</li>
<li>Try to use as many parts as you can (external vars, vars, loops, conditions etc) while doing so.</li>
</ul></section><section class="print-page" id="011-jinja-templating" heading-number="2.13"><p><a href="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-011.yaml" target="_blank">
  <img src="https://github.com/nirgeier/AnsibleLabs/actions/workflows/Lab-011.yaml/badge.svg" alt="Build Status">
</a></p>
<hr />
<h1 id="011-jinja-templating-lab-011-jinja2-templating">Lab 011 - <code>Jinja2</code> Templating<a class="headerlink" href="#011-jinja-templating-lab-011-jinja2-templating" title="Permanent link">&para;</a></h1>
<ul>
<li>During our day to day job, we come across dozens of <strong>configuration files</strong>, set in many different formats.</li>
<li>What happens if we need to configure different environments, each with its own values? Should we duplicate the same file for each one?</li>
<li>This is where <code>Jinja2</code> templates come to the rescue! <code>Jinja2</code> helps us template our configuration files to be used with different values and reduce duplications.</li>
<li><code>Jinja2</code> is a powerful templating engine integrated into Ansible, used commonly in python projects.</li>
<li>Templates allow dynamic configuration file generation, based on variables and facts.</li>
<li><code>Jinja2</code> can be used with conditionals and loops and can even perform filters and functions on our values!</li>
</ul>
<h2 id="011-jinja-templating-01-creating-jinja2-templates">01. Creating Jinja2 templates<a class="headerlink" href="#011-jinja-templating-01-creating-jinja2-templates" title="Permanent link">&para;</a></h2>
<ul>
<li>Create a <code>Jinja2</code> template file by appending a <code>.j2</code> suffix to our base config filename. For example, <code>nginx.conf.j2</code>:</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#011-jinja-templating-__codelineno-0-1"></a># Example
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#011-jinja-templating-__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#011-jinja-templating-__codelineno-0-3"></a>events {}
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#011-jinja-templating-__codelineno-0-4"></a>http {
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#011-jinja-templating-__codelineno-0-5"></a>  server {
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#011-jinja-templating-__codelineno-0-6"></a>    listen {{ web_port }};
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#011-jinja-templating-__codelineno-0-7"></a>    server_name {{ domain_name }};
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#011-jinja-templating-__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#011-jinja-templating-__codelineno-0-9"></a>    location / {
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#011-jinja-templating-__codelineno-0-10"></a>      proxy_pass http://{{ backend_ip }}:{{ backend_port }};
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#011-jinja-templating-__codelineno-0-11"></a>    }
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#011-jinja-templating-__codelineno-0-12"></a>  }
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#011-jinja-templating-__codelineno-0-13"></a>}
</span></code></pre></div>
<hr />
<h2 id="011-jinja-templating-02-using-templates-in-playbooks">02. Using templates in playbooks<a class="headerlink" href="#011-jinja-templating-02-using-templates-in-playbooks" title="Permanent link">&para;</a></h2>
<ul>
<li>Integrate <code>Jinja2</code> templates using the <code>ansible.builtin.template</code> module:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#011-jinja-templating-__codelineno-1-1"></a><span class="nn">---</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#011-jinja-templating-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web_servers</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#011-jinja-templating-__codelineno-1-3"></a><span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#011-jinja-templating-__codelineno-1-4"></a><span class="w">    </span><span class="nt">web_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#011-jinja-templating-__codelineno-1-5"></a><span class="w">    </span><span class="nt">domain_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#011-jinja-templating-__codelineno-1-6"></a><span class="w">    </span><span class="nt">backend_ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.10.10</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#011-jinja-templating-__codelineno-1-7"></a><span class="w">    </span><span class="nt">backend_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#011-jinja-templating-__codelineno-1-8"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#011-jinja-templating-__codelineno-1-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy Nginx Configuration</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#011-jinja-templating-__codelineno-1-10"></a><span class="w">      </span><span class="nt">ansible.builtin.template</span><span class="p">:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#011-jinja-templating-__codelineno-1-11"></a><span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.j2</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#011-jinja-templating-__codelineno-1-12"></a><span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/nginx/conf.d/site.conf</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#011-jinja-templating-__codelineno-1-13"></a><span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart Nginx</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#011-jinja-templating-__codelineno-1-14"></a>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#011-jinja-templating-__codelineno-1-15"></a><span class="w">  </span><span class="nt">handlers</span><span class="p">:</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#011-jinja-templating-__codelineno-1-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart Nginx</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#011-jinja-templating-__codelineno-1-17"></a><span class="w">      </span><span class="nt">ansible.builtin.service</span><span class="p">:</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#011-jinja-templating-__codelineno-1-18"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#011-jinja-templating-__codelineno-1-19"></a><span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
</span></code></pre></div>
<hr />
<h2 id="011-jinja-templating-03-using-conditional-statements">03. Using conditional statements<a class="headerlink" href="#011-jinja-templating-03-using-conditional-statements" title="Permanent link">&para;</a></h2>
<ul>
<li><code>jinja2</code> supports conditional logic to dynamically alter configurations:</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#011-jinja-templating-__codelineno-2-1"></a>{% if ansible_distribution == &#39;Ubuntu&#39; %}
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#011-jinja-templating-__codelineno-2-2"></a>User ubuntu;
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#011-jinja-templating-__codelineno-2-3"></a>{% elif ansible_distribution == &#39;CentOS&#39; %}
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#011-jinja-templating-__codelineno-2-4"></a>User centos;
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#011-jinja-templating-__codelineno-2-5"></a>{% else %}
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#011-jinja-templating-__codelineno-2-6"></a>User default;
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#011-jinja-templating-__codelineno-2-7"></a>{% endif %}
</span></code></pre></div>
<hr />
<h2 id="011-jinja-templating-04-looping-with-jinja2">04. Looping with <code>Jinja2</code><a class="headerlink" href="#011-jinja-templating-04-looping-with-jinja2" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Jinja2</code> makes it easy to iterate over lists or dictionaries:</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#011-jinja-templating-__codelineno-3-1"></a># hosts file
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#011-jinja-templating-__codelineno-3-2"></a>{% for host in groups[&#39;web_servers&#39;] %}
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#011-jinja-templating-__codelineno-3-3"></a>{{ hostvars[host][&#39;ansible_default_ipv4&#39;][&#39;address&#39;] }} {{ host }}
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#011-jinja-templating-__codelineno-3-4"></a>{% endfor %}
</span></code></pre></div>
<hr />
<h2 id="011-jinja-templating-05-filters-and-functions">05. Filters and functions<a class="headerlink" href="#011-jinja-templating-05-filters-and-functions" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Jinja2</code> includes built-in filters to transform data:</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#011-jinja-templating-__codelineno-4-1"></a># Convert text to uppercase
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#011-jinja-templating-__codelineno-4-2"></a>ServerName {{ domain_name | upper }}
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#011-jinja-templating-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#011-jinja-templating-__codelineno-4-4"></a># Default filter for fallback values
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#011-jinja-templating-__codelineno-4-5"></a>Listen {{ custom_port | default(8080) }}
</span></code></pre></div>
<hr />
<h2 id="011-jinja-templating-06-summary">06. <strong>Summary</strong><a class="headerlink" href="#011-jinja-templating-06-summary" title="Permanent link">&para;</a></h2>
<p>üîπ <code>Jinja2</code> enables dynamic template generation with <strong>variables and facts</strong>.<br />
üîπ Templates help manage <strong>complex configurations</strong> in a more simple and efficient manner.<br />
üîπ Use <strong>conditional statements and loops</strong> for highly dynamic setups.<br />
üîπ Built-in filters enhance the <strong>manipulation of data</strong> directly within templates.</p>
<hr />
<p><img src="../assets/images/practice.png" alt="Practice" width="800"/>
<br/></p>
<h2 id="011-jinja-templating-07-hands-on">07. Hands-on<a class="headerlink" href="#011-jinja-templating-07-hands-on" title="Permanent link">&para;</a></h2>
<ul>
<li>Create a <code>Jinja2</code> template for generating a dynamic <code>/etc/motd</code> (<strong>&ldquo;Message of the Day&rdquo;</strong>) file, containing a personal message (ensure first that it is enabled).</li>
<li>The relevant code can be found in lab 009.</li>
<li><strong>Bonus:</strong> Use facts to display useful information about OS distribution, IP address and current hostname dynamically when logging in.</li>
</ul></section></section></div><style>.print-site-enumerate-headings #welcome > h1:before { content: '1 ' }

                .print-site-enumerate-headings #welcome h2:before { content: '1.' counter(counter-welcome-2) ' ' }
                .print-site-enumerate-headings #welcome h2 {  counter-reset: counter-welcome-3 ;  counter-increment: counter-welcome-2 }
            
                .print-site-enumerate-headings #welcome h3:before { content: '1.' counter(counter-welcome-2) '.' counter(counter-welcome-3) ' ' }
                .print-site-enumerate-headings #welcome h3 {  counter-increment: counter-welcome-3 }
            
.print-site-enumerate-headings #section-2 > h1:before { content: '2 ' }
.print-site-enumerate-headings #index > h1:before { content: '2.1 ' }

                .print-site-enumerate-headings #index h2:before { content: '2.1.' counter(counter-index-2) ' ' }
                .print-site-enumerate-headings #index h2 {  counter-increment: counter-index-2 }
            
.print-site-enumerate-headings #000-setup > h1:before { content: '2.2 ' }

                .print-site-enumerate-headings #000-setup h2:before { content: '2.2.' counter(counter-000-setup-2) ' ' }
                .print-site-enumerate-headings #000-setup h2 {  counter-increment: counter-000-setup-2 }
            
.print-site-enumerate-headings #001-verify-ansible > h1:before { content: '2.3 ' }

                .print-site-enumerate-headings #001-verify-ansible h2:before { content: '2.3.' counter(counter-001-verify-ansible-2) ' ' }
                .print-site-enumerate-headings #001-verify-ansible h2 {  counter-increment: counter-001-verify-ansible-2 }
            
.print-site-enumerate-headings #002-no-inventory > h1:before { content: '2.4 ' }

                .print-site-enumerate-headings #002-no-inventory h2:before { content: '2.4.' counter(counter-002-no-inventory-2) ' ' }
                .print-site-enumerate-headings #002-no-inventory h2 {  counter-increment: counter-002-no-inventory-2 }
            
.print-site-enumerate-headings #003-modules > h1:before { content: '2.5 ' }

                .print-site-enumerate-headings #003-modules h2:before { content: '2.5.' counter(counter-003-modules-2) ' ' }
                .print-site-enumerate-headings #003-modules h2 {  counter-increment: counter-003-modules-2 }
            
.print-site-enumerate-headings #004-playbooks > h1:before { content: '2.6 ' }

                .print-site-enumerate-headings #004-playbooks h2:before { content: '2.6.' counter(counter-004-playbooks-2) ' ' }
                .print-site-enumerate-headings #004-playbooks h2 {  counter-increment: counter-004-playbooks-2 }
            
.print-site-enumerate-headings #005-facts > h1:before { content: '2.7 ' }

                .print-site-enumerate-headings #005-facts h2:before { content: '2.7.' counter(counter-005-facts-2) ' ' }
                .print-site-enumerate-headings #005-facts h2 {  counter-increment: counter-005-facts-2 }
            
.print-site-enumerate-headings #006-git > h1:before { content: '2.8 ' }

                .print-site-enumerate-headings #006-git h2:before { content: '2.8.' counter(counter-006-git-2) ' ' }
                .print-site-enumerate-headings #006-git h2 {  counter-increment: counter-006-git-2 }
            
.print-site-enumerate-headings #007-create-user > h1:before { content: '2.9 ' }

                .print-site-enumerate-headings #007-create-user h2:before { content: '2.9.' counter(counter-007-create-user-2) ' ' }
                .print-site-enumerate-headings #007-create-user h2 {  counter-increment: counter-007-create-user-2 }
            
.print-site-enumerate-headings #008-challenges > h1:before { content: '2.10 ' }

                .print-site-enumerate-headings #008-challenges h2:before { content: '2.10.' counter(counter-008-challenges-2) ' ' }
                .print-site-enumerate-headings #008-challenges h2 {  counter-increment: counter-008-challenges-2 }
            
.print-site-enumerate-headings #009-roles > h1:before { content: '2.11 ' }

                .print-site-enumerate-headings #009-roles h2:before { content: '2.11.' counter(counter-009-roles-2) ' ' }
                .print-site-enumerate-headings #009-roles h2 {  counter-increment: counter-009-roles-2 }
            
.print-site-enumerate-headings #010-loops-and-conditionals > h1:before { content: '2.12 ' }

                .print-site-enumerate-headings #010-loops-and-conditionals h2:before { content: '2.12.' counter(counter-010-loops-and-conditionals-2) ' ' }
                .print-site-enumerate-headings #010-loops-and-conditionals h2 {  counter-increment: counter-010-loops-and-conditionals-2 }
            
.print-site-enumerate-headings #011-jinja-templating > h1:before { content: '2.13 ' }

                .print-site-enumerate-headings #011-jinja-templating h2:before { content: '2.13.' counter(counter-011-jinja-templating-2) ' ' }
                .print-site-enumerate-headings #011-jinja-templating h2 {  counter-increment: counter-011-jinja-templating-2 }
            </style>
<!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Render date of last update -->


<!-- Render date of creation -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render authors -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render committers from GitHub -->


<!-- Render committers from GitLab -->


<!-- Render committers -->


<!-- ---------------------------------------------------------------------- -->

<!-- Determine date of last update -->


<!-- Source file information -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Footer -->
<footer class="md-footer">
  <div class="logo1"></div>
  <div class="logo2"></div>

  <!-- Link to previous and/or next page -->
  
    
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ¬©2021-2025 Nir Geier<br/><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target="_blank" rel="noopener"><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a>
    </div>
  
  
</div>

      <!-- Social links -->
      
        
<div class="md-social">
    
    
    
    
    
    <a href="https://github.com/nirgeier/AnsibleLabs" target="_blank" rel="noopener" title="View on GitHub"
        class="md-social__link social-class__github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/AnsibleLabs/network/members" target="_blank" rel="noopener" title="Fork this repo"
        class="md-social__link social-class__fork">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/AnsibleLabs/stargazers" target="_blank" rel="noopener" title="Star this repo"
        class="md-social__link social-class__star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener" title="Connect on LinkedIn"
        class="md-social__link social-class__linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://discord.gg/U6xW23Ss" target="_blank" rel="noopener" title="Follow me on Discord"
        class="md-social__link social-class__discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://stackoverflow.com/users/1755598/codewizard" target="_blank" rel="noopener" title="Follow me on Stack Overflow"
        class="md-social__link social-class__stackoverflow">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://wa.me/972548122310" target="_blank" rel="noopener" title="Follow me on WhatsApp"
        class="md-social__link social-class__whatsapp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg>
    </a>
    
    
    
    
    
    <a href="mailto:nirg@codewizard.co.il" target="_blank" rel="noopener" title="Email me"
        class="md-social__link social-class__email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg>
    </a>
    
</div>
      
    </div>
  </div>
</footer>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "/AnsibleLabs/", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "content.footer.last-updated", "content.footer.contributors", {"navigation.expand": false}, "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", {"navigation.top": true}, "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate", "toc.sticky"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="https://buttons.github.io/buttons.js?v=1765717871"></script>
      
        <script src="../assets/javascripts/truncate_nav.js?v=1765717871"></script>
      
    
  </body>
</html>